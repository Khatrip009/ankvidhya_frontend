const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/inquiry-Dz9R_8bU.js","assets/vendor.react-Dp9iUKRz.js","assets/vendor-Czq_RlNT.js","assets/vendor.recharts-CnlMiFQ2.js"])))=>i.map(i=>d[i]);
import{u as Rt,r as s,j as e,e as lt,f as Kt,L as Nt,F as aa,B as ia,g as na,h as Ue,N as Vt,k as la}from"./vendor.react-Dp9iUKRz.js";import{a2 as rt,a3 as $t,a4 as ra,a5 as as,a6 as Wt,a7 as Es,a8 as oa,a9 as da,aa as ca,ab as ma,ac as ua}from"./vendor-Czq_RlNT.js";import{R as kt,L as ha,C as Rs,X as Is,Y as Ts,T as St,a as pa,A as xa,P as is,b as ns,c as ls,B as ga,d as fa,e as rs}from"./vendor.recharts-CnlMiFQ2.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))u(v);new MutationObserver(v=>{for(const M of v)if(M.type==="childList")for(const S of M.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&u(S)}).observe(document,{childList:!0,subtree:!0});function r(v){const M={};return v.integrity&&(M.integrity=v.integrity),v.referrerPolicy&&(M.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?M.credentials="include":v.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function u(v){if(v.ep)return;v.ep=!0;const M=r(v);fetch(v.href,M)}})();function va(t){t=t||{};var a=new URLSearchParams;Object.keys(t).forEach(function(u){var v=t[u];v==null||v===""||(Array.isArray(v)?v.forEach(function(M){M!=null&&a.append(u,M)}):a.append(u,v))});var r=a.toString();return r?"?"+r:""}function ba(t){try{var a=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return a?decodeURIComponent(a[1]):""}catch{return""}}function os(){try{if(typeof window<"u"&&window.auth&&typeof window.auth.getToken=="function"){var t=window.auth.getToken();if(t)return t}}catch{}try{var a=localStorage.getItem("token");if(a)return a}catch{}return ba("token")||""}function ja(t){try{var a=t.headers&&t.headers.get("content-type")||"";return a.indexOf("application/json")!==-1}catch{return!1}}function ya(){try{if(typeof window<"u"&&window.CONFIG&&window.CONFIG.API_BASE)return String(window.CONFIG.API_BASE)}catch{}try{if(typeof document<"u"){var t=document.querySelector('meta[name="api-base"]');if(t&&t.content)return String(t.content)}}catch{}try{if(typeof location<"u"&&location.hostname){var a=location.hostname;return a==="localhost"||a==="127.0.0.1"?"http://127.0.0.1:4000":"https://api.ankvidhya.com"}}catch{}return"https://api.ankvidhya.com"}var ds=!1;async function st(t,a){var pe;a=a||{};var r=a.method||"GET",u=a.body,v=a.query,M=a.headers||{},S=!!a.background,L=a.expect||"auto",g=a._retried,R=ya(),h=os(),w=new Headers(M||{}),D=typeof FormData<"u"&&u instanceof FormData;if(!D&&u!==void 0&&typeof u!="string"&&!w.has("Content-Type")&&w.set("Content-Type","application/json"),w.has("Accept")||w.set("Accept","application/json, text/plain, */*"),h)w.set("Authorization","Bearer "+h);else if((t.indexOf("/api/")===0||t.indexOf("http")===0)&&!S&&!ds){try{console.warn("[api] No token available. API calls may return 401.")}catch{}ds=!0}var q=t.indexOf("http")===0?t:R+t,$=q+va(v),ae;try{ae=await fetch($,{method:r,headers:w,body:u===void 0?void 0:D||typeof u=="string"?u:JSON.stringify(u)})}catch{var F=new Error("Network error");throw F.status=0,F.data={message:"Network error"},F}var ce=L==="json"||L==="auto"&&ja(ae);if(!ae.ok){if(ae.status===401&&!g){var ne=os();if(ne&&ne!==h)return st(t,{method:r,body:u,query:v,headers:M,background:S,expect:L,_retried:!0})}var J=null;if(ce)try{J=await ae.json()}catch{J={message:"Failed to parse JSON error response"}}else try{J={message:await ae.text()}}catch{J={message:ae.statusText||"Unknown error"}}if(ae.status===401&&!S){try{(pe=window.auth)!=null&&pe.setToken&&window.auth.setToken("")}catch{}try{localStorage.removeItem("token")}catch{}try{if(typeof window<"u"){var le=new CustomEvent("auth:expired",{detail:{message:(J==null?void 0:J.message)||"Session expired"}});window.dispatchEvent(le)}}catch{}}var Q=new Error((J==null?void 0:J.message)||ae.statusText||"HTTP error");throw Q.status=ae.status,Q.data=J,Q}if(L==="blob")return ae.blob();if(ce)try{return await ae.json()}catch{return null}try{return await ae.text()}catch{return null}}async function wa(t,a){a=a||{};var r=await st(t,{method:"GET",query:a.query,headers:a.headers,expect:"blob"}),u=document.createElement("a"),v=URL.createObjectURL(r);u.href=v,u.download=a.filename||"download",document.body.appendChild(u),u.click(),setTimeout(function(){URL.revokeObjectURL(v);try{u.remove()}catch{}},0)}var vt=(t,a)=>st(t,{...a||{},method:"GET"}),dt=(t,a,r)=>st(t,{...r||{},method:"POST",body:a}),_a=(t,a,r)=>st(t,{...r||{},method:"PUT",body:a}),cs=(t,a,r)=>st(t,{...r||{},method:"PATCH",body:a}),ms=(t,a)=>st(t,{...a||{},method:"DELETE"}),E={request:st,download:wa,get:vt,post:dt,put:_a,patch:cs,del:ms,background(t,a,r){return st(t,{...r||{},method:"POST",body:a,background:!0})},leads:{lookups:()=>vt("/api/leads/lookups"),list:t=>vt("/api/leads",{query:t}),get:t=>vt("/api/leads/"+t),patch:(t,a)=>cs("/api/leads/"+t,a),remove:t=>ms("/api/leads/"+t),convert:t=>dt("/api/leads/"+t+"/convert"),publicSubmit:t=>dt("/api/leads/public",t)},orders:{strengths:(t,a)=>dt(`/api/orders/${t}/strengths`,{strengths:a}),confirm:t=>dt(`/api/orders/${t}/confirm`)}};const Ct="token";let Mt="";try{Mt=localStorage.getItem(Ct)||""}catch{Mt=""}function Yt(){return Mt||localStorage.getItem(Ct)||""||""}function Ds(t){Mt=t||"";try{t?localStorage.setItem(Ct,t):localStorage.removeItem(Ct)}catch{}}function Na(){return!!Yt()}function Fs(t){if(!t)return;const a=(t.role_name||t.role||"").toString().toLowerCase();try{localStorage.setItem("role",a),localStorage.setItem("user",JSON.stringify(t)),t.permissions&&localStorage.setItem("permissions",JSON.stringify(t.permissions));const r=document.getElementById("topProfileName");r&&(r.textContent=t.username||t.employee_name||t.student_name||"Profile");const u=JSON.parse(localStorage.getItem("permissions")||"[]");window.renderSidebar&&window.renderSidebar({role:a||"faculty",permissions:u})}catch{}try{const r=new CustomEvent("auth:changed",{detail:{user:t}});window.dispatchEvent(r)}catch{}}function ka(t){return t?t.data?t.data:t:null}async function Sa(){if(!Yt())throw new Error("No token");const a=["/api/auth/me","/auth/me","/api/me","/me"];let r=null;for(const u of a)try{const v=await E.get(u),M=ka(v);if(M)return Fs(M),M}catch(v){r=v}throw r||new Error("Failed to load session")}function Ca(){Ds("");try{localStorage.removeItem("user")}catch{}try{localStorage.removeItem("role")}catch{}try{localStorage.removeItem("permissions")}catch{}try{const t=new CustomEvent("auth:changed",{detail:{user:null}});window.dispatchEvent(t)}catch{}}const Ze={getToken:Yt,setToken:Ds,isAuthed:Na,setSession:Fs,loadMe:Sa,logout:Ca},nt=[{q:"Mathematics is the language with which God has written the universe.",a:"Galileo Galilei"},{q:"Education is not the learning of facts, but the training of the mind to think.",a:"Albert Einstein"},{q:"The only limit to our realization of tomorrow is our doubts of today.",a:"F. D. Roosevelt"},{q:"An investment in knowledge pays the best interest.",a:"Benjamin Franklin"},{q:"Tell me and I forget. Teach me and I remember. Involve me and I learn.",a:"Benjamin Franklin"},{q:"The beautiful thing about learning is that no one can take it away from you.",a:"B. B. King"},{q:"Pure mathematics is, in its way, the poetry of logical ideas.",a:"Albert Einstein"},{q:"Education is the passport to the future, for tomorrow belongs to those who prepare for it today.",a:"Malcolm X"},{q:"It always seems impossible until it’s done.",a:"Nelson Mandela"},{q:"The expert in anything was once a beginner.",a:"Helen Hayes"}];function Ma(t=""){const a=(t||"").toString().toLowerCase();return a?a.includes("admin")||a.includes("super")||a.includes("manager")||a.includes("owner")?"/dashboard/admin":a.includes("faculty")||a.includes("teacher")||a.includes("instructor")?"/dashboard/faculty":a.includes("school")||a.includes("school_admin")||a.includes("schooladmin")?"/dashboard/school":"/dashboard":"/dashboard"}function Pa(){const t=Rt(),[a,r]=s.useState(""),[u,v]=s.useState(""),[M,S]=s.useState(!1),[L,g]=s.useState(!1),[R,h]=s.useState(0),w=s.useRef(null);s.useEffect(()=>{try{const F=localStorage.getItem("remember_identifier");F&&(r(F),S(!0))}catch{}return w.current=setInterval(()=>{h(F=>(F+1)%nt.length)},6e3),()=>{clearInterval(w.current)}},[]);function D(){h(F=>(F-1+nt.length)%nt.length)}function q(){h(F=>(F+1)%nt.length)}async function $(F){var ce,ne;if(F.preventDefault(),!a.trim()||!u){const J="Please enter username/email and password";window.ui&&window.ui.toast?window.ui.toast(J,"danger"):alert(J);return}g(!0);try{const J=await E.post("/auth/login",{usernameOrEmail:a.trim(),password:u});let le=null;J&&(le=J.token||J.access_token||J.data&&(J.data.token||J.data.access_token)||null),le&&Ze.setToken(le),M?localStorage.setItem("remember_identifier",a.trim()):localStorage.removeItem("remember_identifier");let Q=null;try{Q=await Ze.loadMe()}catch(O){console.warn("auth.loadMe failed after login:",(O==null?void 0:O.message)||O);try{const de=await E.get("/api/auth/me").catch(()=>E.get("/auth/me"));if(Q=de&&(de.data||de)||null,Q){try{localStorage.setItem("user",JSON.stringify(Q))}catch{}try{localStorage.setItem("role",(Q.role_name||Q.role||"").toString().toLowerCase())}catch{}if(Q.permissions)try{localStorage.setItem("permissions",JSON.stringify(Q.permissions))}catch{}}}catch{}}if(!Q&&J&&J.data){Q=J.data;try{localStorage.setItem("user",JSON.stringify(Q))}catch{}try{localStorage.setItem("role",(Q.role_name||Q.role||"").toString().toLowerCase())}catch{}}const pe=Q?Q.role_name||Q.role||"":localStorage.getItem("role")||"",re=Ma(pe);window.ui&&window.ui.toast&&window.ui.toast("Welcome!","success"),t(re,{replace:!0})}catch(J){if(console.error("Login error",J),(J==null?void 0:J.status)===401){const le=((ce=J==null?void 0:J.data)==null?void 0:ce.message)||"Invalid credentials";window.ui&&window.ui.toast?window.ui.toast(le,"danger"):alert(le)}else if((J==null?void 0:J.status)===403){const le="Signed in, but your role/scope is restricted. Contact admin.";window.ui&&window.ui.toast?window.ui.toast(le,"warning"):alert(le)}else{const le=((ne=J==null?void 0:J.data)==null?void 0:ne.message)||J.message||"Login failed";window.ui&&window.ui.toast?window.ui.toast(le,"danger"):alert(le)}}finally{g(!1)}}const ae=[{char:"π",x:"6%",y:"8%",size:"text-2xl",delay:"delay-0"},{char:"∞",x:"18%",y:"22%",size:"text-3xl",delay:"delay-200"},{char:"Σ",x:"32%",y:"6%",size:"text-2xl",delay:"delay-400"},{char:"√",x:"70%",y:"12%",size:"text-2xl",delay:"delay-600"},{char:"Δ",x:"82%",y:"32%",size:"text-3xl",delay:"delay-800"},{char:"∫",x:"56%",y:"40%",size:"text-2xl",delay:"delay-1000"},{char:"∮",x:"12%",y:"62%",size:"text-2xl",delay:"delay-1200"},{char:"Δ",x:"44%",y:"74%",size:"text-2xl",delay:"delay-1400"},{char:"∂",x:"74%",y:"66%",size:"text-2xl",delay:"delay-1600"},{char:"≈",x:"82%",y:"78%",size:"text-2xl",delay:"delay-1800"}];return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 p-6",children:[e.jsxs("div",{className:"max-w-5xl w-full shadow-2xl rounded-2xl overflow-hidden bg-white grid grid-cols-1 md:grid-cols-2",children:[e.jsxs("div",{className:"p-8 md:p-12 flex flex-col justify-center",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("img",{src:"/images/Ank_Logo.png",alt:"AnkVidhya Logo",className:"mx-auto mb-3 h-16"}),e.jsx("h1",{className:"text-2xl font-semibold text-slate-800",children:"Welcome to AnkVidhya ERP System"}),e.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Where Numbers Meet Life Wisdom"})]}),e.jsxs("form",{id:"loginForm",onSubmit:$,className:"space-y-4",noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{className:"sr-only",htmlFor:"identifier",children:"Email or Username"}),e.jsxs("div",{className:"flex items-center border rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-indigo-500",children:[e.jsx("div",{className:"px-3",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5.121 17.804A9 9 0 1118.879 6.196 9 9 0 015.121 17.804z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx("input",{id:"identifier",type:"text",value:a,onChange:F=>r(F.target.value),placeholder:"Email or Username",className:"w-full px-3 py-3 outline-none bg-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"sr-only",htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"flex items-center border rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-indigo-500",children:[e.jsx("div",{className:"px-3",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 11c1.657 0 3-1.343 3-3V6a3 3 0 10-6 0v2c0 1.657 1.343 3 3 3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 11v7a2 2 0 002 2h10a2 2 0 002-2v-7H5z"})]})}),e.jsx("input",{id:"password",type:"password",value:u,onChange:F=>v(F.target.value),placeholder:"Password",className:"w-full px-3 py-3 outline-none bg-transparent",required:!0})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:F=>S(F.target.checked),className:"form-checkbox h-4 w-4 text-indigo-600 rounded"}),e.jsx("span",{className:"text-slate-600",children:"Remember me"})]}),e.jsx("button",{type:"button",className:"text-indigo-600 hover:underline text-sm",onClick:()=>t("/forgot-password"),children:"Forgot password?"})]}),e.jsx("div",{children:e.jsx("button",{id:"loginBtn",type:"submit",disabled:L,className:`w-full py-3 rounded-lg text-white font-medium transition-all ${L?"bg-indigo-400":"bg-indigo-600 hover:bg-indigo-700"}`,children:e.jsxs("span",{className:"inline-flex items-center justify-center gap-3",children:[e.jsx("span",{children:L?"Signing in…":"Sign in"}),L&&e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]})]})})})]})]}),e.jsxs("div",{className:"relative hidden md:flex flex-col justify-center items-center text-white p-8 md:p-12 bg-gradient-to-br from-indigo-700 via-fuchsia-700 to-rose-600 overflow-hidden",children:[ae.map((F,ce)=>e.jsx("span",{"aria-hidden":!0,style:{left:F.x,top:F.y,transitionDelay:`${ce*120}ms`},className:`absolute transform -translate-x-1/2 -translate-y-1/2 opacity-80 ${F.size} animate-[float_6s_ease-in-out_infinite]`,children:F.char},ce)),e.jsx("div",{className:"absolute inset-0 bg-black/20 pointer-events-none"}),e.jsxs("div",{className:"relative z-10 w-full max-w-md text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 mx-auto mb-4 text-yellow-400",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M7.17 6A5 5 0 107 16H9a3 3 0 013-3V6H7.17zM17.17 6A5 5 0 1017 16h2a3 3 0 00-3-3V6h1.17z"})}),e.jsxs("div",{id:"quote-container",className:"mb-4",children:[e.jsx("p",{className:"text-lg font-medium leading-relaxed",children:nt[R].q}),e.jsxs("p",{className:"mt-2 text-sm opacity-80",children:["— ",nt[R].a]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-3",children:[e.jsx("button",{onClick:D,className:"text-white/90 hover:text-white text-2xl p-1",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("div",{className:"h-1 w-24 bg-white/20 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-white rounded-full transition-all",style:{width:`${(R+1)/nt.length*100}%`}})}),e.jsx("button",{onClick:q,className:"text-white/90 hover:text-white text-2xl p-1",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]})]})]}),e.jsx("style",{children:`
        @keyframes float {
          0% { transform: translateY(0) translateX(0) rotate(0deg); }
          50% { transform: translateY(-8px) translateX(6px) rotate(4deg); }
          100% { transform: translateY(0) translateX(0) rotate(0deg); }
        }
        .animate-[float_6s_ease-in-out_infinite] {
          animation: float 6s ease-in-out infinite;
        }
      `})]})}const A=(t,a)=>{const r=u=>{const v=typeof a=="function"?a(u):a,M=lt.Children.toArray(v);return e.jsx("svg",{...u,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",children:M})};return r.displayName=t?`${t}Icon`:"ERPIcon",r},Ae={Dashboard:A("Dashboard",()=>e.jsx("path",{d:"M3 13h8V3H3v10zM13 21h8V11h-8v10zM13 3v6h8V3h-8zM3 21h8v-6H3v6z"})),Analytics:A("Analytics",()=>[e.jsx("path",{d:"M3 3v18h18"},"a1"),e.jsx("path",{d:"M7 14v-4"},"a2"),e.jsx("path",{d:"M12 17v-8"},"a3"),e.jsx("path",{d:"M17 11V7"},"a4")]),Reports:A("Reports",()=>[e.jsx("path",{d:"M21 15V7a2 2 0 0 0-2-2H9L3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z"},"r1"),e.jsx("path",{d:"M7 10h10"},"r2"),e.jsx("path",{d:"M7 14h6"},"r3")]),Settings:A("Settings",()=>[e.jsx("path",{d:"M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z"},"s1"),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 2.28 17.3l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c.66 0 1.26-.38 1.51-1a1.65 1.65 0 0 0-.33-1.82L4.3 6.28A2 2 0 1 1 7.13 3.45l.06.06c.46.39 1.07.57 1.68.45.54-.11 1.06-.42 1.42-.86A2 2 0 1 1 13 4.09v.09c0 .66.38 1.26 1 1.51.61.12 1.22-.06 1.68-.45l.06-.06A2 2 0 1 1 19.72 6.7l-.06.06c-.39.46-.57 1.07-.45 1.68.25.62.85 1 1.51 1H21a2 2 0 1 1 0 4h-.09c-.66 0-1.26.38-1.51 1z"},"s2")]),Users:A("Users",()=>[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"},"u1"),e.jsx("circle",{cx:"12",cy:"7",r:"4"},"u2")]),UserAdd:A("UserAdd",()=>[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"},"ua1"),e.jsx("circle",{cx:"12",cy:"7",r:"4"},"ua2"),e.jsx("path",{d:"M20 8v6"},"ua3"),e.jsx("path",{d:"M23 11h-6"},"ua4")]),Team:A("Team",()=>[e.jsx("path",{d:"M16 11c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z"},"t1"),e.jsx("path",{d:"M2 20v-2c0-2 4-3 7-3s7 1 7 3v2"},"t2"),e.jsx("path",{d:"M22 20v-2c0-2-4-3-7-3s-7 1-7 3v2"},"t3")]),Product:A("Product",()=>[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"},"p1"),e.jsx("path",{d:"M3 7h18"},"p2")]),Inventory:A("Inventory",()=>[e.jsx("path",{d:"M21 16V8a2 2 0 0 0-1-1.73L13 3.27a2 2 0 0 0-2 0L4 6.27A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"},"i1"),e.jsx("path",{d:"M12 7v10"},"i2")]),Cart:A("Cart",()=>[e.jsx("path",{d:"M6 6h15l-1.5 9h-12z"},"c1"),e.jsx("circle",{cx:"9",cy:"20",r:"1"},"c2"),e.jsx("circle",{cx:"18",cy:"20",r:"1"},"c3")]),Order:A("Order",()=>[e.jsx("path",{d:"M3 3h18v4H3z"},"o1"),e.jsx("path",{d:"M7 13h10"},"o2"),e.jsx("path",{d:"M7 17h7"},"o3")]),Invoice:A("Invoice",()=>[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"},"in1"),e.jsx("path",{d:"M7 7h10"},"in2"),e.jsx("path",{d:"M7 11h10"},"in3"),e.jsx("path",{d:"M7 15h6"},"in4")]),Receipt:A("Receipt",()=>[e.jsx("path",{d:"M21 10V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v5"},"rc1"),e.jsx("path",{d:"M7 14h10"},"rc2"),e.jsx("path",{d:"M7 18h6"},"rc3")]),Payment:A("Payment",()=>[e.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2"},"pm1"),e.jsx("path",{d:"M2 11h20"},"pm2"),e.jsx("circle",{cx:"6",cy:"14",r:"1"},"pm3")]),CreditCard:A("CreditCard",()=>[e.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"},"cc1"),e.jsx("path",{d:"M2 10h20"},"cc2")]),Bank:A("Bank",()=>[e.jsx("path",{d:"M12 2l10 6v2H2V8z"},"b1"),e.jsx("path",{d:"M3 10l9 6 9-6"},"b2"),e.jsx("path",{d:"M4 22h16"},"b3")]),Wallet:A("Wallet",()=>[e.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2"},"w1"),e.jsx("path",{d:"M16 12a2 2 0 1 1 0 4"},"w2")]),CalendarCheck:A("CalendarCheck",()=>[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"},"cck1"),e.jsx("path",{d:"M8 2v4"},"cck2"),e.jsx("path",{d:"M16 2v4"},"cck3"),e.jsx("path",{d:"M9 12l2 2 4-4"},"cck4")]),CalendarPlus:A("CalendarPlus",()=>[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"},"cpl1"),e.jsx("path",{d:"M8 2v4"},"cpl2"),e.jsx("path",{d:"M16 2v4"},"cpl3"),e.jsx("path",{d:"M12 10v6"},"cpl4"),e.jsx("path",{d:"M9 13h6"},"cpl5")]),Clock:A("Clock",()=>[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"cl1"),e.jsx("path",{d:"M12 6v6l4 2"},"cl2")]),Notification:A("Notification",()=>[e.jsx("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0 1 18 14.158V11a6 6 0 1 0-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5"},"n1"),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"},"n2")]),Bell:A("Bell",()=>[e.jsx("path",{d:"M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"},"be1"),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"},"be2")]),Message:A("Message",()=>e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})),Chat:A("Chat",()=>[e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"},"ch1"),e.jsx("path",{d:"M7 10h10"},"ch2")]),File:A("File",()=>e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16l4-2h8a2 2 0 0 0 2-2V8z"})),Folder:A("Folder",()=>e.jsx("path",{d:"M3 7a2 2 0 0 1 2-2h4l2 2h6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})),FolderOpen:A("FolderOpen",()=>[e.jsx("path",{d:"M3 7a2 2 0 0 1 2-2h4l2 2h6a2 2 0 0 1 2 2v1"},"fo1"),e.jsx("path",{d:"M21 15v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7"},"fo2")]),UploadCloud:A("UploadCloud",()=>[e.jsx("path",{d:"M16 16l-4-4-4 4"},"uc1"),e.jsx("path",{d:"M12 12v8"},"uc2"),e.jsx("path",{d:"M20.39 18.39A5 5 0 0 0 18 9h-1.26"},"uc3")]),DownloadCloud:A("DownloadCloud",()=>[e.jsx("path",{d:"M12 12l4 4H8l4-4"},"dc1"),e.jsx("path",{d:"M12 12V4"},"dc2"),e.jsx("path",{d:"M20.39 18.39A5 5 0 0 1 18 9h-1.26"},"dc3")]),Cloud:A("Cloud",()=>e.jsx("path",{d:"M20 17.58A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 4 16"})),Sync:A("Sync",()=>[e.jsx("path",{d:"M21 12a9 9 0 1 1-3-6.71"},"sy1"),e.jsx("polyline",{points:"23 7 23 1 17 1"},"sy2"),e.jsx("polyline",{points:"1 17 1 23 7 23"},"sy3")]),Refresh:A("Refresh",()=>[e.jsx("path",{d:"M20 4v6h-6"},"rf1"),e.jsx("path",{d:"M4 20v-6h6"},"rf2"),e.jsx("path",{d:"M20 4a8 8 0 0 0-16 0"},"rf3"),e.jsx("path",{d:"M4 20a8 8 0 0 0 16 0"},"rf4")]),Search:A("Search",()=>[e.jsx("circle",{cx:"11",cy:"11",r:"7"},"s1"),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"},"s2")]),Filter:A("Filter",()=>e.jsx("path",{d:"M22 3H2l8 9v7l4 2v-9z"})),SortAsc:A("SortAsc",()=>[e.jsx("path",{d:"M12 19V5"},"sa1"),e.jsx("path",{d:"M5 12l7-7 7 7"},"sa2")]),Plus:A("Plus",()=>[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"},"p1"),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"},"p2")]),Minus:A("Minus",()=>e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})),Edit:A("Edit",()=>[e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"},"e1"),e.jsx("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"},"e2")]),Save:A("Save",()=>[e.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"},"sv1"),e.jsx("polyline",{points:"17 21 17 13 7 13 7 21"},"sv2")]),Archive:A("Archive",()=>[e.jsx("rect",{x:"3",y:"3",width:"18",height:"4",rx:"1"},"ar1"),e.jsx("path",{d:"M21 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7"},"ar2"),e.jsx("path",{d:"M10 11h4"},"ar3")]),Delete:A("Delete",()=>[e.jsx("path",{d:"M21 4H8l-1 1H4v2h16V5z"},"dl1"),e.jsx("path",{d:"M10 11v6"},"dl2"),e.jsx("path",{d:"M14 11v6"},"dl3")]),Trash:A("Trash",()=>[e.jsx("polyline",{points:"3 6 5 6 21 6"},"tr1"),e.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"},"tr2"),e.jsx("path",{d:"M10 11v6"},"tr3"),e.jsx("path",{d:"M14 11v6"},"tr4")]),Lock:A("Lock",()=>[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"},"lk1"),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"},"lk2")]),Unlock:A("Unlock",()=>[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2"},"ul1"),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0"},"ul2"),e.jsx("path",{d:"M12 17v.01"},"ul3")]),Shield:A("Shield",()=>e.jsx("path",{d:"M12 2l7 4v6c0 6-4 10-7 12-3-2-7-6-7-12V6l7-4z"})),Key:A("Key",()=>[e.jsx("circle",{cx:"7",cy:"14",r:"3"},"k1"),e.jsx("path",{d:"M10 14l10-10"},"k2"),e.jsx("path",{d:"M18 6v2"},"k3")]),Tag:A("Tag",()=>[e.jsx("path",{d:"M20 10V6a2 2 0 0 0-2-2h-4L2 12v6a2 2 0 0 0 2 2h4l10-10z"},"tg1"),e.jsx("circle",{cx:"7",cy:"7",r:"1.5"},"tg2")]),Label:A("Label",()=>[e.jsx("rect",{x:"3",y:"7",width:"14",height:"10",rx:"2"},"lb1"),e.jsx("path",{d:"M7 11h6"},"lb2")]),Barcode:A("Barcode",()=>[e.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"},"bc1"),e.jsx("path",{d:"M7 8v8"},"bc2"),e.jsx("path",{d:"M10 8v8"},"bc3"),e.jsx("path",{d:"M13 8v8"},"bc4"),e.jsx("path",{d:"M16 8v8"},"bc5")]),QR:A("QR",()=>[e.jsx("rect",{x:"3",y:"3",width:"8",height:"8"},"qr1"),e.jsx("rect",{x:"13",y:"3",width:"8",height:"8"},"qr2"),e.jsx("rect",{x:"3",y:"13",width:"8",height:"8"},"qr3"),e.jsx("rect",{x:"13",y:"13",width:"4",height:"4"},"qr4")]),Map:A("Map",()=>e.jsx("path",{d:"M3 6l7-3 7 3 7-3v14l-7 3-7-3-7 3V6z"})),Location:A("Location",()=>[e.jsx("path",{d:"M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1 1 18 0z"},"lo1"),e.jsx("circle",{cx:"12",cy:"10",r:"3"},"lo2")]),Pin:A("Pin",()=>[e.jsx("path",{d:"M12 2C8 2 5 5 5 9c0 7 7 13 7 13s7-6 7-13c0-4-3-7-7-7z"},"pn1"),e.jsx("circle",{cx:"12",cy:"9",r:"2"},"pn2")]),Home:A("Home",()=>e.jsx("path",{d:"M3 11L12 3l9 8v8a2 2 0 0 1-2 2h-4v-6H9v6H5a2 2 0 0 1-2-2v-8z"})),Help:A("Help",()=>[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"hp1"),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.82 1c0 2-3 2-3 4"},"hp2"),e.jsx("path",{d:"M12 17h.01"},"hp3")]),InfoCircle:A("InfoCircle",()=>[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"ic1"),e.jsx("path",{d:"M12 16v-4"},"ic2"),e.jsx("path",{d:"M12 8h.01"},"ic3")]),Star:A("Star",()=>e.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24 7.46 14l-1.64 7z"})),Favorite:A("Favorite",()=>e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"})),Eye:A("Eye",()=>[e.jsx("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"},"ey1"),e.jsx("circle",{cx:"12",cy:"12",r:"3"},"ey2")]),EyeOff:A("EyeOff",()=>[e.jsx("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.12 21.12 0 0 1 5.06-7.94"},"eo1"),e.jsx("path",{d:"M1 1l22 22"},"eo2"),e.jsx("path",{d:"M14.12 14.12a3 3 0 0 1-4.24-4.24"},"eo3")]),ChartLine:A("ChartLine",()=>[e.jsx("path",{d:"M3 3v18h18"},"cl1"),e.jsx("path",{d:"M6 14l4-4 4 6 6-8"},"cl2")]),ChartBar:A("ChartBar",()=>[e.jsx("path",{d:"M3 3v18h18"},"cb1"),e.jsx("rect",{x:"7",y:"10",width:"3",height:"7"},"cb2"),e.jsx("rect",{x:"12",y:"6",width:"3",height:"11"},"cb3"),e.jsx("rect",{x:"17",y:"13",width:"3",height:"4"},"cb4")]),PieChart:A("PieChart",()=>[e.jsx("path",{d:"M21.21 15a9 9 0 1 0-9.21 6.99"},"pc1"),e.jsx("path",{d:"M21 12h-9V3"},"pc2")]),Grid:A("Grid",()=>[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"},"g1"),e.jsx("path",{d:"M9 3v18"},"g2"),e.jsx("path",{d:"M15 3v18"},"g3"),e.jsx("path",{d:"M3 9h18"},"g4"),e.jsx("path",{d:"M3 15h18"},"g5")]),Table:A("Table",()=>[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"},"tb1"),e.jsx("path",{d:"M3 9h18"},"tb2"),e.jsx("path",{d:"M9 3v18"},"tb3")]),Columns:A("Columns",()=>[e.jsx("rect",{x:"3",y:"3",width:"6",height:"18",rx:"1"},"co1"),e.jsx("rect",{x:"10",y:"3",width:"4",height:"18",rx:"1"},"co2"),e.jsx("rect",{x:"16",y:"3",width:"5",height:"18",rx:"1"},"co3")]),Rows:A("Rows",()=>[e.jsx("rect",{x:"3",y:"4",width:"18",height:"4",rx:"1"},"rw1"),e.jsx("rect",{x:"3",y:"10",width:"18",height:"4",rx:"1"},"rw2"),e.jsx("rect",{x:"3",y:"16",width:"18",height:"4",rx:"1"},"rw3")]),Link:A("Link",()=>[e.jsx("path",{d:"M10 13a5 5 0 0 0 7 0l3-3"},"lk1"),e.jsx("path",{d:"M14 11a5 5 0 0 0-7 0L4 14"},"lk2")]),Bolt:A("Bolt",()=>e.jsx("path",{d:"M13 2L3 14h7l-1 8 10-12h-7z"})),Play:A("Play",()=>e.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})),Pause:A("Pause",()=>[e.jsx("rect",{x:"6",y:"4",width:"4",height:"16"},"pa1"),e.jsx("rect",{x:"14",y:"4",width:"4",height:"16"},"pa2")]),Stop:A("Stop",()=>e.jsx("rect",{x:"6",y:"6",width:"12",height:"12"})),Gear:A("Gear",()=>e.jsx("path",{d:"M20.59 13.41l1.41-1.41-2.83-2.83 1.41-1.41-1.41-1.41-1.41 1.41-2.83-2.83-1.41 1.41 2.83 2.83-1.41 1.41 1.41 1.41 1.41-1.41 2.83 2.83z"})),Code:A("Code",()=>[e.jsx("polyline",{points:"16 18 22 12 16 6"},"cd1"),e.jsx("polyline",{points:"8 6 2 12 8 18"},"cd2")]),Terminal:A("Terminal",()=>[e.jsx("path",{d:"M4 6h16"},"tm1"),e.jsx("path",{d:"M4 12l6 6"},"tm2"),e.jsx("path",{d:"M10 6l-6 6"},"tm3")]),Api:A("Api",()=>[e.jsx("path",{d:"M12 2v4"},"ap1"),e.jsx("path",{d:"M12 18v4"},"ap2"),e.jsx("path",{d:"M4 8h16"},"ap3"),e.jsx("path",{d:"M4 16h16"},"ap4")]),Robot:A("Robot",()=>[e.jsx("rect",{x:"7",y:"3",width:"10",height:"4",rx:"1"},"rb1"),e.jsx("rect",{x:"4",y:"7",width:"16",height:"12",rx:"2"},"rb2"),e.jsx("circle",{cx:"9",cy:"12",r:"1"},"rb3"),e.jsx("circle",{cx:"15",cy:"12",r:"1"},"rb4"),e.jsx("path",{d:"M8 21v2"},"rb5"),e.jsx("path",{d:"M16 21v2"},"rb6")]),Palette:A("Palette",()=>e.jsx("path",{d:"M12 3a9 9 0 1 0 9 9 3 3 0 0 1-3 3 3 3 0 1 1-3-3 9 9 0 0 0 0-18z"})),Paint:A("Paint",()=>[e.jsx("path",{d:"M2 22s4-4 6-4 4 4 8 0"},"pt1"),e.jsx("path",{d:"M20 12l-6 6"},"pt2"),e.jsx("path",{d:"M14 6l6 6"},"pt3")]),Printer:A("Printer",()=>[e.jsx("rect",{x:"6",y:"3",width:"12",height:"6",rx:"2"},"pr1"),e.jsx("rect",{x:"6",y:"11",width:"12",height:"10",rx:"2"},"pr2"),e.jsx("path",{d:"M9 14h6"},"pr3")]),Undo:A("Undo",()=>[e.jsx("path",{d:"M9 21V12H4"},"un1"),e.jsx("path",{d:"M20 7l-7-4v8"},"un2")]),Redo:A("Redo",()=>[e.jsx("path",{d:"M15 3v9h5"},"rd1"),e.jsx("path",{d:"M4 12l7 4V8"},"rd2")]),Duplicate:A("Duplicate",()=>[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2"},"dp1"),e.jsx("rect",{x:"2",y:"2",width:"13",height:"13",rx:"2"},"dp2")]),Copy:A("Copy",()=>[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2"},"cp1"),e.jsx("rect",{x:"2",y:"2",width:"13",height:"13",rx:"2"},"cp2")]),Paste:A("Paste",()=>[e.jsx("rect",{x:"9",y:"2",width:"13",height:"4",rx:"1"},"ps1"),e.jsx("rect",{x:"9",y:"8",width:"13",height:"14",rx:"2"},"ps2"),e.jsx("path",{d:"M5 8v14"},"ps3")]),Clipboard:A("Clipboard",()=>[e.jsx("path",{d:"M9 2h6a2 2 0 0 1 2 2v2H7V4a2 2 0 0 1 2-2z"},"cbp1"),e.jsx("rect",{x:"3",y:"6",width:"18",height:"16",rx:"2"},"cbp2")]),CheckCircle:A("CheckCircle",()=>[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"cc1"),e.jsx("path",{d:"M9 12l2 2 4-4"},"cc2")]),XCircle:A("XCircle",()=>[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"xc1"),e.jsx("path",{d:"M15 9l-6 6"},"xc2"),e.jsx("path",{d:"M9 9l6 6"},"xc3")]),Alert:A("Alert",()=>[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"},"al1"),e.jsx("path",{d:"M12 9v4"},"al2"),e.jsx("path",{d:"M12 17h.01"},"al3")]),Megaphone:A("Megaphone",()=>[e.jsx("path",{d:"M3 11v2a2 2 0 0 0 2 2h1l6 3V6L6 9H5a2 2 0 0 0-2 2z"},"mg1"),e.jsx("path",{d:"M21 8v8"},"mg2")]),Badge:A("Badge",()=>e.jsx("path",{d:"M12 2l3 7 7 1-5 5 1 7-6-4-6 4 1-7L2 10l7-1 3-7z"})),Ribbon:A("Ribbon",()=>[e.jsx("path",{d:"M6 2h12l-3 9H9L6 2z"},"rbn1"),e.jsx("path",{d:"M6 11v11l6-4 6 4V11"},"rbn2")]),Crown:A("Crown",()=>e.jsx("path",{d:"M2 22l4-8 4 4 4-10 4 10 4-4 0 8z"})),Trophy:A("Trophy",()=>e.jsx("path",{d:"M8 2h8v3a4 4 0 0 1 4 4v1a4 4 0 0 1-4 4h-1a6 6 0 0 1-10 0H6a4 4 0 0 1-4-4V9a4 4 0 0 1 4-4V2z"})),Medal:A("Medal",()=>[e.jsx("circle",{cx:"12",cy:"8",r:"6"},"md1"),e.jsx("path",{d:"M8 14l-2 6 6-3 6 3-2-6"},"md2")]),Gift:A("Gift",()=>[e.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2"},"gf1"),e.jsx("path",{d:"M12 7v14"},"gf2"),e.jsx("path",{d:"M2 13h20"},"gf3")]),Calculator:A("Calculator",()=>[e.jsx("rect",{x:"3",y:"2",width:"18",height:"20",rx:"2"},"cal1"),e.jsx("path",{d:"M7 6h10"},"cal2"),e.jsx("path",{d:"M7 10h10"},"cal3"),e.jsx("path",{d:"M7 14h2"},"cal4"),e.jsx("path",{d:"M11 14h2"},"cal5"),e.jsx("path",{d:"M15 14h2"},"cal6")]),Percent:A("Percent",()=>[e.jsx("circle",{cx:"7",cy:"7",r:"2"},"pc1"),e.jsx("circle",{cx:"17",cy:"17",r:"2"},"pc2"),e.jsx("path",{d:"M19 5L5 19"},"pc3")]),Receipt2:A("Receipt2",()=>[e.jsx("path",{d:"M21 10V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v5"},"r21"),e.jsx("path",{d:"M7 14h10"},"r22"),e.jsx("path",{d:"M7 18h6"},"r23")]),Banknote:A("Banknote",()=>[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"},"bn1"),e.jsx("circle",{cx:"12",cy:"12",r:"3"},"bn2")]),Truck:A("Truck",()=>[e.jsx("path",{d:"M1 3h15v13H1z"},"trc1"),e.jsx("path",{d:"M23 8v8h-4v-6h-4"},"trc2"),e.jsx("circle",{cx:"5.5",cy:"18.5",r:"1.5"},"trc3"),e.jsx("circle",{cx:"18.5",cy:"18.5",r:"1.5"},"trc4")]),Shipping:A("Shipping",()=>[e.jsx("path",{d:"M3 3h18v13H3z"},"sp1"),e.jsx("path",{d:"M16 3v13"},"sp2"),e.jsx("path",{d:"M7 21h10"},"sp3")]),MapPin:A("MapPin",()=>[e.jsx("path",{d:"M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1 1 18 0z"},"mp1"),e.jsx("circle",{cx:"12",cy:"10",r:"2.5"},"mp2")]),Globe:A("Globe",()=>[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"gl1"),e.jsx("path",{d:"M2 12h20"},"gl2"),e.jsx("path",{d:"M12 2a15 15 0 0 0 0 20"},"gl3")]),Language:A("Language",()=>[e.jsx("path",{d:"M2 12h20"},"lg1"),e.jsx("path",{d:"M12 2a15 15 0 0 0 0 20"},"lg2"),e.jsx("path",{d:"M6 6l12 12"},"lg3")]),Translate:A("Translate",()=>[e.jsx("path",{d:"M12 3v4"},"tr1"),e.jsx("path",{d:"M6 7h12"},"tr2"),e.jsx("path",{d:"M4 21h16"},"tr3"),e.jsx("path",{d:"M12 17l-4-8"},"tr4")]),Login:A("Login",()=>[e.jsx("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"},"lg1"),e.jsx("path",{d:"M10 17l5-5-5-5"},"lg2"),e.jsx("path",{d:"M15 12H3"},"lg3")]),Logout:A("Logout",()=>[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},"lo1"),e.jsx("path",{d:"M16 17l5-5-5-5"},"lo2"),e.jsx("path",{d:"M21 12H9"},"lo3")]),Power:A("Power",()=>[e.jsx("path",{d:"M18 7a7 7 0 1 1-12 0"},"pw1"),e.jsx("path",{d:"M12 2v10"},"pw2")]),Menu:A("Menu",()=>[e.jsx("path",{d:"M3 6h18"},"mn1"),e.jsx("path",{d:"M3 12h18"},"mn2"),e.jsx("path",{d:"M3 18h18"},"mn3")]),Close:A("Close",()=>[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"},"cl1"),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"},"cl2")]),Profile:A("Profile",()=>[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"},"pf1"),e.jsx("circle",{cx:"12",cy:"7",r:"4"},"pf2")]),HeaderLogo:A("HeaderLogo",()=>[e.jsx("circle",{cx:"12",cy:"12",r:"10"},"hl1"),e.jsx("path",{d:"M12 8v8"},"hl2"),e.jsx("path",{d:"M8 12h8"},"hl3")]),ChevronRight:A("ChevronRight",()=>e.jsx("polyline",{points:"9 6 15 12 9 18"})),ChevronLeft:A("ChevronLeft",()=>e.jsx("polyline",{points:"15 6 9 12 15 18"})),ChevronDown:A("ChevronDown",()=>e.jsx("polyline",{points:"6 9 12 15 18 9"})),ChevronUp:A("ChevronUp",()=>e.jsx("polyline",{points:"6 15 12 9 18 15"})),DotsVertical:A("DotsVertical",()=>[e.jsx("circle",{cx:"12",cy:"5",r:"1"},"dv1"),e.jsx("circle",{cx:"12",cy:"12",r:"1"},"dv2"),e.jsx("circle",{cx:"12",cy:"19",r:"1"},"dv3")]),DotsHorizontal:A("DotsHorizontal",()=>[e.jsx("circle",{cx:"5",cy:"12",r:"1"},"dh1"),e.jsx("circle",{cx:"12",cy:"12",r:"1"},"dh2"),e.jsx("circle",{cx:"19",cy:"12",r:"1"},"dh3")]),Heart:A("Heart",()=>e.jsx("path",{d:"M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8L12 21.2l8.8-8.8a5.5 5.5 0 0 0 0-7.8z"})),Puzzle:A("Puzzle",()=>[e.jsx("path",{d:"M15 3h4v4"},"pz1"),e.jsx("path",{d:"M3 9v6h6v6h6v-6h6V9H9V3H3v6z"},"pz2")])},{Dashboard:La,Analytics:Ea,Reports:Ra,Settings:Ia,Users:Ta,UserAdd:Da,Team:Fa,Product:za,Inventory:Aa,Cart:Oa,Order:$a,Invoice:Ua,Receipt:qa,Payment:Ba,CreditCard:Ha,Bank:Va,Wallet:Wa,CalendarCheck:Ga,CalendarPlus:Ka,Clock:Ya,Notification:Xa,Bell:Ja,Message:Qa,Chat:Za,File:ei,Folder:ti,FolderOpen:si,UploadCloud:ai,DownloadCloud:ii,Cloud:ni,Sync:li,Refresh:Gt,Search:ri,Filter:oi,SortAsc:di,Plus:ci,Minus:mi,Edit:ui,Save:hi,Archive:pi,Delete:xi,Trash:gi,Lock:fi,Unlock:vi,Shield:bi,Key:ji,Tag:yi,Label:wi,Barcode:_i,QR:Ni,Map:ki,Location:Si,Pin:Ci,Home:Mi,Help:Pi,InfoCircle:Li,Star:Ei,Favorite:Ri,Eye:Ii,EyeOff:Ti,ChartLine:Di,ChartBar:Fi,PieChart:zi,Grid:Ai,Table:Oi,Columns:$i,Rows:Ui,Link:qi,Bolt:Bi,Play:Hi,Pause:Vi,Stop:Wi,Gear:Gi,Code:Ki,Terminal:Yi,Api:Xi,Robot:Ji,Palette:Qi,Paint:Zi,Printer:en,Undo:tn,Redo:sn,Duplicate:an,Copy:nn,Paste:ln,Clipboard:rn,CheckCircle:on,XCircle:dn,Alert:cn,Megaphone:mn,Badge:un,Ribbon:hn,Crown:pn,Trophy:xn,Medal:gn,Gift:fn,Calculator:vn,Percent:bn,Receipt2:jn,Banknote:yn,Truck:wn,Shipping:_n,MapPin:Nn,Globe:kn,Language:Sn,Translate:Cn,Login:Mn,Logout:Pn,Power:Ln,Menu:En,Close:Rn,Profile:In,HeaderLogo:Tn,ChevronRight:Dn,ChevronLeft:Fn,ChevronDown:zn,ChevronUp:An,DotsVertical:On,DotsHorizontal:$n,Heart:Un,Puzzle:qn}=Ae,Ut=Object.freeze(Object.defineProperty({__proto__:null,Alert:cn,Analytics:Ea,Api:Xi,Archive:pi,Badge:un,Bank:Va,Banknote:yn,Barcode:_i,Bell:Ja,Bolt:Bi,Calculator:vn,CalendarCheck:Ga,CalendarPlus:Ka,Cart:Oa,ChartBar:Fi,ChartLine:Di,Chat:Za,CheckCircle:on,ChevronDown:zn,ChevronLeft:Fn,ChevronRight:Dn,ChevronUp:An,Clipboard:rn,Clock:Ya,Close:Rn,Cloud:ni,Code:Ki,Columns:$i,Copy:nn,CreditCard:Ha,Crown:pn,Dashboard:La,Delete:xi,DotsHorizontal:$n,DotsVertical:On,DownloadCloud:ii,Duplicate:an,ERPIcons:Ae,Edit:ui,Eye:Ii,EyeOff:Ti,Favorite:Ri,File:ei,Filter:oi,Folder:ti,FolderOpen:si,Gear:Gi,Gift:fn,Globe:kn,Grid:Ai,HeaderLogo:Tn,Heart:Un,Help:Pi,Home:Mi,InfoCircle:Li,Inventory:Aa,Invoice:Ua,Key:ji,Label:wi,Language:Sn,Link:qi,Location:Si,Lock:fi,Login:Mn,Logout:Pn,Map:ki,MapPin:Nn,Medal:gn,Megaphone:mn,Menu:En,Message:Qa,Minus:mi,Notification:Xa,Order:$a,Paint:Zi,Palette:Qi,Paste:ln,Pause:Vi,Payment:Ba,Percent:bn,PieChart:zi,Pin:Ci,Play:Hi,Plus:ci,Power:Ln,Printer:en,Product:za,Profile:In,Puzzle:qn,QR:Ni,Receipt:qa,Receipt2:jn,Redo:sn,Refresh:Gt,Reports:Ra,Ribbon:hn,Robot:Ji,Rows:Ui,Save:hi,Search:ri,Settings:Ia,Shield:bi,Shipping:_n,SortAsc:di,Star:Ei,Stop:Wi,Sync:li,Table:Oi,Tag:yi,Team:Fa,Terminal:Yi,Translate:Cn,Trash:gi,Trophy:xn,Truck:wn,Undo:tn,Unlock:vi,UploadCloud:ai,UserAdd:Da,Users:Ta,Wallet:Wa,XCircle:dn,default:Ae},Symbol.toStringTag,{value:"Module"}));function us(){return e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":!0,children:[e.jsx("rect",{width:"24",height:"24",rx:"4",fill:"#e6eef8"}),e.jsx("path",{d:"M7 12h10",stroke:"#8b9bb0",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 8h10",stroke:"#8b9bb0",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}function at({title:t,value:a,hint:r,iconName:u,iconElement:v,index:M=0}){let S=null;if(v)S=v;else if(u&&Ut&&Ut[u]){const L=Ut[u];try{S=e.jsx(L,{style:{width:18,height:18}})}catch{S=e.jsx(us,{})}}else S=e.jsx(us,{});return e.jsxs(rt.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.35,delay:M*.06,ease:"easeOut"},whileHover:{scale:1.02},whileTap:{scale:.995},className:"bg-white rounded-xl border border-slate-100 shadow-sm p-4 flex items-start gap-4",role:"group","aria-label":`KPI ${t}`,children:[e.jsx("div",{className:"w-12 h-12 flex items-center justify-center rounded-md shrink-0",style:{background:"linear-gradient(135deg,#f0f9ff,#fff7ed)"},children:S}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-slate-500",children:t}),e.jsx("div",{className:"text-2xl font-semibold text-slate-900 truncate",children:a}),r&&e.jsx("div",{className:"text-xs text-slate-400 mt-1 truncate",children:r})]})]})}function Bn({summary:t=null,onRefresh:a=null,className:r=""}){var D,q,$,ae,F,ce,ne,J,le,Q,pe;const[u,v]=s.useState(t||null),[M,S]=s.useState(!t),[L,g]=s.useState(null),R=s.useCallback(async()=>{var re;S(!0),g(null);try{const O=await E.get("/api/dashboard/summary"),de=(re=O==null?void 0:O.data)!=null&&re.data?O.data.data:(O==null?void 0:O.data)||{};v(de||{})}catch(O){console.error("KPIGrid load",O),g((O==null?void 0:O.message)||"Failed to load KPIs")}finally{S(!1)}},[]);s.useEffect(()=>{t&&(v(t),S(!1),g(null))},[t]),s.useEffect(()=>{if(t)return;let re=null;return R(),re=setInterval(R,12e4),()=>{re&&clearInterval(re)}},[t,R]);const h=async()=>{if(typeof a=="function")try{await a()}catch(re){console.warn("parent onRefresh failed, falling back to internal load",re),await R()}else await R()},w=u||{};return e.jsxs("div",{className:`kpi-grid ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Overview"}),e.jsx("div",{children:e.jsxs("button",{onClick:h,title:"Refresh KPIs",className:"inline-flex items-center gap-2 px-2 py-1 text-xs rounded border bg-white shadow-sm",children:[Gt?e.jsx(Gt,{style:{width:14,height:14}}):"↻",e.jsx("span",{className:"sr-only",children:"Refresh"})]})})]}),M&&!t&&e.jsx("div",{className:"w-full py-10 text-center text-slate-500",children:"Loading…"}),!M&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(at,{index:0,title:"Inquiries",value:((D=w.inquiries)==null?void 0:D.total)??0,hint:`New ${((q=w.inquiries)==null?void 0:q.total_new)??0} · Contacted ${(($=w.inquiries)==null?void 0:$.total_contacted)??0} · Converted ${((ae=w.inquiries)==null?void 0:ae.total_converted)??0}`,iconName:"Message"}),e.jsx(at,{index:1,title:"Orders",value:((F=w.orders)==null?void 0:F.total)??0,hint:`Draft ${((ce=w.orders)==null?void 0:ce.total_draft)??0} · Confirmed ${((ne=w.orders)==null?void 0:ne.total_confirmed)??0}`,iconName:"Order"}),e.jsx(at,{index:2,title:"Total Strength",value:((J=w.strength)==null?void 0:J.total_students)??w.strength_total_students??0,hint:`${((le=w.strength)==null?void 0:le.total_schools)??w.strength_total_schools??0} schools`,iconName:"Analytics"}),e.jsx(at,{index:3,title:"Faculties",value:w.faculties??0,hint:`Present today: ${w.faculty_attendance_today??0}`,iconName:"Users"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:[e.jsx(at,{index:4,title:"Courses",value:w.courses??0,hint:"Active courses",iconName:"File"}),e.jsx(at,{index:5,title:"Books",value:w.books??0,hint:"Catalogue books",iconName:"File"}),e.jsx(at,{index:6,title:"Videos",value:w.videos??0,hint:"Uploaded videos",iconName:"Play"}),e.jsx(at,{index:7,title:"Payments Received",value:((Q=w.payments)==null?void 0:Q.total)??w.total_payments??0,hint:`This month: ${((pe=w.payments)==null?void 0:pe.this_month)??w.payments_this_month??0}`,iconName:"Coin"})]})]}),L&&e.jsxs("div",{className:"mt-3 text-sm text-rose-600",children:["KPI load error: ",L]})]})}const tt={primary:"#0ea5a4",accent:"#6366f1",danger:"#ef4444",gold:"#f59e0b",slate:"#64748b",green:"#10b981"};function Pt({children:t,className:a=""}){const[r,u]=s.useState(!1);return s.useEffect(()=>{u(!0)},[]),e.jsx("div",{className:`w-full min-w-0 h-[300px] md:h-[350px] lg:h-[400px] ${a}`,style:{minWidth:0,minHeight:300},role:"region","aria-hidden":!r,children:r?t:e.jsx("div",{style:{width:"100%",height:"100%"}})})}function zs({days:t=30,className:a=""}){const[r,u]=s.useState([]),[v,M]=s.useState(!0);async function S(){var L;M(!0);try{const g=await E.get("/api/dashboard/orders/trends",{query:{days:t}}),R=(L=g==null?void 0:g.data)!=null&&L.data?g.data.data:(g==null?void 0:g.data)||[];u((R||[]).map(h=>({...h,date:h.date||h.year_month||h.od||Object.values(h)[0]})))}catch(g){console.error("orders trend load",g),u([])}finally{M(!1)}}return s.useEffect(()=>{S()},[t]),e.jsxs("div",{className:`panel bg-white rounded-xl border p-4 ${a}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold",children:["Orders (last ",t," days)"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Daily orders — animated trend"})]}),e.jsx("div",{className:"text-xs text-slate-500",children:v?"Loading…":`${r.length} points`})]}),e.jsx(Pt,{children:e.jsx(kt,{width:"100%",height:"100%",children:e.jsxs(ha,{data:r,children:[e.jsx(Rs,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),e.jsx(Is,{dataKey:"date",tick:{fontSize:11}}),e.jsx(Ts,{tick:{fontSize:11}}),e.jsx(St,{}),e.jsx(pa,{type:"monotone",dataKey:"orders",stroke:tt.primary,strokeWidth:2,dot:!1}),e.jsx(xa,{type:"monotone",dataKey:"orders",fill:tt.primary,fillOpacity:.08,stroke:"transparent"})]})})})]})}function As({className:t=""}){const[a,r]=s.useState(null),[u,v]=s.useState(!0);async function M(){var h;v(!0);try{const w=await E.get("/api/dashboard/summary"),D=(h=w==null?void 0:w.data)!=null&&h.data?w.data.data:(w==null?void 0:w.data)||{};r(D)}catch(w){console.error("InquiriesPie load",w),r({})}finally{v(!1)}}s.useEffect(()=>{M()},[]);const S=(a==null?void 0:a.inquiries)||{},L=(a==null?void 0:a.orders)||{},g=[{name:"New",value:S.total_new||0,color:tt.primary},{name:"Contacted",value:S.total_contacted||0,color:tt.accent},{name:"Converted",value:S.total_converted||0,color:tt.gold}],R=[{name:"Draft",value:L.total_draft||0,color:tt.slate},{name:"Confirmed",value:L.total_confirmed||0,color:tt.green}];return e.jsxs("div",{className:`panel bg-white rounded-xl border p-4 ${t}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Inquiries & Orders Breakdown"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Donut for inquiries and compact donut for orders"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-center",children:[e.jsx(Pt,{className:"col-span-2 lg:col-span-1",children:e.jsx(kt,{width:"100%",height:"100%",children:e.jsxs(is,{children:[e.jsx(ns,{data:g,dataKey:"value",nameKey:"name",innerRadius:36,outerRadius:80,paddingAngle:4,label:!0,children:g.map((h,w)=>e.jsx(ls,{fill:h.color},w))}),e.jsx(St,{})]})})}),e.jsx(Pt,{className:"col-span-2 lg:col-span-1",children:e.jsx(kt,{width:"100%",height:"100%",children:e.jsxs(is,{children:[e.jsx(ns,{data:R,dataKey:"value",nameKey:"name",innerRadius:20,outerRadius:54,children:R.map((h,w)=>e.jsx(ls,{fill:h.color},w))}),e.jsx(St,{})]})})})]})]})}function Os({className:t=""}){const[a,r]=s.useState([]),[u,v]=s.useState(!0);async function M(){var S;v(!0);try{const L=await E.get("/api/dashboard/cashflow",{query:{from:null,to:null}}),g=(S=L==null?void 0:L.data)!=null&&S.data?L.data.data:(L==null?void 0:L.data)||[];r((g||[]).slice(-12))}catch(L){console.error("PaymentsExpensesChart load",L),r([])}finally{v(!1)}}return s.useEffect(()=>{M()},[]),e.jsxs("div",{className:`panel bg-white rounded-xl border p-4 ${t}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Payments vs Expenses (monthly)"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Last 12 months"})]})}),e.jsx(Pt,{children:e.jsx(kt,{width:"100%",height:"100%",children:e.jsxs(ga,{data:a,children:[e.jsx(Rs,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),e.jsx(Is,{dataKey:"year_month",tick:{fontSize:11}}),e.jsx(Ts,{tick:{fontSize:11}}),e.jsx(St,{}),e.jsx(fa,{}),e.jsx(rs,{dataKey:"payments",name:"Payments",fill:tt.primary}),e.jsx(rs,{dataKey:"expenses",name:"Expenses",fill:tt.danger})]})})})]})}function $s({level:t="state",limit:a=8,className:r=""}){const[u,v]=s.useState([]),[M,S]=s.useState(!0);async function L(){var R;S(!0);try{const h=await E.get("/api/dashboard/geo-strength",{query:{level:t}}),w=(R=h==null?void 0:h.data)!=null&&R.data?h.data.data:(h==null?void 0:h.data)||[];v((w||[]).slice(0,a))}catch(h){console.error("GeoStrengthPanel load",h),v([])}finally{S(!1)}}s.useEffect(()=>{L()},[t]);const g=Math.max(...u.map(R=>R.students||0),1);return e.jsxs("div",{className:`panel bg-white rounded-xl border p-4 ${r}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold",children:["Top ",t==="district"?"Districts":"States"," by Strength"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Schools & students distribution"})]})}),e.jsxs("div",{className:"space-y-3",children:[u.length===0&&e.jsx("div",{className:"text-sm text-slate-400",children:"No data"}),u.map((R,h)=>{const w=R.state_name||R.district_name||R.city||`#${h+1}`,D=R.students||0,q=Math.round(D/g*100);return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 text-sm text-slate-600",children:h+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-sm font-medium text-slate-800 truncate",children:w}),e.jsx("div",{className:"text-sm text-slate-500",children:D})]}),e.jsx("div",{className:"mt-1 h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{style:{width:`${q}%`,height:"100%",background:"linear-gradient(90deg,#0ea5a4,#6366f1)"}})})]})]},h)})]})]})}function Hn({className:t=""}){return e.jsxs("section",{className:`dashboard-charts space-y-4 ${t}`,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(zs,{days:30})}),e.jsx("div",{children:e.jsx(As,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Os,{})}),e.jsx("div",{children:e.jsx($s,{level:"state"})})]})]})}function Vn(){const[t,a]=s.useState(null),[r,u]=s.useState(!0),[v,M]=s.useState(null);async function S(){var g;u(!0),M(null);try{const R=await E.get("/api/dashboard/summary"),h=(g=R==null?void 0:R.data)!=null&&g.data?R.data.data:(R==null?void 0:R.data)||{};a(h||{})}catch(R){console.error("loadSummary",R),M((R==null?void 0:R.message)||"Failed to load summary"),a(null)}finally{u(!1)}}s.useEffect(()=>{S();const g=setInterval(S,12e4);return()=>clearInterval(g)},[]);const L=async()=>{await S()};return e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-10",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"Admin Dashboard"}),e.jsx("div",{className:"text-sm text-slate-500 mt-1",children:"Overview — inquiries, orders, strength, catalogue & finance."})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:S,className:"inline-flex items-center gap-2 px-3 py-2 rounded-md border bg-white text-sm text-slate-700 shadow-sm",title:"Refresh dashboard summary",children:[Ae.Refresh?e.jsx(Ae.Refresh,{style:{width:16,height:16}}):null,"Refresh"]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx(Bn,{summary:t,onRefresh:L})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(zs,{days:30})}),e.jsx("div",{children:e.jsx(As,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Os,{})}),e.jsx("div",{children:e.jsx($s,{level:"state"})})]}),e.jsx("div",{children:e.jsx(Hn,{})})]}),v&&e.jsxs("div",{className:"mt-4 p-3 rounded bg-rose-50 border border-rose-100 text-rose-700",children:["Dashboard summary failed to load: ",v]}),e.jsx("div",{className:"mt-8 text-xs text-slate-400",children:"Tip: charts are responsive. If any chart warns about size, check parent container CSS (ensure no `display:none` or collapsed height when rendering)."})]})}function Wn(){return e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"Faculty Dashboard"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Placeholder faculty dashboard. Add attendance, lesson plans, tasks here."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-white rounded shadow",children:"Today's classes: —"}),e.jsx("div",{className:"p-4 bg-white rounded shadow",children:"Pending assignments: —"})]})]})}function Gn(){return e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-10",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-4",children:"School Dashboard"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"Placeholder school dashboard. Replace with school-specific metrics."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"p-4 bg-white rounded shadow",children:"Students: —"}),e.jsx("div",{className:"p-4 bg-white rounded shadow",children:"Teachers: —"})]})]})}function hs({name:t,color:a="currentColor",size:r=18,className:u=""}){const M={dashboard:Ae.Dashboard,schools:Ae.FolderOpen,inquiries:Ae.Message,orders:Ae.Order,strength:Ae.Analytics,faculty:Ae.Users,academics:Ae.CalendarCheck,timetable:Ae.CalendarPlus,classes:Ae.Grid,courses:Ae.File,books:Ae.File,videos:Ae.Play,reports:Ae.Reports,"report-item":Ae.File}[t]||Ae.Dashboard;return e.jsx(M,{width:r,height:r,style:{color:a},className:u,"aria-hidden":"true"})}function Us({className:t="",onClose:a}={}){const{user:r}=gt(),u=Kt();let v=[];try{v=JSON.parse(localStorage.getItem("permissions")||"[]")}catch{v=[]}const M=((r==null?void 0:r.role_name)||(r==null?void 0:r.role)||"").toString().toLowerCase();function S(){return M.includes("admin")||M.includes("super")||M.includes("manager")}const[L,g]=s.useState({schools:!0,academics:!1,reports:!1,faculty:!1,strength:!1});s.useEffect(()=>{const $=u.pathname;$.startsWith("/admin/schools")||$.startsWith("/admin/inquiries")||$.startsWith("/admin/orders")?g({schools:!0,academics:!1,reports:!1,faculty:!1,strength:!1}):$.startsWith("/admin/academics")?g({schools:!1,academics:!0,reports:!1,faculty:!1,strength:!1}):$.startsWith("/admin/reports")?g({schools:!1,academics:!1,reports:!0,faculty:!1,strength:!1}):$.startsWith("/admin/faculty")?g({schools:!1,academics:!1,reports:!1,faculty:!0,strength:!1}):$.startsWith("/admin/strength")&&g({schools:!1,academics:!1,reports:!1,faculty:!1,strength:!0})},[u.pathname]);function R($){g(ae=>{if(!!ae[$])return{schools:!1,academics:!1,reports:!1,faculty:!1,strength:!1};const ce={schools:!1,academics:!1,reports:!1,faculty:!1,strength:!1};return ce[$]=!0,ce})}function h(){typeof a=="function"&&a()}function w({to:$,children:ae,indent:F=!1,iconName:ce,iconColor:ne="#64748b"}){const J=u.pathname===$;return e.jsxs(Nt,{to:$,onClick:h,className:`navlink ${F?"navlink-indent":""} ${J?"navlink-active":""}`,"aria-current":J?"page":void 0,children:[ce&&e.jsx("span",{className:"navlink-icon","aria-hidden":!0,children:e.jsx("span",{className:"navlink-icon-inner",children:e.jsx(hs,{name:ce,color:ne,size:18})})}),e.jsx("span",{className:"navlink-label",children:ae})]})}function D({id:$,title:ae,iconName:F,accent:ce="#0ea5a3"}){return e.jsxs("button",{onClick:()=>R($),className:"section-header","aria-expanded":!!L[$],"aria-controls":`section-${$}`,type:"button",children:[e.jsxs("div",{className:"section-left",children:[e.jsx(hs,{name:F,color:ce,size:18,className:"section-icon"}),e.jsx("span",{className:"section-title",children:ae})]}),e.jsx("svg",{className:`chev ${L[$]?"chev-open":""}`,width:"16",height:"16",viewBox:"0 0 20 20",fill:"none","aria-hidden":!0,children:e.jsx("path",{d:"M6 6L14 10L6 14V6Z",stroke:"currentColor",strokeWidth:"1.4",strokeLinecap:"round",strokeLinejoin:"round"})})]})}const q={schools:"#ef4444",faculty:"#10b981",academics:"#6366f1",reports:"#f59e0b",strength:"#a78bfa",dashboard:"#0ea5a3",inquiries:"#06b6d4",orders:"#fb923c"};return e.jsxs("aside",{className:`sidebar ${t}`,"aria-label":"Main navigation",children:[e.jsx("style",{children:`
        /* Sidebar surface */
        .sidebar {
          position: relative;
          width: 280px;
          min-width: 240px;
          max-width: 340px;
          background: linear-gradient(180deg, #fbfdff 0%, #f7fbff 100%);
          border-right: 1px solid rgba(15,23,42,0.04);
          padding: 18px;
          box-sizing: border-box;
          color: #0f172a;
          font-size: 15px;
          line-height: 1.35;
          box-shadow: 0 6px 18px rgba(11,34,80,0.03);
          overflow: auto;
          z-index: 1200;           /* keep it above typical app layers */
          pointer-events: auto;    /* ensure it accepts clicks */
        }

        /* ensure interactive content is above any decorative or accidental overlays */
        .sidebar .content {
          position: relative;
          z-index: 1201;
          pointer-events: auto;
        }

        .user-meta { padding-bottom: 12px; border-bottom: 1px solid rgba(15,23,42,0.03); margin-bottom: 14px; }
        .user-meta .label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
        .user-meta .name { font-weight: 600; font-size: 16px; color: #071233; margin-bottom: 2px; }
        .user-meta .role { font-size: 12px; color: #94a3b8; }

        .section-header {
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 6px 6px;
          background: transparent;
          border: none;
          cursor: pointer;
          margin-bottom: 6px;
        }
        .section-left { display:flex; align-items:center; gap:10px; }
        .section-title { font-size: 11px; letter-spacing: 0.08em; color: #475569; text-transform: uppercase; font-weight: 600; }
        .section-icon { border-radius: 6px; padding: 4px; }

        .chev { color: #94a3b8; transition: transform .18s ease; }
        .chev-open { transform: rotate(90deg); }

        .section-panel { overflow: hidden; transition: max-height .26s cubic-bezier(.2,.9,.2,1), opacity .26s ease; }
        .section-panel.max { max-height: 640px; opacity: 1; }
        .section-panel.min { max-height: 0; opacity: 0; }

        .navlink {
          display:flex;
          align-items:center;
          gap:10px;
          padding: 9px 8px;
          border-radius: 8px;
          color: #0f172a;
          text-decoration: none;
          margin: 6px 2px;
          transition: background .14s ease, transform .12s ease;
          cursor: pointer;
        }
        .navlink:hover { background: rgba(11,110,255,0.03); transform: translateX(4px); }
        .navlink-indent { padding-left: 40px; font-size: 14px; }
        .navlink-icon { width: 28px; min-width: 28px; display:flex; align-items:center; justify-content:center; }
        .navlink-icon-inner { display:inline-flex; transition: transform .16s ease; }
        .navlink:hover .navlink-icon-inner { transform: translateX(3px) scale(1.02); }
        .navlink-label { font-size: 15px; color: #0f172a; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .navlink-active {
          background: linear-gradient(90deg, rgba(11,110,255,0.06), rgba(14,165,163,0.035));
          box-shadow: inset 0 1px 0 rgba(255,255,255,0.4);
          font-weight: 700;
          color: #03263f;
        }

        @media (max-width: 920px) {
          .sidebar { width: 100%; position: relative; max-width: none; padding: 14px; z-index: 1200; }
        }
      `}),e.jsxs("div",{className:"content",children:[e.jsxs("div",{className:"user-meta",role:"region","aria-label":"User information",children:[e.jsx("div",{className:"label",children:"Signed in as"}),e.jsx("div",{className:"name",children:(r==null?void 0:r.username)||(r==null?void 0:r.employee_name)||(r==null?void 0:r.name)||"User"}),e.jsx("div",{className:"role",children:M||"—"})]}),S()?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginBottom:10},children:e.jsx(w,{to:"/dashboard/admin",iconName:"dashboard",iconColor:q.dashboard,children:"Dashboard"})}),e.jsxs("div",{children:[e.jsx(D,{id:"schools",title:"Schools",iconName:"schools",accent:q.schools}),e.jsxs("div",{id:"section-schools",className:`section-panel ${L.schools?"max":"min"}`,"aria-hidden":!L.schools,children:[e.jsx(w,{to:"/admin/schools",iconName:"schools",iconColor:q.schools,children:"School List"}),e.jsx("div",{style:{marginTop:8,marginLeft:6,marginBottom:6,fontSize:11,color:"#9aa4b2",textTransform:"uppercase"},children:"School actions"}),e.jsx(w,{to:"/admin/inquiries",indent:!0,iconName:"inquiries",iconColor:q.inquiries,children:"Inquiry Management"}),e.jsx(w,{to:"/admin/strengths",indent:!0,iconName:"strength",iconColor:q.strength,children:"Strength & Requirements"}),e.jsx(w,{to:"/admin/orders",indent:!0,iconName:"orders",iconColor:q.orders,children:"Orders Management"})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(D,{id:"faculty",title:"Faculty",iconName:"faculty",accent:q.faculty}),e.jsxs("div",{id:"section-faculty",className:`section-panel ${L.faculty?"max":"min"}`,"aria-hidden":!L.faculty,children:[e.jsx(w,{to:"/admin/faculty",iconName:"faculty",iconColor:q.faculty,children:"Faculty List"}),e.jsx(w,{to:"/admin/faculty/assign",indent:!0,iconName:"faculty",iconColor:q.faculty,children:"Faculty Assignment"})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(D,{id:"academics",title:"Academics",iconName:"academics",accent:q.academics}),e.jsxs("div",{id:"section-academics",className:`section-panel ${L.academics?"max":"min"}`,"aria-hidden":!L.academics,children:[e.jsx(w,{to:"/admin/academics/timetables",iconName:"timetable",iconColor:q.academics,children:"Time-Tables"}),e.jsx(w,{to:"/admin/academics/class-sessions",iconName:"classes",iconColor:q.academics,children:"Class Sessions"}),e.jsx(w,{to:"/admin/academics/courses",iconName:"courses",iconColor:q.academics,children:"Courses"}),e.jsx(w,{to:"/admin/academics/books",iconName:"books",iconColor:q.academics,children:"Books"}),e.jsx(w,{to:"/admin/academics/videos",iconName:"videos",iconColor:q.academics,children:"Videos"})]})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(D,{id:"reports",title:"Reports",iconName:"reports",accent:q.reports}),e.jsxs("div",{id:"section-reports",className:`section-panel ${L.reports?"max":"min"}`,"aria-hidden":!L.reports,children:[e.jsx(w,{to:"/admin/reports/faculty-attendance",iconName:"report-item",iconColor:q.reports,children:"Faculty Attendance"}),e.jsx(w,{to:"/admin/reports/faculty-progress",iconName:"report-item",iconColor:q.reports,children:"Faculty Progress"}),e.jsx(w,{to:"/admin/reports/school-inquiries",iconName:"report-item",iconColor:q.reports,children:"School Inquiries"}),e.jsx(w,{to:"/admin/reports/school-orders",iconName:"report-item",iconColor:q.reports,children:"School Orders"}),e.jsx(w,{to:"/admin/reports/syllabus-status",iconName:"report-item",iconColor:q.reports,children:"Syllabus Status"})]})]})]}):e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:12,textTransform:"uppercase",color:"#9aa4b2",marginBottom:8},children:"Navigation"}),e.jsx(w,{to:"/dashboard",iconName:"dashboard",iconColor:q.dashboard,children:"Dashboard"}),e.jsx(w,{to:"/profile",iconName:"faculty",iconColor:q.faculty,children:"Profile"})]})]})]})}const Je=(...t)=>t.filter(Boolean).join(" "),ps={sm:"text-sm px-3 py-2 rounded-md",md:"text-base px-4 py-2.5 rounded-lg",lg:"text-lg px-5 py-3 rounded-xl"},K=({id:t,label:a,help:r,required:u=!1,error:v,children:M,className:S="",inlineLabel:L=!1})=>e.jsxs("div",{className:Je("group",S),children:[a&&e.jsx("label",{htmlFor:t,className:Je("block text-sm font-medium transition-colors",L?"mb-0":"mb-2 text-slate-700"),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a}),u&&e.jsx("span",{className:"text-rose-600",children:"*"}),v&&e.jsx("span",{className:"ml-2 text-xs text-rose-600",children:v})]})}),e.jsx("div",{className:Je("relative"),children:M}),r&&!v&&e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:r})]}),It=(t,a)=>Je("w-full bg-white/80 backdrop-blur-sm border transition focus:outline-none shadow-[0_6px_18px_rgba(2,6,23,0.06)]",ps[t]||ps.md,"placeholder:text-slate-400",a==="error"?"border-rose-200 ring-rose-100 focus:ring-2":"border-slate-200 focus:ring-2 ring-sky-100"),ze=lt.forwardRef(({id:t,value:a,defaultValue:r,onChange:u,placeholder:v="",disabled:M=!1,icon:S,clearable:L=!1,type:g="text",ariaLabel:R,className:h="",size:w="md",status:D,prefix:q,suffix:$,autoFocus:ae=!1,...F},ce)=>{const[ne,J]=s.useState(a??r??"");s.useEffect(()=>{a!==void 0&&J(a)},[a]);const le=ce||s.useRef(),Q=re=>{J(re.target.value),u&&u(re.target.value,re)},pe=re=>{re&&re.stopPropagation(),J(""),u&&u("",null),le.current&&le.current.focus()};return e.jsxs("div",{className:Je("relative flex items-center",M?"opacity-60":""),children:[q&&e.jsx("div",{className:"mr-2 select-none text-slate-600",children:q}),S&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx(rt.input,{ref:le,id:t,type:g,value:ne,autoFocus:ae,onChange:Q,placeholder:v,disabled:M,"aria-label":R,className:Je(It(w,D),S?"pl-10":"",L?"pr-10":"",h),whileFocus:{scale:1},...F}),L&&ne&&e.jsx("button",{"aria-label":"Clear",onClick:pe,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700",children:"✕"}),$&&e.jsx("div",{className:"ml-2 select-none text-slate-600",children:$})]})}),ht=lt.forwardRef(({id:t,value:a,defaultValue:r,onChange:u,placeholder:v="",rows:M=4,className:S="",size:L="md",status:g,...R},h)=>{const[w,D]=s.useState(a??r??"");s.useEffect(()=>{a!==void 0&&D(a)},[a]);const q=$=>{D($.target.value),u&&u($.target.value,$)};return e.jsx(rt.textarea,{id:t,ref:h,value:w,onChange:q,placeholder:v,rows:M,className:Je(It(L,g),"min-h-[120px]",S),...R})}),Te=({id:t,value:a,defaultValue:r,onChange:u,options:v=[],placeholder:M="Select...",disabled:S=!1,className:L="",multiple:g=!1,size:R="md",status:h})=>{const[w,D]=s.useState(a??r??(g?[]:""));s.useEffect(()=>{a!==void 0&&D(a)},[a]);const q=$=>{const ae=g?Array.from($.target.selectedOptions).map(F=>F.value):$.target.value;D(ae),u&&u(ae,$)};return e.jsxs("div",{className:"relative",children:[e.jsxs("select",{id:t,value:w,onChange:q,disabled:S,multiple:g,className:Je(It(R,h),"appearance-none pr-10",L),children:[!g&&e.jsx("option",{value:"",children:M}),v.map(($,ae)=>e.jsx("option",{value:$.value??$,children:$.label??$.value??$},$.value??$))]}),e.jsx("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:"▾"})]})},Lt=({checked:t,defaultChecked:a,onChange:r,id:u,className:v=""})=>{const[M,S]=s.useState(t??a??!1);s.useEffect(()=>{t!==void 0&&S(t)},[t]);const L=()=>{const g=!M;S(g),r&&r(g)};return e.jsx("button",{id:u,role:"switch","aria-checked":M,onClick:L,className:Je("relative inline-flex items-center h-7 w-12 rounded-full transition focus:outline-none",M?"bg-gradient-to-r from-sky-500 to-cyan-500 shadow-lg":"bg-slate-200",v),children:e.jsx(rt.span,{layout:!0,className:Je("block w-5 h-5 bg-white rounded-full shadow transform"),style:{marginLeft:M?22:4}})})},Et=({id:t,value:a,defaultValue:r,onChange:u,className:v=""})=>{const[M,S]=s.useState(a??r??"");s.useEffect(()=>{a!==void 0&&S(a)},[a]);const L=g=>{S(g.target.value),u&&u(g.target.value,g)};return e.jsx("input",{id:t,type:"date",value:M,onChange:L,className:Je(It("md"),v)})},qs=({id:t,onChange:a,accept:r="*",multiple:u=!1,className:v="",buttonLabel:M="Choose file"})=>{const S=s.useRef(),[L,g]=s.useState(!1),R=D=>{var $,ae;try{D&&D.preventDefault()}catch{}try{D&&D.stopPropagation()}catch{}const q=D&&((($=D.target)==null?void 0:$.files)||((ae=D.dataTransfer)==null?void 0:ae.files))||[];a&&a(q,D)},h=D=>{g(!1),R(D)},w=D=>{D&&D.stopPropagation(),S.current&&typeof S.current.click=="function"&&S.current.click()};return e.jsxs("div",{onClick:D=>D.stopPropagation(),onMouseDown:D=>D.stopPropagation(),onDragOver:D=>{D.preventDefault(),D.stopPropagation(),g(!0)},onDragLeave:D=>{D.stopPropagation(),g(!1)},onDrop:h,className:Je("rounded-lg border-dashed p-4 text-center transition",L?"border-sky-300 bg-sky-50":"border-slate-200 bg-white",v),children:[e.jsx("input",{id:t,ref:S,type:"file",accept:r,multiple:u,onChange:R,className:"hidden",onClick:D=>D.stopPropagation(),onMouseDown:D=>D.stopPropagation()}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",className:"text-slate-400",children:[e.jsx("path",{d:"M12 3v12",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}),e.jsx("path",{d:"M8 7l4-4 4 4",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]}),e.jsxs("div",{className:"text-sm",children:["Drag & drop files here, or"," ",e.jsx("button",{type:"button",onMouseDown:D=>{D&&D.stopPropagation&&D.stopPropagation()},onClick:w,className:"text-sky-500 underline",children:"browse"})]}),e.jsx("div",{className:"text-xs text-slate-400",children:u?"Multiple files allowed":"Single file"})]})]})},ot=(...t)=>t.filter(Boolean).join(" "),Kn={sm:"text-xs px-2.5 py-1.5 rounded-md",md:"text-sm px-3 py-2 rounded-md",lg:"text-base px-4 py-2.5 rounded-lg"},Yn=t=>e.jsxs("svg",{viewBox:"0 0 24 24",width:"20",height:"20",...t,children:[e.jsx("path",{d:"M4 6h2v8a2 2 0 0 0 2 2h8",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"}),e.jsx("path",{d:"M4 6h16",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})]}),Xn=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",...t,children:e.jsx("path",{d:"M20 6H8l6 6-6 6h12",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})}),Xt="shadow-[0_8px_20px_rgba(6,95,70,0.12)] active:translate-y-0.5 active:shadow-[0_4px_8px_rgba(6,95,70,0.08)] transform-gpu",Jn="shadow-[0_6px_14px_rgba(2,6,23,0.08)] active:translate-y-0.5 active:shadow-[0_3px_6px_rgba(2,6,23,0.06)] transform-gpu",Tt=lt.forwardRef(({children:t,className:a="",size:r="md",disabled:u=!1,loading:v=!1,leftIcon:M,rightIcon:S,animateProps:L={},"aria-label":g,...R},h)=>e.jsxs(rt.button,{ref:h,"aria-label":g,disabled:u||v,whileTap:{scale:.98,y:1},initial:{y:0},animate:L,...R,className:ot("inline-flex items-center justify-center gap-2 font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all will-change-transform",Kn[r],"disabled:opacity-60 disabled:cursor-not-allowed",a),children:[v&&e.jsxs("svg",{className:"animate-spin w-4 h-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),!v&&M?e.jsx("span",{className:"-ml-0.5 inline-flex items-center",children:e.jsx(M,{className:"w-5 h-5"})}):null,e.jsx("span",{className:v?"opacity-80":"",children:t}),!v&&S?e.jsx("span",{className:"-mr-0.5 inline-flex items-center",children:e.jsx(S,{className:"w-5 h-5"})}):null]})),He=t=>e.jsx(Tt,{...t,className:ot("bg-gradient-to-br from-[#0ea5a4] to-[#0b8793] text-white",Xt,"border border-transparent","hover:brightness-105 focus:ring-cyan-300",t.className)}),Qe=t=>e.jsx(Tt,{...t,className:ot("bg-white text-slate-800 ring-1 ring-slate-100",Jn,t.className)}),Qn=t=>e.jsx(Tt,{...t,className:ot("bg-gradient-to-br from-[#ef4444] to-[#ef6b6b] text-white",Xt,t.className)}),Zn=t=>e.jsx(Tt,{...t,className:ot("bg-transparent border border-slate-300 text-slate-700 hover:bg-slate-50",t.className)}),Dt=t=>e.jsx(He,{leftIcon:Yn,...t,children:"Create"}),Jt=t=>e.jsx(Qn,{...t,children:"Delete"}),Qt=t=>e.jsx(He,{...t,children:"Save"}),pt=t=>e.jsx(Zn,{...t,children:"Cancel"}),el=({icon:t,label:a,onClick:r,className:u=""})=>e.jsx(rt.button,{onClick:r,whileHover:{y:-4},whileTap:{scale:.98},className:ot("fixed right-6 bottom-6 rounded-full p-4 shadow-2xl text-white","bg-gradient-to-br from-[#06b6d4] to-[#0ea5a4]",Xt,u),"aria-label":a,children:t?e.jsx(t,{className:"w-6 h-6"}):a}),Zt=({onChange:t,accept:a="*",children:r})=>e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"file",accept:a,onChange:t,className:"hidden"}),e.jsx(He,{leftIcon:Xn,children:r})]}),es=(t=600)=>new Promise(a=>setTimeout(a,t)),tl=async t=>(await es(800),{ok:!0,url:URL.createObjectURL(t)}),sl=async({offset:t=0,limit:a=20}={})=>(await es(400),{ok:!0,data:Array.from({length:a}).map((u,v)=>({id:t+v+1,type:["login","profile_update","order","invoice"][Math.floor(Math.random()*4)],text:["Logged in","Updated profile","Created order #"+(1e3+Math.floor(Math.random()*9e3)),"Paid invoice #"+(2e3+Math.floor(Math.random()*9e3))][Math.floor(Math.random()*4)],time:new Date(Date.now()-Math.floor(Math.random()*1e3*60*60*24)).toISOString()})),total:500}),al=({value:t,onChange:a,size:r=96})=>{const[u,v]=s.useState(t||null),[M,S]=s.useState(!1),L=s.useRef(null);s.useEffect(()=>{v(t||null)},[t]);const g=async R=>{const h=R&&R[0];if(h){S(!0);try{const w=await tl(h);w.ok&&(v(w.url),a&&a(w.url))}finally{S(!1)}}};return e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{style:{width:r,height:r},className:"rounded-full overflow-hidden bg-slate-100 flex items-center justify-center relative",children:[u?e.jsx("img",{src:u,alt:"avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-slate-400 text-xl",children:"U".toUpperCase()}),M&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 text-white text-xs",children:"Uploading…"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-sm text-slate-700",children:[e.jsx("input",{ref:L,type:"file",accept:"image/*",onChange:R=>g(R.target.files),className:"hidden"}),e.jsx("span",{className:"px-3 py-1 rounded bg-white border",children:"Change avatar"})]})]})},il=({user:t={},onSaved:a})=>{const[r,u]=s.useState({name:t.name||t.username||"",email:t.email||"",phone:t.phone||"",bio:t.bio||""}),[v,M]=s.useState(!1),[S,L]=s.useState(null);s.useEffect(()=>{u({name:t.name||t.username||"",email:t.email||"",phone:t.phone||"",bio:t.bio||""})},[t]);const g=(h,w)=>u(D=>({...D,[h]:w})),R=async()=>{var h,w,D;if(M(!0),L(null),!r.name||!r.name.trim()){L({ok:!1,message:"Name is required"}),M(!1);return}if(!r.email||!r.email.trim()){L({ok:!1,message:"Email is required"}),M(!1);return}try{const q=await E.put("/api/users/me",r),$=((h=q==null?void 0:q.data)==null?void 0:h.data)||(q==null?void 0:q.data)||r;if(L({ok:!0,message:"Profile saved"}),typeof a=="function")try{a($)}catch(ae){console.warn("ProfileForm onSaved callback error",ae)}}catch(q){console.error("Profile save error",q);const $=((D=(w=q==null?void 0:q.response)==null?void 0:w.data)==null?void 0:D.message)||(q==null?void 0:q.message)||"Failed to save profile";L({ok:!1,message:$})}finally{M(!1),setTimeout(()=>L(null),4e3)}};return e.jsxs("div",{className:"bg-white rounded-2xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Profile"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Update your account details"})]}),S&&e.jsx("div",{className:S.ok?"text-emerald-600 text-sm":"text-rose-600 text-sm",children:S.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(K,{label:"Full name",required:!0,children:e.jsx(ze,{value:r.name,onChange:h=>g("name",h),placeholder:"Full name"})}),e.jsx(K,{label:"Email",required:!0,children:e.jsx(ze,{value:r.email,onChange:h=>g("email",h),placeholder:"email@company.com"})}),e.jsx(K,{label:"Phone",children:e.jsx(ze,{value:r.phone,onChange:h=>g("phone",h),placeholder:"+91 99999 99999"})}),e.jsx(K,{label:"Short bio",children:e.jsx(ht,{value:r.bio,onChange:h=>g("bio",h),placeholder:"A short bio shown on your profile"})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(He,{onClick:R,loading:v,children:"Save profile"}),e.jsx(Qe,{onClick:()=>u({name:t.name||t.username||"",email:t.email||"",phone:t.phone||"",bio:t.bio||""}),children:"Reset"})]})]})},nl=({onPasswordChanged:t})=>{const[a,r]=s.useState(""),[u,v]=s.useState(""),[M,S]=s.useState(""),[L,g]=s.useState(!1),[R,h]=s.useState(null),w=async()=>{if(!a||!u){h({ok:!1,text:"Current and new password required"});return}if(u!==M){h({ok:!1,text:"Passwords do not match"});return}if(u.length<8){h({ok:!1,text:"Password must be at least 8 characters"});return}g(!0);try{await es(800),h({ok:!0,text:"Password updated"}),t&&t(),r(""),v(""),S("")}finally{g(!1),setTimeout(()=>h(null),2500)}};return e.jsxs("div",{className:"bg-white rounded-2xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Security"}),e.jsx("div",{className:"text-sm text-slate-500 mb-4",children:"Change your password and view security settings"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(K,{label:"Current password",children:e.jsx(ze,{type:"password",value:a,onChange:r})}),e.jsx(K,{label:"New password",children:e.jsx(ze,{type:"password",value:u,onChange:v})}),e.jsx(K,{label:"Confirm new",children:e.jsx(ze,{type:"password",value:M,onChange:S})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(He,{onClick:w,loading:L,children:"Update password"}),R&&e.jsx("div",{className:R.ok?"text-emerald-600 text-sm":"text-rose-600 text-sm",children:R.text})]})]})},ll=({settings:t={},onChange:a})=>{const[r,u]=s.useState({notifications:!0,digest:!1,...t});s.useEffect(()=>u({notifications:!0,digest:!1,...t}),[t]);const v=M=>{const S={...r,[M]:!r[M]};u(S),a&&a(S)};return e.jsxs("div",{className:"bg-white rounded-2xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Preferences"}),e.jsx("div",{className:"text-sm text-slate-500 mb-4",children:"Manage notification and display preferences"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Email notifications"}),e.jsx("div",{className:"text-xs text-slate-500",children:"Receive email updates"})]}),e.jsx(Lt,{checked:r.notifications,onChange:()=>v("notifications")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Daily digest"}),e.jsx("div",{className:"text-xs text-slate-500",children:"One email summary per day"})]}),e.jsx(Lt,{checked:r.digest,onChange:()=>v("digest")})]})]})]})},rl=({initial:t=[],pageSize:a=20})=>{const[r,u]=s.useState(t),[v,M]=s.useState(!1),[S,L]=s.useState(0),[g,R]=s.useState(!0);s.useEffect(()=>{h()},[]);const h=async()=>{if(!(v||!g)){M(!0);try{const w=await sl({offset:S*a,limit:a});w.ok&&(u(D=>[...D,...w.data]),L(D=>D+1),w.data.length<a&&R(!1))}finally{M(!1)}}};return e.jsxs("div",{className:"bg-white rounded-2xl shadow p-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Recent activity"}),e.jsxs("div",{className:"space-y-3",children:[r.map(w=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-slate-100 flex items-center justify-center text-slate-600",children:e.jsx(Ae.Notification,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:w.text}),e.jsx("div",{className:"text-xs text-slate-500",children:new Date(w.time).toLocaleString()})]})]},w.id)),v&&e.jsx("div",{className:"text-sm text-slate-500",children:"Loading…"}),g&&!v&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("button",{className:"px-3 py-1 rounded border text-sm",onClick:h,children:"Load more"})}),!g&&r.length===0&&e.jsx("div",{className:"text-sm text-slate-500",children:"No recent activity yet"})]})]})};function ol({initialUser:t=null,onSaved:a=null}){const[r,u]=s.useState(t??{name:"User Name",email:"user@example.com",phone:"",bio:""}),[v,M]=s.useState(null);s.useEffect(()=>{t&&u(L=>({...L,...t}))},[t]);const S=L=>{if(u(g=>({...g,...L})),typeof a=="function")try{a(L)}catch(g){console.warn("ProfilePage onSaved error",g)}};return e.jsx("div",{className:"p-6 bg-slate-50 min-h-screen",children:e.jsxs("div",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow p-6 flex flex-col items-center gap-4",children:[e.jsx(al,{value:v,onChange:M}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg",children:r.name||r.username||"User"}),e.jsx("div",{className:"text-sm text-slate-500",children:r.email||"user@example.com"})]}),e.jsx("div",{className:"w-full",children:e.jsx(He,{onClick:()=>alert("Go to public profile"),children:"View public profile"})})]}),e.jsx(ll,{settings:{notifications:!0},onChange:L=>console.log("prefs",L)}),e.jsx(nl,{onPasswordChanged:()=>alert("Password changed")})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(il,{user:r,onSaved:S}),e.jsx(rl,{}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(el,{icon:()=>e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})}),onClick:()=>alert("Start new action"),label:"New"})})]})]})})}function dl({open:t,onClose:a,initialUser:r,onSaved:u}){return t?e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center p-6 bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-3xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800 dark:text-slate-100",children:"Manage Profile"}),e.jsx(Qe,{onClick:a,children:"Close"})]}),e.jsx("div",{className:"p-6 max-h-[75vh] overflow-y-auto",children:e.jsx(ol,{initialUser:r,onSaved:u})})]})}):null}function cl({logoBox:t="h-[140px] w-[140px] md:h-[170px] md:w-[170px]",logoImgClass:a="w-full h-full object-contain"}){const r=gt()||{},{user:u,logout:v,setUser:M}=r,S=Rt(),[L,g]=s.useState(!1),R=()=>{g(!0),document.body.style.overflow="hidden"},h=()=>{g(!1),document.body.style.overflow=""},[w,D]=s.useState(""),q=s.useRef(null),$=_e=>{_e&&_e.preventDefault();const ke=(w||"").trim();ke&&(S(`/admin/inquiries?search=${encodeURIComponent(ke)}`),D(""))},[ae,F]=s.useState(!1),[ce,ne]=s.useState([{id:1,title:"New inquiry from St. Mary's",time:"2m",unread:!0},{id:2,title:"Order #345 completed",time:"1h",unread:!0},{id:3,title:"Employee profile updated",time:"1d",unread:!1}]),J=()=>{F(_e=>!_e),ne(_e=>_e.map(ke=>({...ke,unread:!1})))},[le,Q]=s.useState(!1),[pe,re]=s.useState(!1),O=()=>{re(!0),Q(!1)},de=()=>re(!1),De=()=>{v&&v(),S("/login",{replace:!0})},[Se,Z]=s.useState(()=>{try{const _e=localStorage.getItem("theme");return _e==="dark"||_e==="light"?_e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}}),Fe=_e=>{try{_e==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("theme",_e)}catch(ke){console.warn("Theme error",ke)}};s.useEffect(()=>{Fe(Se)},[Se]),s.useEffect(()=>{function _e(ke){var Ie;(ke.ctrlKey||ke.metaKey)&&ke.key.toLowerCase()==="k"&&(ke.preventDefault(),(Ie=q.current)==null||Ie.focus())}return window.addEventListener("keydown",_e),()=>window.removeEventListener("keydown",_e)},[]);const ie=ce.filter(_e=>_e.unread).length,[Ne,xe]=s.useState(null);s.useEffect(()=>{if(!Ne)return;const _e=setTimeout(()=>xe(null),4e3);return()=>clearTimeout(_e)},[Ne]);const Re=async()=>{var _e;de();try{const ke=await E.get("/api/auth/me"),Ie=(_e=ke==null?void 0:ke.data)!=null&&_e.data?ke.data.data:(ke==null?void 0:ke.data)||null;if(Ie&&typeof M=="function")try{M(Ie)}catch(x){console.warn("setUser threw",x)}xe(Ie?{type:"success",message:"Profile updated successfully."}:{type:"error",message:"Profile saved, but failed to refresh logged-in user."})}catch(ke){console.warn("Failed to refresh /api/auth/me after profile save",ke),xe({type:"error",message:"Profile saved, but refreshing your session failed. Please reload the page."})}};return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"w-full bg-white dark:bg-slate-900 border-b",children:e.jsxs("div",{className:"w-full flex items-center justify-between px-4 sm:px-6 lg:px-8 h-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:R,className:"md:hidden inline-flex items-center justify-center p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800",children:e.jsx("svg",{className:"h-7 w-7 text-slate-700 dark:text-slate-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs(Nt,{to:"/",className:"flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:`${t} flex-shrink-0`,children:e.jsx("img",{src:Se==="dark"?"/images/Ank_Logo_dark.jpg":"/images/Ank_Logo.png",alt:"AnkVidhya",className:a})}),e.jsx("span",{className:"text-slate-800 dark:text-slate-100 font-semibold text-xl",children:"AnkVidhya"})]}),e.jsxs("form",{onSubmit:$,className:"hidden md:flex items-center bg-slate-50 dark:bg-slate-800 border rounded px-2 py-1 gap-2",children:[e.jsxs("svg",{className:"h-5 w-5 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M21 21l-4.35-4.35",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"11",cy:"11",r:"6",strokeWidth:"1.5"})]}),e.jsx("input",{ref:q,value:w,onChange:_e=>D(_e.target.value),placeholder:"Search leads, schools, orders...",className:"bg-transparent outline-none text-sm text-slate-700 dark:text-slate-200 placeholder:text-slate-400 px-2 py-1 w-64"}),e.jsx("button",{type:"submit",className:"hidden"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>{const _e=prompt("Search");_e&&S(`/admin/inquiries?search=${encodeURIComponent(_e)}`)},className:"md:hidden p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-800",children:e.jsxs("svg",{className:"h-6 w-6 text-slate-700 dark:text-slate-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M21 21l-4.35-4.35",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"11",cy:"11",r:"6",strokeWidth:"1.5"})]})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:J,className:"relative p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-800",children:[e.jsx("svg",{className:"h-7 w-7 text-slate-700 dark:text-slate-200",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0 1 18 14.158V11a6 6 0 1 0-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),ie>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-rose-500 text-white text-xs rounded-full px-1.5",children:ie})]}),ae&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-slate-800 border rounded shadow-lg z-50 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b text-sm font-medium text-slate-700 dark:text-slate-100",children:"Notifications"}),e.jsxs("div",{className:"max-h-64 overflow-auto",children:[ce.length===0&&e.jsx("div",{className:"p-3 text-sm text-slate-500",children:"No notifications"}),ce.map(_e=>e.jsx("div",{className:`p-3 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-start gap-3 ${_e.unread?"bg-slate-50 dark:bg-slate-700":""}`,children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm text-slate-800 dark:text-slate-100",children:_e.title}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:_e.time})]})},_e.id))]}),e.jsx("div",{className:"p-2 border-t text-center",children:e.jsx("button",{onClick:()=>{ne([]),F(!1)},className:"text-sm text-indigo-600",children:"Clear all"})})]})]}),e.jsx("button",{onClick:()=>Z(_e=>_e==="dark"?"light":"dark"),className:"p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-800",children:Se==="dark"?e.jsxs("svg",{className:"h-6 w-6 text-yellow-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"12",cy:"12",r:"3",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):e.jsx("svg",{className:"h-6 w-6 text-slate-700 dark:text-slate-200",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>Q(_e=>!_e),className:"flex items-center gap-2 px-2 py-1 rounded hover:bg-slate-100 dark:hover:bg-slate-800",children:[e.jsx("div",{className:"h-9 w-9 rounded-full bg-gradient-to-br from-indigo-400 to-rose-400 flex items-center justify-center text-white text-sm font-semibold",children:((u==null?void 0:u.username)||(u==null?void 0:u.employee_name)||"U").slice(0,1).toUpperCase()}),e.jsxs("div",{className:"hidden md:flex flex-col text-left",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-100",children:(u==null?void 0:u.username)||(u==null?void 0:u.employee_name)||"User"}),e.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-300",children:(u==null?void 0:u.role_name)||(u==null?void 0:u.role)||"—"})]})]}),le&&e.jsxs("div",{className:"absolute right-0 mt-2 w-52 bg-white dark:bg-slate-800 border rounded shadow-lg z-50 overflow-hidden",children:[e.jsx("button",{onClick:()=>{Q(!1),S("/profile")},className:"block w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Profile"}),e.jsx("button",{onClick:O,className:"block w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Edit profile"}),e.jsx(Nt,{to:"/settings",onClick:()=>Q(!1),className:"block px-4 py-2 text-sm text-slate-700 dark:text-slate-100 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Settings"}),e.jsx("div",{className:"border-t"}),e.jsx("button",{onClick:De,className:"w-full text-left px-4 py-2 text-sm text-rose-600 hover:bg-slate-50 dark:hover:bg-slate-700",children:"Logout"})]})]})]})]})}),L&&e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("button",{onClick:h,className:"fixed inset-0 bg-black/40"}),e.jsxs("div",{className:"relative bg-white dark:bg-slate-800 w-80 max-w-full h-full shadow-xl overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`${t} flex-shrink-0`,children:e.jsx("img",{src:Se==="dark"?"/images/Ank_Logo_dark.jpg":"/images/Ank_Logo.png",alt:"logo",className:a})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-800 dark:text-slate-100",children:"AnkVidhya"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-300",children:"Menu"})]})]}),e.jsx("button",{onClick:h,className:"p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-700",children:e.jsx("svg",{className:"h-6 w-6 text-slate-700 dark:text-slate-200",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-4",children:e.jsx(Us,{className:"w-full",onClose:h})})]})]}),e.jsx(dl,{open:pe,onClose:de,initialUser:u,onSaved:Re}),Ne&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:e.jsxs("div",{className:`px-4 py-2 rounded-lg shadow-lg text-sm flex items-center gap-2 ${Ne.type==="success"?"bg-emerald-50 border border-emerald-200 text-emerald-800":"bg-rose-50 border border-rose-200 text-rose-800"}`,children:[Ne.type==="success"?e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-emerald-500"}):e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-rose-500"}),e.jsx("span",{children:Ne.message})]})})]})}const xs=25,ml=["","draft","submitted","confirmed","cancelled"];function Xe({name:t,className:a="h-4 w-4 inline-block mr-2"}){const r={className:a,"aria-hidden":!0};switch(t){case"search":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M21 21l-4.35-4.35",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"11",cy:"11",r:"6",strokeWidth:"1.5"})]});case"plus":return e.jsx("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M12 5v14M5 12h14",strokeWidth:"1.5",strokeLinecap:"round"})});case"view":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z",strokeWidth:"1.4"}),e.jsx("circle",{cx:"12",cy:"12",r:"3",strokeWidth:"1.4"})]});case"delete":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M3 6h18M8 6v14a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6",strokeWidth:"1.3"}),e.jsx("path",{d:"M10 11v6M14 11v6",strokeWidth:"1.3",strokeLinecap:"round"})]});case"generate":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M21 12a9 9 0 1 1-9-9",strokeWidth:"1.5"}),e.jsx("path",{d:"M12 3v9l3 3",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]});case"confirm":return e.jsx("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M5 13l4 4L19 7",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})});case"reprice":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M21 12v6a2 2 0 0 1-2 2H5",strokeWidth:"1.5"}),e.jsx("path",{d:"M7 7h10",strokeWidth:"1.5"}),e.jsx("path",{d:"M12 3v4",strokeWidth:"1.5"})]});default:return null}}function gs(t){if(!t)return"—";try{return new Date(t).toLocaleString()}catch{return t}}function fs(){const[t,a]=s.useState(""),[r,u]=s.useState(""),[v,M]=s.useState(""),[S,L]=s.useState(""),[g,R]=s.useState(""),[h,w]=s.useState(1),[D,q]=s.useState(xs),[$,ae]=s.useState(!1),[F,ce]=s.useState([]),[ne,J]=s.useState({page:1,pageSize:xs,total:0}),[le,Q]=s.useState([]),[pe,re]=s.useState({mediums:[],standards:[]}),[O,de]=s.useState(!1),[De,Se]=s.useState(!1),[Z,Fe]=s.useState(null),[ie,Ne]=s.useState(!1),[xe,Re]=s.useState(null),[_e,ke]=s.useState([]),[Ie,x]=s.useState({}),[H,fe]=s.useState(!1),[je,l]=s.useState(""),[j,Y]=s.useState({lead_id:null,school_id:null,contact_name:"",phone:"",email:"",billing_name:"",billing_address:"",billing_city:"",billing_state:"",billing_pincode:"",shipping_address:"",shipping_city:"",shipping_state:"",shipping_pincode:"",strengths:[],notes:"",discount_amount:0,tax_percent:0}),[se,Me]=s.useState(!1),[p,T]=s.useState(!1),[te,ge]=s.useState({}),[oe,Ee]=s.useState({});s.useRef(null),s.useEffect(()=>{Ce(),z()},[]),s.useEffect(()=>{w(1),z(1)},[t,r,v,S,g,D]);async function Ce(){try{const n=await E.get("/api/leads/lookups",{background:!0});re(n?{mediums:n.media||[],standards:n.standards||[]}:{mediums:[],standards:[]})}catch(n){console.warn("Failed to load lookups",n),re({mediums:[],standards:[]})}try{const n=await E.get("/api/leads",{query:{status:"converted",page:1,pageSize:500},background:!0});if(n&&n.data){const c=n.data.map(_=>({lead_id:_.lead_id,school_id:_.school_id||null,school_name:_.school_name||(_.billing_name||"").slice(0,80)}));Q(c)}else Q([])}catch(n){console.warn("Failed to load converted leads",n),Q([])}}async function z(n=h){ae(!0);try{const c={page:n,pageSize:D,search:t||void 0,status:r||void 0,school_id:v||void 0,from:S||void 0,to:g||void 0},_=await E.get("/api/orders",{query:c});_?(ce(_.data||[]),J(_.pagination||{page:n,pageSize:D,total:_.pagination&&_.pagination.total||0})):ce([])}catch(c){console.error("Fetch orders error",c),ce([])}finally{ae(!1)}}const W=s.useMemo(()=>{const n=ne&&ne.total||0;return Math.max(1,Math.ceil(n/(ne.pageSize||D)))},[ne,D]);function V(n={}){Y({lead_id:n.lead_id||null,school_id:n.school_id||null,contact_name:n.contact_name||"",phone:n.phone||"",email:n.email||"",billing_name:n.school_name||"",billing_address:n.billing_address||"",billing_city:n.billing_city||"",billing_state:n.billing_state||"",billing_pincode:n.billing_pincode||"",shipping_address:n.shipping_address||"",shipping_city:n.shipping_city||"",shipping_state:n.shipping_state||"",shipping_pincode:n.shipping_pincode||"",strengths:[],notes:"",discount_amount:0,tax_percent:0}),l(""),de(!0)}async function o(n){if(!n){Y(_=>({..._,lead_id:null,school_id:null}));return}const c=le.find(_=>String(_.lead_id)===String(n));Y(_=>({..._,lead_id:n,school_id:c?c.school_id:_.school_id,billing_name:c?c.school_name:_.billing_name}));try{const _=await E.get(`/api/leads/${n}`);if(_&&_.data){const U=_.data,he=[U.city,U.state,U.pincode].filter(Boolean).join(", ");Y(ve=>({...ve,lead_id:U.lead_id,school_id:U.school_id||ve.school_id,contact_name:U.contact_name||ve.contact_name,phone:U.phone||ve.phone,email:U.email||ve.email,billing_name:U.school_name||ve.billing_name,billing_address:he,billing_city:U.city||ve.billing_city,billing_state:U.state||ve.billing_state,billing_pincode:U.pincode||ve.billing_pincode,shipping_address:ve.shipping_address||he,shipping_city:ve.shipping_city||U.city||ve.shipping_city,shipping_state:ve.shipping_state||U.state||ve.shipping_state,shipping_pincode:ve.shipping_pincode||U.pincode||ve.shipping_pincode}))}}catch(_){console.warn("Failed to load lead detail for prefill",_)}}function b(){Y(n=>({...n,strengths:[...n.strengths||[],{medium_id:"",std_id:"",students:0}]}))}function P(n){Y(c=>({...c,strengths:c.strengths.filter((_,U)=>U!==n)}))}function ee(n,c,_){Y(U=>{const he=U.strengths.map((ve,Ke)=>Ke===n?{...ve,[c]:_}:ve);return{...U,strengths:he}})}async function d(n){n&&n.preventDefault(),fe(!0),l("");try{if(!j.lead_id)throw new Error("Please select a converted lead (orders are created from converted leads).");const c=(j.contact_name||"").trim()||(j.billing_name||"").trim();if(!c)throw new Error("Contact name is required (provide contact name or billing name).");const _=[{description:"AUTO: placeholder (will be replaced by generated items)",qty:1,unit_price:0}],U={lead_id:j.lead_id?Number(j.lead_id):null,school_id:j.school_id?Number(j.school_id):null,contact_name:c,phone:j.phone||"",email:j.email||"",billing_name:j.billing_name||"",billing_address:j.billing_address||"",billing_city:j.billing_city||"",billing_state:j.billing_state||"",billing_pincode:j.billing_pincode||"",shipping_address:j.shipping_address||j.billing_address||"",shipping_city:j.shipping_city||j.billing_city||"",shipping_state:j.shipping_state||j.billing_state||"",shipping_pincode:j.shipping_pincode||j.billing_pincode||"",items:_,notes:j.notes||"",discount_amount:Number(j.discount_amount)||0,tax_percent:Number(j.tax_percent)||0},he=await E.post("/api/orders",U);if(!(he&&he.ok))throw new Error(he&&(he.error||he.message||he.detail)||"Failed to create order");const ve=he.order_id||he.data&&he.data.order_id||null;if(!ve){de(!1),z(1),alert("Order created.");return}const Ke=(j.strengths||[]).map($e=>({medium_id:$e.medium_id?Number($e.medium_id):null,std_id:$e.std_id?Number($e.std_id):null,students_cnt:Number($e.students)||0})).filter($e=>$e.medium_id||$e.std_id||$e.students_cnt>0);if(Ke.length)try{await E.post(`/api/orders/${ve}/strengths`,{strengths:Ke})}catch($e){console.warn("Failed to upsert strengths after create",$e),alert("Order created but failed to save strengths automatically. You can add strengths from the order view.")}try{const $e=await E.post(`/api/orders/${ve}/generate`);if(!($e&&$e.ok))console.warn("Generate returned non-ok",$e),alert("Order created but generate failed. You can run Generate from the order view.");else{const Ye=await E.post(`/api/orders/${ve}/reprice`);Ye&&Ye.ok||(console.warn("Reprice returned non-ok",Ye),alert("Requirements generated but reprice failed. Run Reprice from the order view."))}}catch($e){console.warn("Generate/Reprice error",$e),alert("Order created but auto-generate/reprice failed. Check console and use Generate + Reprice from order view.")}de(!1),z(1),setTimeout(()=>y(ve),250),alert("Order created successfully. If you left Items blank, they were auto-generated from Strengths (attempted).")}catch(c){console.error("Create order error",c),l((c==null?void 0:c.message)||String(c))}finally{fe(!1)}}async function y(n){try{const c=await E.get(`/api/orders/${n}`,{query:{include:"items,strengths,requirements"}});if(c&&c.data){Fe(c.data),Se(!0);try{const _=await E.get(`/api/orders/${n}/invoice`,{background:!0});if(_&&_.data){const U=_.data.invoice||_.data||{},he={invoice_id:U.invoice_id||U.invoiceId||U.id||_.data.invoice_id||_.data.invoice_id||null,invoice_number:U.invoice_number||U.invoice_number||null,status:U.status||null,total_amount:U.total_amount!=null?U.total_amount:U.total||null};he.invoice_id&&Ee(ve=>({...ve||{},[n]:he}))}}catch{}if(c.data.requirements&&c.data.requirements.length){const _={};for(const U of c.data.requirements){const he=String(U.req_id||`${U.medium_id}-${U.std_id}-${U.item_type}-${U.book_id||""}`);if(U.book_id)try{const ve=await E.get(`/api/books/${U.book_id}`,{background:!0});_[U.req_id]={price:ve&&ve.data&&ve.data.price!=null?Number(ve.data.price):100,loading:!1,saving:!1}}catch{_[U.req_id]={price:100,loading:!1,saving:!1}}else _[U.req_id]={price:100,loading:!1,saving:!1}}x(_)}else x({})}else alert("Failed to load order.")}catch(c){console.error("Open view error",c),alert("Failed to load order.")}}async function C(n){try{const c=await E.get(`/api/orders/${n}/requirements`,{background:!0});if(c&&c.data){Fe(U=>({...U||{},requirements:c.data}));const _={...Ie||{}};for(const U of c.data)if(!_[U.req_id])if(U.book_id)try{const he=await E.get(`/api/books/${U.book_id}`,{background:!0});_[U.req_id]={price:he&&he.data&&he.data.price!=null?Number(he.data.price):100,loading:!1,saving:!1}}catch{_[U.req_id]={price:100,loading:!1,saving:!1}}else _[U.req_id]={price:100,loading:!1,saving:!1};x(_)}}catch(c){console.warn("Reload requirements failed",c)}}async function B(n){if(confirm("Generate requirements for this order?"))try{const c=await E.post(`/api/orders/${n}/generate`);if(c&&c.ok)alert("Requirements generated."),await C(n),De&&Z&&Z.order_id===n&&y(n);else throw new Error(c&&c.error||"Generate failed")}catch(c){console.error("Generate error",c),alert((c==null?void 0:c.message)||"Generate failed")}}async function i(n){if(confirm("Reprice this order? This will re-run pricing logic."))try{const c=await E.post(`/api/orders/${n}/reprice`);if(c&&c.ok)alert("Reprice requested."),De&&Z&&Z.order_id===n&&y(n);else throw new Error(c&&c.error||"Reprice failed")}catch(c){console.error("Reprice error",c),alert((c==null?void 0:c.message)||"Reprice failed")}}async function N(n){if(confirm("Confirm this order? This will mark it confirmed on server and then delete the associated converted lead (if any)."))try{const c=await E.post(`/api/orders/${n.order_id}/confirm`);if(!(c&&c.ok))throw new Error((c==null?void 0:c.error)||"Confirm failed");const _=c.invoice_id||c.invoice&&(c.invoice.invoice_id||c.invoice.id)||null;if(_){const he={invoice_id:_,invoice_number:c.invoice_number||c.invoice&&c.invoice.invoice_number||null,status:c.status||c.invoice&&c.invoice.status||"draft",total_amount:c.total_amount!=null?c.total_amount:c.invoice&&c.invoice.total_amount||null};Ee(ve=>({...ve||{},[n.order_id]:he}))}const U=Number(n.lead_id)||null;if(U)try{await E.del(`/api/leads/${U}`)}catch(he){console.warn("Failed to delete lead after confirm",he),alert("Order confirmed but failed to delete the linked lead. Please remove it manually.")}alert("Order confirmed."),z(h),De&&Z&&Z.order_id===n.order_id&&y(n.order_id)}catch(c){console.error("Confirm error",c),alert((c==null?void 0:c.message)||"Confirm failed")}}async function I(n){if(confirm("Delete this order? This cannot be undone."))try{await E.del(`/api/orders/${n}`),z(1),Se(!1)}catch(c){console.error("Delete order error",c),alert((c==null?void 0:c.message)||"Delete failed")}}async function m(n){Re(n),Ne(!0);try{const c=await E.get(`/api/orders/${n}/strengths`,{background:!0});ke(c&&c.data?c.data.map(_=>({medium_id:_.medium_id,std_id:_.std_id,students:_.students})):[])}catch(c){console.warn("Failed to load strengths",c),ke([])}}function f(){ke(n=>[...n||[],{medium_id:"",std_id:"",students:0}])}function G(n){ke(c=>c.filter((_,U)=>U!==n))}function X(n,c,_){ke(U=>U.map((he,ve)=>ve===n?{...he,[c]:_}:he))}async function k(){if(!xe)return;const n=_e.map(c=>({medium_id:c.medium_id?Number(c.medium_id):null,std_id:c.std_id?Number(c.std_id):null,students_cnt:Number(c.students)||0}));try{await E.post(`/api/orders/${xe}/strengths`,{strengths:n}),alert("Strengths saved."),Ne(!1);try{await C(xe)}catch(c){console.warn("reloadRequirements after strengths save failed",c)}De&&Z&&Z.order_id===xe&&y(xe)}catch(c){console.error("Save strengths failed",c),alert("Failed to save strengths.")}}function me(n,c){x(_=>({..._||{},[n]:{..._[n]||{},price:c}}))}async function ue(n){const c=Ie[n.req_id];if(!c)return;const _=Number(c.price||0);if(isNaN(_)||_<0){alert("Enter a valid price >= 0");return}if(n.book_id){x(U=>({...U||{},[n.req_id]:{...U[n.req_id]||{},saving:!0}}));try{await E.put(`/api/books/${n.book_id}`,{price:_}),x(U=>({...U||{},[n.req_id]:{...U[n.req_id]||{},price:_,saving:!1}})),alert("Book price updated."),Z&&Z.order_id&&(await C(Z.order_id),y(Z.order_id))}catch(U){console.error("Failed to update book price",U),x(he=>({...he||{},[n.req_id]:{...he[n.req_id]||{},saving:!1}})),alert("Failed to save price.")}}else x(U=>({...U||{},[n.req_id]:{...U[n.req_id]||{},price:_}})),alert("Price updated locally (no book_id to persist to). Use Reprice to compute items/prices server-side.")}async function ye(n){const c=oe[n];if(c)return c;try{const _=await E.post(`/api/orders/${n}/invoice/generate`);if(_&&(_.ok||_.invoice_id||_.invoice)){const U=_.invoice||{invoice_id:_.invoice_id||_.invoiceId||null,invoice_number:_.invoice_number||null,status:_.status||"draft",total_amount:_.total_amount!=null?_.total_amount:null};if(U.invoice_id)return Ee(he=>({...he||{},[n]:U})),U}}catch(_){console.warn("/api/orders/:orderId/invoice/generate failed",_)}try{const _=await E.post("/api/invoices/generate-from-order",{order_id:n});if(_&&(_.ok||_.invoice_id)){const U={invoice_id:_.invoice_id||_.id||null,invoice_number:_.invoice_number||null,status:_.status||"draft",total_amount:_.total_amount!=null?_.total_amount:null};if(U.invoice_id)return Ee(he=>({...he||{},[n]:U})),U}}catch(_){console.warn("invoices/generate-from-order fallback failed",_)}try{const _=await E.get(`/api/orders/${n}/invoice`,{background:!0});if(_&&_.data){const U=_.data.invoice||_.data||{},he={invoice_id:U.invoice_id||U.id||null,invoice_number:U.invoice_number||null,status:U.status||null,total_amount:U.total_amount!=null?U.total_amount:U.total||null};if(he.invoice_id)return Ee(ve=>({...ve||{},[n]:he})),he}}catch(_){console.warn("GET /api/orders/:orderId/invoice failed",_)}return null}async function Le(n){if(!n)throw new Error("Missing invoiceId");Me(!0);try{const c=await E.post(`/api/invoices/${n}/generate`);if(c&&c.ok)return c.url?(ge(_=>({..._||{},[n]:c.url})),{ok:!0,url:c.url}):{ok:!0};throw new Error(c&&(c.error||c.message)||"Failed to generate PDF")}catch(c){throw console.error("generateInvoicePdf error",c),c}finally{Me(!1)}}async function be(n,c=null){if(!n){alert("No invoiceId available to download PDF.");return}T(!0);try{const _=await E.request(`/api/invoices/${n}/pdf`,{method:"GET",expect:"blob"});if(!_)throw new Error("No PDF returned");const U=window.URL.createObjectURL(_),he=document.createElement("a");he.href=U,he.download=c||`invoice_${n}.pdf`,document.body.appendChild(he),he.click(),he.remove(),window.URL.revokeObjectURL(U)}catch(_){console.error("downloadInvoicePdf error",_),alert("Failed to download invoice PDF. Check server endpoint /api/invoices/:invoiceId/pdf")}finally{T(!1)}}async function we(n){try{const c=await ye(n);if(!c)throw new Error("Failed to create or fetch invoice for order");const _=c.invoice_id||c.invoiceId||null;if(!_)throw new Error("Invoice id missing");const U=await Le(_);U&&U.url?alert("Invoice PDF generated and available at: "+U.url):alert("Invoice PDF generation requested. It may be available shortly."),y(n)}catch(c){console.error("ensureInvoiceAndGeneratePdf error",c),alert((c==null?void 0:c.message)||"Failed to generate invoice PDF")}}function Pe(n=[]){if(!n||!n.length)return"";const c=Object.keys(n[0]),_=he=>{if(he==null)return"";const ve=String(he);return ve.includes(",")||ve.includes('"')||ve.includes(`
`)?`"${ve.replace(/"/g,'""')}"`:ve},U=[c.join(",")];for(const he of n)U.push(c.map(ve=>_(he[ve])).join(","));return U.join(`
`)}async function Oe(){try{const n=F.map(ve=>({order_id:ve.order_id,lead_id:ve.lead_id,school_name:ve.school_name,contact_name:ve.contact_name,phone:ve.phone,email:ve.email,status:ve.status,order_date:ve.order_date,total_amount:ve.total_amount||""})),c=Pe(n),_=new Blob([c],{type:"text/csv;charset=utf-8;"}),U=URL.createObjectURL(_),he=document.createElement("a");he.href=U,he.download=`orders_page${ne.page||1}.csv`,document.body.appendChild(he),he.click(),he.remove(),URL.revokeObjectURL(U)}catch(n){console.error(n),alert("Export failed.")}}return e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Orders"}),e.jsx("nav",{className:"text-sm text-slate-500 mt-1",children:e.jsxs("ol",{className:"list-reset flex",children:[e.jsx("li",{children:e.jsx("a",{className:"hover:text-slate-700 text-slate-500",children:"Dashboard"})}),e.jsx("li",{className:"mx-2",children:"/"}),e.jsx("li",{className:"text-slate-700 font-medium",children:"Order Management"})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Oe,className:"inline-flex items-center gap-2 px-3 py-2 bg-white border rounded shadow-sm text-sm hover:shadow-md",children:[e.jsx(Xe,{name:"search"})," Export CSV"]}),e.jsxs("button",{onClick:()=>V(),className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded shadow-sm text-sm hover:bg-indigo-700",children:[e.jsx(Xe,{name:"plus"})," Create Order"]})]})]}),e.jsx("div",{className:"bg-white border rounded-lg p-4 shadow-sm mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Search"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx(Xe,{name:"search"}),e.jsx("input",{value:t,onChange:n=>a(n.target.value),placeholder:"Search order, billing name, contact, phone...",className:"w-full border rounded px-3 py-3 text-base"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Status"}),e.jsx("select",{value:r,onChange:n=>u(n.target.value),className:"w-full border rounded px-3 py-3 text-base",children:ml.map(n=>e.jsx("option",{value:n,children:n||"Any"},n))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"School (converted leads only)"}),e.jsxs("select",{value:v,onChange:n=>M(n.target.value),className:"w-full border rounded px-3 py-3 text-base",children:[e.jsx("option",{value:"",children:"Any"}),le.map(n=>e.jsxs("option",{value:n.school_id||"",children:[n.school_name," ",n.school_id?` (id:${n.school_id})`:""]},n.lead_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Date range"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:S,onChange:n=>L(n.target.value),className:"border rounded px-2 py-3 text-base w-1/2"}),e.jsx("input",{type:"date",value:g,onChange:n=>R(n.target.value),className:"border rounded px-2 py-3 text-base w-1/2"})]})]})]})}),e.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-hidden mb-8",children:[e.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing page ",ne.page||1," — ",ne.total||0," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-slate-500",children:"Page size"}),e.jsx("select",{value:D,onChange:n=>{q(Number(n.target.value)),w(1)},className:"border rounded px-3 py-2 text-sm",children:[10,25,50,100].map(n=>e.jsx("option",{value:n,children:n},n))})]})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-800 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-base font-medium",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-base font-medium",children:"School"}),e.jsx("th",{className:"px-4 py-3 text-base font-medium",children:"Contact"}),e.jsx("th",{className:"px-4 py-3 text-base font-medium",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-base font-medium",children:"Order Date"}),e.jsx("th",{className:"px-4 py-3 text-base font-medium",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-base font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:$?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-12 text-center text-slate-500 text-lg",children:"Loading…"})}):F.length?F.map(n=>e.jsxs("tr",{className:"odd:bg-white even:bg-slate-50 align-top",children:[e.jsx("td",{className:"px-4 py-3 text-base text-slate-700 font-medium",children:n.order_id}),e.jsx("td",{className:"px-4 py-3 text-base font-medium",children:n.school_name||n.billing_name||"—"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[e.jsx("div",{className:"text-base font-medium",children:n.contact_name||"—"}),e.jsx("div",{className:"text-sm text-slate-500",children:n.phone})]}),e.jsx("td",{className:"px-4 py-3 text-base",children:n.status||"—"}),e.jsx("td",{className:"px-4 py-3 text-base",children:gs(n.order_date||n.created_at)}),e.jsx("td",{className:"px-4 py-3 text-base",children:n.total_amount!=null?String(n.total_amount):"—"}),e.jsx("td",{className:"px-4 py-3 text-base",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>y(n.order_id),className:"inline-flex items-center gap-2 px-2 py-1 text-sm rounded hover:bg-slate-100",children:[e.jsx(Xe,{name:"view"})," ",e.jsx("span",{className:"hidden md:inline",children:"View"})]}),e.jsxs("button",{onClick:()=>B(n.order_id),className:"inline-flex items-center gap-2 px-2 py-1 text-sm rounded hover:bg-slate-100",children:[e.jsx(Xe,{name:"generate"})," ",e.jsx("span",{className:"hidden md:inline",children:"Generate"})]}),e.jsxs("button",{onClick:()=>i(n.order_id),className:"inline-flex items-center gap-2 px-2 py-1 text-sm rounded hover:bg-slate-100",children:[e.jsx(Xe,{name:"reprice"})," ",e.jsx("span",{className:"hidden md:inline",children:"Reprice"})]}),e.jsxs("button",{onClick:()=>N(n),className:"inline-flex items-center gap-2 px-2 py-1 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700",children:[e.jsx(Xe,{name:"confirm"})," ",e.jsx("span",{className:"hidden md:inline",children:"Confirm"})]}),e.jsxs("button",{onClick:()=>I(n.order_id),className:"inline-flex items-center gap-2 px-2 py-1 text-sm rounded text-rose-600 hover:bg-rose-50",children:[e.jsx(Xe,{name:"delete"})," ",e.jsx("span",{className:"hidden md:inline",children:"Delete"})]})]})})]},n.order_id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-12 text-center text-slate-500 text-lg",children:"No results"})})})]})}),e.jsxs("div",{className:"px-4 py-3 border-t flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-600",children:ne.total?`Showing ${(ne.page-1)*ne.pageSize+1} - ${Math.min(ne.page*ne.pageSize,ne.total)} of ${ne.total}`:"—"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{disabled:ne.page<=1,onClick:()=>{w(n=>Math.max(1,n-1)),z(Math.max(1,h-1))},className:"px-3 py-1 border rounded bg-white text-sm disabled:opacity-50",children:"Prev"}),e.jsx("div",{className:"text-sm",children:"Page"}),e.jsx("input",{type:"number",min:"1",max:W,value:h,onChange:n=>{const c=Math.max(1,Number(n.target.value||1));w(c),z(c)},className:"w-16 border rounded px-2 py-1 text-sm"}),e.jsxs("div",{className:"text-sm",children:["/ ",W]}),e.jsx("button",{disabled:h>=W,onClick:()=>{w(n=>Math.min(W,n+1)),z(Math.min(W,h+1))},className:"px-3 py-1 border rounded bg-white text-sm disabled:opacity-50",children:"Next"})]})]})]}),O&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30",onClick:()=>de(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-4xl bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 border-b",children:[e.jsx("img",{src:"/public/images/Ank_Logo.png",alt:"Ank Logo",className:"h-12 w-12 object-contain"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Create Order"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Create an order from a converted lead — you can leave Items empty and auto-generate them from Strengths."})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{onClick:()=>de(!1),className:"text-sm text-slate-500 hover:text-slate-700",children:"Close"})})]}),e.jsxs("form",{onSubmit:d,className:"p-4 max-h-[80vh] overflow-auto space-y-4",autoComplete:"off",children:[e.jsxs("section",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"1. Converted Lead"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Select converted lead *"}),e.jsxs("select",{required:!0,value:j.lead_id||"",onChange:n=>o(n.target.value||""),className:"w-full border rounded px-3 py-3 text-base",children:[e.jsx("option",{value:"",children:"— select converted lead —"}),le.map(n=>e.jsxs("option",{value:n.lead_id,children:[n.school_name," ",n.school_id?`(school:${n.school_id})`:`(lead:${n.lead_id})`]},n.lead_id))]}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"Orders may only be created from converted leads."})]}),e.jsxs("div",{className:"w-full md:w-64",children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"School ID (if any)"}),e.jsx("input",{value:j.school_id||"",readOnly:!0,className:"w-full border rounded px-3 py-3 text-base bg-slate-50"})]})]})]}),e.jsxs("section",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"2. Contact & Billing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Contact name *"}),e.jsx("input",{value:j.contact_name,onChange:n=>Y(c=>({...c,contact_name:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Phone"}),e.jsx("input",{value:j.phone,onChange:n=>Y(c=>({...c,phone:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Email"}),e.jsx("input",{value:j.email,onChange:n=>Y(c=>({...c,email:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Billing name"}),e.jsx("input",{value:j.billing_name,onChange:n=>Y(c=>({...c,billing_name:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Billing city"}),e.jsx("input",{value:j.billing_city,onChange:n=>Y(c=>({...c,billing_city:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Billing state"}),e.jsx("input",{value:j.billing_state,onChange:n=>Y(c=>({...c,billing_state:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Billing pincode"}),e.jsx("input",{value:j.billing_pincode,onChange:n=>Y(c=>({...c,billing_pincode:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Billing address"}),e.jsx("input",{value:j.billing_address,onChange:n=>Y(c=>({...c,billing_address:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]})]}),e.jsxs("section",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"3. Shipping"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Shipping address"}),e.jsx("input",{value:j.shipping_address,onChange:n=>Y(c=>({...c,shipping_address:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Shipping city"}),e.jsx("input",{value:j.shipping_city,onChange:n=>Y(c=>({...c,shipping_city:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Shipping state / pincode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:j.shipping_state,onChange:n=>Y(c=>({...c,shipping_state:n.target.value})),className:"w-1/2 border rounded px-3 py-3 text-base"}),e.jsx("input",{value:j.shipping_pincode,onChange:n=>Y(c=>({...c,shipping_pincode:n.target.value})),className:"w-1/2 border rounded px-3 py-3 text-base"})]})]})]})]}),e.jsxs("section",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"4. Strengths (per medium/std)"}),e.jsx("div",{className:"text-xs text-slate-400 mb-2",children:"Add one row per medium/std — used to generate the requirements and books/courses automatically."}),e.jsx("div",{className:"space-y-2",children:(j.strengths||[]).map((n,c)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Medium"}),e.jsxs("select",{value:n.medium_id||"",onChange:_=>ee(c,"medium_id",_.target.value),className:"w-full border rounded px-2 py-2 text-sm",children:[e.jsx("option",{value:"",children:"—"}),pe.mediums.map(_=>e.jsx("option",{value:_.medium_id,children:_.medium_name},_.medium_id))]})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Standard"}),e.jsxs("select",{value:n.std_id||"",onChange:_=>ee(c,"std_id",_.target.value),className:"w-full border rounded px-2 py-2 text-sm",children:[e.jsx("option",{value:"",children:"—"}),pe.standards.map(_=>e.jsx("option",{value:_.std_id,children:_.std_name},_.std_id))]})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Students"}),e.jsx("input",{type:"number",min:"0",value:n.students,onChange:_=>ee(c,"students",Number(_.target.value||0)),className:"w-full border rounded px-2 py-2 text-sm"})]}),e.jsx("div",{className:"col-span-1 flex items-end",children:e.jsx("button",{type:"button",onClick:()=>P(c),className:"text-rose-600 text-sm",children:"Remove"})})]},c))}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{type:"button",onClick:b,className:"inline-flex items-center gap-2 px-3 py-2 bg-white border rounded text-sm",children:"Add Strength"})})]}),e.jsxs("section",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"5. Pricing & Notes"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Discount"}),e.jsx("input",{type:"number",value:j.discount_amount,onChange:n=>Y(c=>({...c,discount_amount:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Tax %"}),e.jsx("input",{type:"number",value:j.tax_percent,onChange:n=>Y(c=>({...c,tax_percent:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Notes"}),e.jsx("input",{value:j.notes,onChange:n=>Y(c=>({...c,notes:n.target.value})),className:"w-full border rounded px-3 py-3 text-base"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"submit",disabled:H,className:"inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700",children:H?"Submitting…":"Create Order"}),e.jsx("button",{type:"button",onClick:()=>{de(!1)},className:"inline-flex items-center gap-2 px-4 py-2 border rounded text-sm",children:"Cancel"}),je&&e.jsx("div",{className:"text-sm text-rose-600 ml-4",children:je})]})]})]})]}),ie&&e.jsxs("div",{className:"fixed inset-0 z-60 flex items-start sm:items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30",onClick:()=>Ne(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-2xl bg-white rounded-lg shadow-lg overflow-auto max-h-[80vh] p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold",children:["Edit Strengths — Order #",xe]}),e.jsx("div",{className:"text-xs text-slate-500",children:"Rows are medium / standard / students"})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>Ne(!1),className:"text-sm text-slate-500 hover:text-slate-700",children:"Close"})})]}),e.jsxs("div",{className:"space-y-3",children:[(_e||[]).map((n,c)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs("select",{value:n.medium_id||"",onChange:_=>X(c,"medium_id",_.target.value),className:"w-full border rounded px-2 py-2 text-sm",children:[e.jsx("option",{value:"",children:"— Medium —"}),pe.mediums.map(_=>e.jsx("option",{value:_.medium_id,children:_.medium_name},_.medium_id))]})}),e.jsx("div",{className:"col-span-4",children:e.jsxs("select",{value:n.std_id||"",onChange:_=>X(c,"std_id",_.target.value),className:"w-full border rounded px-2 py-2 text-sm",children:[e.jsx("option",{value:"",children:"— Standard —"}),pe.standards.map(_=>e.jsx("option",{value:_.std_id,children:_.std_name},_.std_id))]})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"number",min:"0",value:n.students,onChange:_=>X(c,"students",Number(_.target.value||0)),className:"w-full border rounded px-2 py-2 text-sm"})}),e.jsx("div",{className:"col-span-1 text-right",children:e.jsx("button",{onClick:()=>G(c),className:"text-rose-600 text-sm",children:"Remove"})})]},c)),e.jsx("div",{children:e.jsx("button",{onClick:f,className:"px-3 py-2 border rounded text-sm",children:"Add Strength"})}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-emerald-600 text-white rounded text-sm",children:"Save"}),e.jsx("button",{onClick:()=>Ne(!1),className:"px-4 py-2 border rounded text-sm",children:"Cancel"})]})]})]})]}),De&&Z&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black/30",onClick:()=>Se(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-3xl bg-white rounded-lg shadow-lg overflow-auto max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/public/images/Ank_Logo.png",alt:"Ank",className:"h-10 w-10 object-contain"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold",children:["Order #",Z.order_id]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Status: ",Z.status]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>m(Z.order_id),className:"px-3 py-1 border rounded text-sm",children:"Edit Strengths"}),e.jsx("button",{onClick:()=>Se(!1),className:"text-sm text-slate-500 hover:text-slate-700",children:"Close"})]})]}),e.jsxs("div",{className:"p-4 space-y-3 text-base",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"School:"})," ",Z.school_name||Z.billing_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",Z.contact_name," — ",Z.phone]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",Z.email||"—"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Order Date:"})," ",gs(Z.order_date||Z.created_at)]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-2",children:"Items"}),Z.items&&Z.items.length?e.jsx("div",{className:"overflow-auto border rounded",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"#"}),e.jsx("th",{className:"px-3 py-2",children:"Description"}),e.jsx("th",{className:"px-3 py-2",children:"Qty"}),e.jsx("th",{className:"px-3 py-2",children:"Unit"}),e.jsx("th",{className:"px-3 py-2",children:"Line"})]})}),e.jsx("tbody",{children:Z.items.map(n=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-3 py-2",children:n.item_id}),e.jsx("td",{className:"px-3 py-2",children:n.description}),e.jsx("td",{className:"px-3 py-2",children:n.qty}),e.jsx("td",{className:"px-3 py-2",children:n.unit_price}),e.jsx("td",{className:"px-3 py-2",children:n.line_total})]},n.item_id))})]})}):e.jsx("div",{className:"text-sm text-slate-500",children:"No items yet — run Generate to create items from requirements, or Reprice to compute pricing."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Strengths"}),e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:(Z.strengths||[]).map((n,c)=>e.jsxs("div",{className:"p-2 bg-slate-50 rounded text-sm",children:[e.jsxs("div",{className:"font-medium",children:[n.medium_name||n.medium_id," / ",n.std_name||n.std_id]}),e.jsxs("div",{className:"text-xs",children:["Students: ",n.students]})]},c))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Requirements"}),e.jsx("div",{className:"mt-2 space-y-2",children:Z.requirements&&Z.requirements.length?Z.requirements.map((n,c)=>{const _=Ie[n.req_id]||{price:100,saving:!1};return e.jsxs("div",{className:"p-2 bg-slate-50 rounded text-sm flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[n.medium_name," — ",n.std_name," ",n.item_type==="book"?"• Book":"• Course"]}),e.jsxs("div",{className:"text-xs",children:["Unit qty: ",n.unit_qty," • Students: ",n.students," • Total: ",n.total_qty]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Course: ",n.course_id||"—"," Book: ",n.book_id||"—"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:_.price,onChange:U=>me(n.req_id,Number(U.target.value||0)),className:"w-24 border rounded px-2 py-1 text-sm"}),e.jsx("button",{onClick:()=>ue(n),disabled:_.saving,className:"px-3 py-1 border rounded text-sm bg-white hover:bg-slate-100",children:_.saving?"Saving…":"Save"})]})]},n.req_id||c)}):e.jsx("div",{className:"text-sm text-slate-500",children:"No requirements found for this order."})})]}),e.jsxs("div",{className:"border rounded p-3 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Invoice"}),e.jsx("div",{className:"text-sm text-slate-600",children:oe[Z.order_id]?e.jsxs(e.Fragment,{children:["Invoice #: ",oe[Z.order_id].invoice_number||"—"," • Status: ",oe[Z.order_id].status||"—"," • Amount: ",oe[Z.order_id].total_amount!=null?oe[Z.order_id].total_amount:"—"]}):e.jsx("span",{className:"text-slate-500",children:"No invoice associated yet."})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:async()=>{try{Me(!0);const n=await ye(Z.order_id);if(!n){alert("Failed to create invoice for this order. (No server endpoint available)");return}alert(`Invoice created: id=${n.invoice_id}`),y(Z.order_id)}catch(n){console.error(n),alert("Failed to create invoice")}finally{Me(!1)}},className:"px-3 py-2 border rounded text-sm bg-white hover:bg-slate-100",disabled:se,children:se?"Working…":"Create Invoice"}),e.jsx("button",{onClick:async()=>{const n=oe[Z.order_id];if(n&&n.invoice_id)try{Me(!0);const c=await Le(n.invoice_id);c&&c.url?(ge(_=>({..._||{},[n.invoice_id]:c.url})),alert("PDF generated. Use Download to fetch the file or open the returned URL.")):alert("PDF generation requested. It may be available shortly.")}catch(c){alert((c==null?void 0:c.message)||"Failed to generate PDF")}finally{Me(!1),y(Z.order_id)}else await we(Z.order_id)},className:"px-3 py-2 border rounded text-sm bg-white hover:bg-slate-100",disabled:se,children:se?"Generating…":"Generate PDF"}),e.jsx("button",{onClick:async()=>{const n=oe[Z.order_id],c=n&&n.invoice_id;if(!c){alert("Invoice not available to download.");return}await be(c)},className:"px-3 py-2 border rounded text-sm bg-white hover:bg-slate-100",disabled:p,children:p?"Downloading…":"Download PDF"}),oe[Z.order_id]&&oe[Z.order_id].invoice_id&&te[oe[Z.order_id].invoice_id]&&e.jsx("a",{className:"px-3 py-2 border rounded text-sm bg-white hover:bg-slate-100",href:te[oe[Z.order_id].invoice_id],target:"_blank",rel:"noreferrer",children:"Open PDF"})]})]}),e.jsx("div",{className:"text-xs text-slate-400 mt-2",children:'Notes: "Create Invoice" will attempt to create an invoice via common endpoints. If your server uses a different path, implement one of: POST /api/orders/:orderId/invoice/generate OR POST /api/invoices/generate-from-order OR GET /api/orders/:orderId/invoice.'})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>B(Z.order_id),className:"inline-flex items-center gap-2 px-3 py-2 bg-white border rounded text-sm",children:[e.jsx(Xe,{name:"generate"})," Generate"]}),e.jsxs("button",{onClick:()=>i(Z.order_id),className:"inline-flex items-center gap-2 px-3 py-2 bg-white border rounded text-sm",children:[e.jsx(Xe,{name:"reprice"})," Reprice"]}),e.jsxs("button",{onClick:()=>N(Z),className:"inline-flex items-center gap-2 px-3 py-2 bg-emerald-600 text-white rounded text-sm",children:[e.jsx(Xe,{name:"confirm"})," Confirm"]}),e.jsxs("button",{onClick:()=>{confirm("Delete this order?")&&(I(Z.order_id),Se(!1))},className:"inline-flex items-center gap-2 px-3 py-2 text-rose-600 rounded text-sm border",children:[e.jsx(Xe,{name:"delete"})," Delete"]})]})]})]})]})]})}function bt({name:t,className:a="h-4 w-4 inline-block mr-2"}){const r={className:a,"aria-hidden":!0};switch(t){case"search":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M21 21l-4.35-4.35",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"11",cy:"11",r:"6",strokeWidth:"1.5"})]});case"save":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",strokeWidth:"1.3"}),e.jsx("path",{d:"M17 21v-8H7v8",strokeWidth:"1.3"})]});case"generate":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M21 12a9 9 0 1 1-9-9",strokeWidth:"1.5"}),e.jsx("path",{d:"M12 3v9l3 3",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]});case"reprice":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M21 12v6a2 2 0 0 1-2 2H5",strokeWidth:"1.5"}),e.jsx("path",{d:"M7 7h10",strokeWidth:"1.5"}),e.jsx("path",{d:"M12 3v4",strokeWidth:"1.5"})]});case"confirm":return e.jsx("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M5 13l4 4L19 7",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})});case"edit":return e.jsxs("svg",{...r,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("path",{d:"M3 21v-3.75L14.06 6.19l3.75 3.75L6.75 21H3z",strokeWidth:"1.3"}),e.jsx("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41L18.37 3.29a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",strokeWidth:"1.3"})]});default:return null}}function ul(t){if(!t)return"—";try{return new Date(t).toLocaleString()}catch{return t}}function hl(){var Ie;const[t,a]=s.useState([]),[r,u]=s.useState(""),[v,M]=s.useState(!1),[S,L]=s.useState(!1),[g,R]=s.useState(null),[h,w]=s.useState([]),[D,q]=s.useState({}),[$,ae]=s.useState({}),[F,ce]=s.useState(!1),[ne,J]=s.useState(!1),le=s.useRef(null);s.useEffect(()=>{Q()},[]);async function Q(){M(!0);try{const x=await E.get("/api/orders",{query:{page:1,pageSize:100},background:!0});x&&x.data?a(x.data):a([])}catch(x){console.warn("Failed to load orders list",x),a([])}finally{M(!1)}}async function pe(x){if(!x){R(null),w([]),q({}),ae({});return}L(!0);try{const H=await E.get(`/api/orders/${x}`,{query:{include:"requirements,strengths,items"}});if(H&&H.data){R(H.data),w((H.data.strengths||[]).map(l=>({medium_id:l.medium_id||"",std_id:l.std_id||"",students:l.students||0})));const fe={};if(H.data.requirements&&H.data.requirements.length)for(const l of H.data.requirements)if(l.book_id)try{const j=await E.get(`/api/books/${l.book_id}`,{background:!0});fe[l.req_id]={price:j&&j.data&&j.data.price!=null?Number(j.data.price):100,saving:!1}}catch{fe[l.req_id]={price:100,saving:!1}}else fe[l.req_id]={price:100,saving:!1};q(fe);const je={};(H.data.items||[]).forEach(l=>{je[l.item_id]={unit_price:l.unit_price!=null?Number(l.unit_price):0,saving:!1}}),ae(je)}else alert("Failed to load order.")}catch(H){console.error("loadOrder error",H),alert("Failed to load order.")}finally{L(!1)}}function re(){w(x=>[...x||[],{medium_id:"",std_id:"",students:0}])}function O(x,H,fe){w(je=>je.map((l,j)=>j===x?{...l,[H]:fe}:l))}function de(x){w(H=>H.filter((fe,je)=>je!==x))}async function De(){if(!(!g||!g.order_id)){ce(!0);try{const x=(h||[]).map(H=>({medium_id:H.medium_id?Number(H.medium_id):null,std_id:H.std_id?Number(H.std_id):null,students_cnt:Number(H.students)||0}));await E.post(`/api/orders/${g.order_id}/strengths`,{strengths:x}),alert("Strengths saved."),await E.post(`/api/orders/${g.order_id}/generate`).catch(()=>{}),await pe(g.order_id)}catch(x){console.error("saveStrengths error",x),alert("Failed to save strengths.")}finally{ce(!1)}}}async function Se(){if(!(!g||!g.order_id)&&confirm("Generate requirements for this order? This will replace existing requirements.")){J(!0);try{const x=await E.post(`/api/orders/${g.order_id}/generate`);if(x&&x.ok)alert(`Generated ${x.generated??"some"} requirements.`),await pe(g.order_id);else throw new Error(x&&(x.error||x.message)||"Generate failed")}catch(x){console.error("generate error",x),alert((x==null?void 0:x.message)||"Generate failed.")}finally{J(!1)}}}async function Z(){if(!(!g||!g.order_id)&&confirm("Reprice this order? This will run server-side pricing logic.")){J(!0);try{const x=await E.post(`/api/orders/${g.order_id}/reprice`);if(x&&x.ok)alert("Reprice requested."),await pe(g.order_id);else throw new Error(x&&(x.error||x.message)||"Reprice failed")}catch(x){console.error("reprice error",x),alert((x==null?void 0:x.message)||"Reprice failed.")}finally{J(!1)}}}function Fe(x,H){q(fe=>({...fe||{},[x]:{...fe[x]||{},price:H}}))}async function ie(x){const H=D[x.req_id];if(!H)return;const fe=Number(H.price||0);if(!Number.isFinite(fe)||fe<0){alert("Enter a valid price >= 0");return}if(x.book_id){q(je=>({...je||{},[x.req_id]:{...je[x.req_id]||{},saving:!0}}));try{await E.put(`/api/books/${x.book_id}`,{price:fe}),alert("Book price updated."),await Z()}catch(je){console.error("Failed to update book price",je),alert("Failed to save price."),q(l=>({...l||{},[x.req_id]:{...l[x.req_id]||{},saving:!1}}))}}else q(je=>({...je||{},[x.req_id]:{...je[x.req_id]||{},price:fe}})),alert("Price updated locally. Run Reprice to apply server-side.")}function Ne(x,H){ae(fe=>({...fe||{},[x]:{...fe[x]||{},unit_price:H}}))}async function xe(x){const H=$[x.item_id];if(!H)return;const fe=Number(H.unit_price||0);if(!Number.isFinite(fe)||fe<0){alert("Enter a valid unit price >= 0");return}ae(je=>({...je||{},[x.item_id]:{...je[x.item_id]||{},saving:!0}}));try{const je=await E.put(`/api/orders/${g.order_id}/items/${x.item_id}`,{unit_price:fe});if(je&&je.ok)alert("Item price updated."),await pe(g.order_id);else throw new Error(je&&(je.error||je.message)||"Item price update failed")}catch(je){console.error("saveItemPrice error",je),alert((je==null?void 0:je.message)||"Failed to save item price.")}finally{ae(je=>({...je||{},[x.item_id]:{...je[x.item_id]||{},saving:!1}}))}}async function Re(){if(!(!g||!g.order_id)&&confirm("Confirm this order? This will mark the order confirmed on server and may delete the associated converted lead.")){J(!0);try{const x=await E.post(`/api/orders/${g.order_id}/confirm`);if(x&&x.ok)alert("Order confirmed."),await Q(),R(null),u("");else throw new Error(x&&(x.error||x.message)||"Confirm failed")}catch(x){console.error("confirm error",x),alert((x==null?void 0:x.message)||"Confirm failed")}finally{J(!1)}}}function _e(){if(!g)return{itemsTotal:0,itemsCount:0};const x=g.items||[];return{itemsTotal:x.reduce((fe,je)=>fe+(Number(je.line_total||je.qty*(je.unit_price||0))||0),0),itemsCount:x.length}}const ke=_e();return e.jsxs("main",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Strengths & Requirements"}),e.jsx("div",{className:"text-sm text-slate-500 mt-1",children:"Finalize strengths, requirements, book prices, item prices and confirm orders."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>{Q()},className:"px-3 py-2 border rounded text-sm",children:"Refresh list"}),e.jsx("button",{onClick:()=>{g&&g.order_id?pe(g.order_id):r&&pe(r)},className:"px-3 py-2 bg-indigo-600 text-white rounded text-sm",children:"Load Order"})]})]}),e.jsx("div",{className:"bg-white border rounded-lg p-4 shadow-sm mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-center",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Select order"}),e.jsxs("div",{className:"mt-1 flex gap-2 items-center",children:[e.jsxs("select",{ref:le,value:r,onChange:x=>{u(x.target.value)},className:"w-full border rounded px-3 py-3 text-base",children:[e.jsx("option",{value:"",children:"— select order —"}),v?e.jsx("option",{children:"Loading…"}):t.length?t.map(x=>e.jsxs("option",{value:x.order_id,children:["#",x.order_id," — ",x.school_name||x.billing_name||x.contact_name," — ",x.status||"—"]},x.order_id)):e.jsx("option",{children:"No recent orders"})]}),e.jsx("button",{onClick:()=>{if(!r)return alert("Select an order first.");pe(r)},className:"px-3 py-2 border rounded text-sm",children:"Open"})]}),e.jsx("div",{className:"text-xs text-slate-400 mt-1",children:"You can also type an order id and press Open."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-slate-500",children:"Selected order"}),e.jsx("div",{className:"text-lg font-medium",children:g?`#${g.order_id} — ${g.status||"—"}`:"—"})]})]})}),S?e.jsx("div",{className:"bg-white border rounded-lg p-8 text-center text-slate-500",children:"Loading order…"}):g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold",children:["Order #",g.order_id," — ",g.school_name||g.billing_name]}),e.jsxs("div",{className:"text-sm text-slate-500",children:["Contact: ",g.contact_name," — ",g.phone," • Order Date: ",ul(g.order_date||g.created_at)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Items: ",ke.itemsCount]}),e.jsxs("div",{className:"text-xl font-semibold",children:["Total: ₹",ke.itemsTotal.toFixed(2)]})]})]}),e.jsxs("section",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold",children:"Strengths"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Per-medium / per-standard student counts. Save to regenerate requirements."})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:re,className:"px-3 py-2 border rounded text-sm mr-2",children:"Add row"}),e.jsxs("button",{onClick:De,disabled:F,className:"px-3 py-2 bg-emerald-600 text-white rounded text-sm",children:[e.jsx(bt,{name:"save"})," ",F?"Saving…":"Save strengths"]})]})]}),e.jsx("div",{className:"space-y-2",children:h.length?h.map((x,H)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Medium"}),e.jsx("input",{value:x.medium_id,onChange:fe=>O(H,"medium_id",fe.target.value),placeholder:"medium id",className:"w-full border rounded px-2 py-2 text-sm"})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Standard"}),e.jsx("input",{value:x.std_id,onChange:fe=>O(H,"std_id",fe.target.value),placeholder:"std id",className:"w-full border rounded px-2 py-2 text-sm"})]}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("label",{className:"text-xs text-slate-500",children:"Students"}),e.jsx("input",{type:"number",min:"0",value:x.students,onChange:fe=>O(H,"students",Number(fe.target.value||0)),className:"w-full border rounded px-2 py-2 text-sm"})]}),e.jsx("div",{className:"col-span-1 text-right",children:e.jsx("button",{onClick:()=>de(H),className:"text-rose-600 text-sm",children:"Remove"})})]},H)):e.jsx("div",{className:"text-sm text-slate-500",children:"No strengths yet."})})]}),e.jsxs("section",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold",children:"Requirements"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Edit prices per requirement (updates book price if the requirement points to a book)."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Se,disabled:ne,className:"px-3 py-2 border rounded text-sm",children:[e.jsx(bt,{name:"generate"})," Generate"]}),e.jsxs("button",{onClick:Z,disabled:ne,className:"px-3 py-2 border rounded text-sm",children:[e.jsx(bt,{name:"reprice"})," Reprice"]})]})]}),e.jsx("div",{className:"space-y-2",children:g.requirements&&g.requirements.length?g.requirements.map((x,H)=>{const fe=D[x.req_id]||{price:100,saving:!1};return e.jsxs("div",{className:"p-2 bg-slate-50 rounded text-sm flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[x.medium_name||x.medium_id," — ",x.std_name||x.std_id," • ",x.item_type==="book"?"Book":"Course"]}),e.jsxs("div",{className:"text-xs",children:["Unit qty: ",x.unit_qty," • Students: ",x.students," • Total: ",x.total_qty]}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Course: ",x.course_id||"—"," • Book: ",x.book_id||"—"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:fe.price,onChange:je=>Fe(x.req_id,Number(je.target.value||0)),className:"w-28 border rounded px-2 py-1 text-sm"}),e.jsx("button",{onClick:()=>ie(x),disabled:fe.saving,className:"px-3 py-1 border rounded text-sm bg-white hover:bg-slate-100",children:fe.saving?"Saving…":"Save"})]})]},x.req_id||H)}):e.jsx("div",{className:"text-sm text-slate-500",children:"No requirements found for this order."})})]}),e.jsxs("section",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold",children:"Items"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Edit item unit prices (will call PUT /api/orders/:orderId/items/:itemId and trigger server totals update)."})]}),e.jsxs("div",{className:"text-sm",children:["Items: ",((Ie=g.items)==null?void 0:Ie.length)||0]})]}),e.jsx("div",{className:"space-y-3",children:g.items&&g.items.length?g.items.map(x=>{const H=$[x.item_id]||{unit_price:x.unit_price||0,saving:!1};return e.jsxs("div",{className:"p-3 bg-slate-50 rounded flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:x.description||`Item #${x.item_id}`}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Qty: ",x.qty," • Course: ",x.course_id||"—"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"0",value:H.unit_price,onChange:fe=>Ne(x.item_id,Number(fe.target.value||0)),className:"w-28 border rounded px-2 py-1 text-sm"}),e.jsx("button",{onClick:()=>xe(x),disabled:H.saving,className:"px-3 py-1 border rounded text-sm bg-white hover:bg-slate-100",children:H.saving?"Saving…":"Save"}),e.jsxs("div",{className:"text-sm font-medium",children:["Line: ₹",(x.line_total!=null?Number(x.line_total):x.qty*(H.unit_price||0)).toFixed(2)]})]})]},x.item_id)}):e.jsx("div",{className:"text-sm text-slate-500",children:"No items for this order. Run Generate & Reprice to create items."})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:()=>pe(g.order_id),className:"px-3 py-2 border rounded text-sm",children:"Reload"}),e.jsxs("button",{onClick:Re,disabled:ne,className:"px-4 py-2 bg-emerald-600 text-white rounded text-sm",children:[e.jsx(bt,{name:"confirm"})," ",ne?"Processing…":"Confirm Order"]})]})]}):e.jsx("div",{className:"bg-white border rounded-lg p-8 text-center text-slate-500",children:"No order selected. Pick one above and press Open."})]})}const pl={"--tbl-primary":"#06b6d4","--tbl-primary-600":"#0ea5a4","--tbl-accent":"#0b8793","--tbl-bg":"#ffffff","--tbl-surface":"#f8fafc","--tbl-border":"#e6edf0","--tbl-text":"#0f172a","--tbl-muted":"#64748b","--tbl-success":"#10b981","--tbl-danger":"#ef4444","--tbl-warning":"#f59e0b"};s.createContext({theme:pl});$t.object,$t.node,$t.oneOf(["local","global"]);const xl=(t,a,r="export.csv")=>{var L;const u=a.map(g=>g.Header??(typeof g.accessor=="string"?g.accessor:"column")).join(","),v=t.map(g=>a.map(R=>{const h=typeof R.accessor=="function"?R.accessor(g):g[R.accessor];return'"'+String(h??"").replace(/"/g,'""')+'"'}).join(",")).join(`
`),M=u+`
`+v,S=new Blob([M],{type:"text/csv;charset=utf-8;"});try{if(ra&&typeof as.saveAs=="function")as.saveAs(S,r);else if(typeof window<"u"&&typeof((L=window.navigator)==null?void 0:L.msSaveOrOpenBlob)=="function")window.navigator.msSaveOrOpenBlob(S,r);else{const g=URL.createObjectURL(S),R=document.createElement("a");R.href=g,R.download=r,document.body.appendChild(R),R.click(),R.remove(),URL.revokeObjectURL(g)}}catch{const R=URL.createObjectURL(S),h=document.createElement("a");h.href=R,h.download=r,document.body.appendChild(h),h.click(),h.remove(),URL.revokeObjectURL(R)}},Bs=({columns:t=[],data:a=[],emptyMessage:r="No records"})=>e.jsx("div",{className:"w-full overflow-x-auto bg-white rounded-lg shadow-sm",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-slate-50 border-b",children:e.jsx("tr",{children:t.map(u=>e.jsx("th",{className:"text-left px-4 py-3 text-sm font-medium text-slate-700",children:u.Header},u.accessor||u.Header))})}),e.jsxs("tbody",{className:"divide-y",children:[a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:t.length,className:"p-6 text-center text-sm text-slate-500",children:r})}),a.map((u,v)=>e.jsx("tr",{className:"hover:bg-slate-50",children:t.map(M=>e.jsx("td",{className:"px-4 py-3 text-sm align-top",children:M.Cell?M.Cell(u):typeof M.accessor=="function"?M.accessor(u):u[M.accessor]},M.accessor||M.Header))},v))]})]})}),Hs=({columns:t=[],onFetch:a,initialPageSize:r=10,selectable:u=!1})=>{const[v,M]=s.useState(1),[S,L]=s.useState(r),[g,R]=s.useState(null),[h,w]=s.useState("asc"),[D,q]=s.useState([]),[$,ae]=s.useState(0),[F,ce]=s.useState(!1),ne=s.useCallback(async()=>{ce(!0);try{const le=await a({page:v,pageSize:S,sortBy:g,sortDir:h});q(le.data||[]),ae(le.total??le.data.length)}finally{ce(!1)}},[v,S,g,h,a]);s.useEffect(()=>{ne()},[ne]);const J=Math.max(1,Math.ceil($/S));return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[F&&e.jsx("div",{className:"p-3 border-b text-sm text-slate-500",children:"Loading..."}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[u&&e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox"})}),t.map(le=>e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>{g===le.accessor?w(Q=>Q==="asc"?"desc":"asc"):(R(le.accessor),w("asc"))},className:"flex items-center gap-2",children:le.Header})})},le.accessor||le.Header))]})}),e.jsxs("tbody",{className:"divide-y",children:[D.map((le,Q)=>e.jsxs("tr",{className:"hover:bg-slate-50 cursor-pointer",children:[u&&e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox"})}),t.map(pe=>e.jsx("td",{className:"px-4 py-3 text-sm align-top",children:pe.Cell?pe.Cell(le):typeof pe.accessor=="function"?pe.accessor(le):le[pe.accessor]},pe.accessor||pe.Header))]},le.id??Q)),D.length===0&&!F&&e.jsx("tr",{children:e.jsx("td",{colSpan:t.length+(u?1:0),className:"p-6 text-center",children:"No records"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 border-t",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:[(v-1)*S+1," - ",Math.min(v*S,$)," of ",$]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded-md border",disabled:v===1,onClick:()=>M(1),children:"«"}),e.jsx("button",{className:"px-2 py-1 rounded-md border",disabled:v===1,onClick:()=>M(le=>Math.max(1,le-1)),children:"‹"}),e.jsxs("span",{className:"px-2 py-1",children:[v," / ",J]}),e.jsx("button",{className:"px-2 py-1 rounded-md border",disabled:v===J,onClick:()=>M(le=>Math.min(J,le+1)),children:"›"}),e.jsx("button",{className:"px-2 py-1 rounded-md border",disabled:v===J,onClick:()=>M(J),children:"»"})]})]})]})},ts=({columns:t=[],rows:a=[],filename:r="export.csv"})=>e.jsx("button",{onClick:()=>xl(a,t,r),className:"px-3 py-2 rounded-md border",children:"Export CSV"}),vs=25,qt=50*1024,ct="/images/ANK.png",gl="/images/Ank_Logo.png";function fl(){const[t,a]=s.useState(!1),[r,u]=s.useState(!1),[v,M]=s.useState(0),[S,L]=s.useState([]),[g,R]=s.useState(""),[h,w]=s.useState(!1),[D,q]=s.useState(null),[$,ae]=s.useState(""),[F,ce]=s.useState(Ne()),[ne,J]=s.useState([]),[le,Q]=s.useState([]),[pe,re]=s.useState([]),[O,de]=s.useState({}),[De,Se]=s.useState(0),[Z,Fe]=s.useState(!1),ie=s.useRef(null);s.useEffect(()=>{xe();const p=()=>Fe(!1);return window.addEventListener("focus",p),()=>window.removeEventListener("focus",p)},[]);function Ne(){return{school_name:"",address:"",district_id:"",state_id:"",medium_id:"",contact_person:"",contact_no:"",email:"",image:"",user:{username:"",email:"",password:"",must_change_password:!1,role_name:"school_admin"}}}async function xe(){try{const p=await E.get("/api/master/mediums");J(p.data||[])}catch(p){console.warn("Failed to load mediums",p.message||p),J([])}try{const p=await E.get("/api/master",{query:{table:"states"}});Q(p.data||p||[])}catch(p){console.warn("Failed to load states",p.message||p),Q([])}try{const p=await E.get("/api/master",{query:{table:"districts"}});re(p.data||p||[])}catch(p){console.warn("Failed to load districts",p.message||p),re([])}}function Re(){q(null),ce(Ne()),ae(""),de({}),w(!0)}function _e(p){q(p),ce({school_name:p.school_name||"",address:p.address||"",district_id:p.district_id||"",state_id:p.state_id||"",medium_id:p.medium_id||"",contact_person:p.contact_person||"",contact_no:p.contact_no||"",email:p.email||"",image:p.image||"",user:{username:p.user_name||"",email:p.user_email||"",password:"",must_change_password:!1,role_name:"school_admin"}}),ae(""),de({}),w(!0)}function ke(){Z||(w(!1),q(null),ae(""),de({}))}function Ie(){var T,te;const p=F.user||{};if(p.username&&p.username.trim()||p.email&&p.email.trim()||p.password&&p.password.trim()){const ge={username:((T=p.username)==null?void 0:T.trim())||void 0,email:((te=p.email)==null?void 0:te.trim())||void 0,password:p.password||void 0,must_change_password:!!p.must_change_password,role_name:p.role_name||"school_admin"};return Object.values(ge).some(Ee=>Ee!==void 0&&Ee!=="")?ge:void 0}}async function x(p){var Ee,Ce,z,W,V,o,b,P,ee,d;if(!p)return;if(p.size>qt){const y=`File too large — max ${Math.round(qt/1024)}KB allowed.`;ae(y),(Ce=(Ee=window.ui)==null?void 0:Ee.toast)==null||Ce.call(Ee,y,"danger");return}const T=new FormData;T.append("logo",p);const te=["/api/schools/schools/upload-logo","/api/schools/schools/school/upload-logo","/api/schools/schools/schools/upload-logo"];let ge=null;for(const y of te)try{const C=await E.post(y,T,{headers:{}}),B=(C==null?void 0:C.url)||(C==null?void 0:C.data)&&C.data.url||(typeof C=="string"?C:void 0);B?ce(i=>({...i,image:B})):C&&C.data&&C.data.path?ce(i=>({...i,image:C.data.path})):ae("Upload succeeded but server didn't return image URL"),(W=(z=window.ui)==null?void 0:z.toast)==null||W.call(z,"Logo uploaded","success");return}catch(C){ge=C;const B=C==null?void 0:C.status,i=(C==null?void 0:C.message)||(C==null?void 0:C.data)&&C.data.message||"";if(B===404||/Cannot (POST|PUT|GET)/i.test(i)||/Not Found/i.test(i))continue;const N=((V=C==null?void 0:C.data)==null?void 0:V.message)||(C==null?void 0:C.message)||"Upload failed";ae(N),(b=(o=window.ui)==null?void 0:o.toast)==null||b.call(o,N,"danger");return}console.error("Upload logo failed for all tried endpoints",ge);const oe=((P=ge==null?void 0:ge.data)==null?void 0:P.message)||(ge==null?void 0:ge.message)||"Upload endpoint not found on server. Tried multiple paths.";ae(oe),(d=(ee=window.ui)==null?void 0:ee.toast)==null||d.call(ee,oe,"danger")}async function H(p){var oe;const T=((oe=p==null?void 0:p.target)==null?void 0:oe.files)??p,te=T&&T[0];if(!te){Fe(!1);return}const ge=new FileReader;ge.onload=()=>{ce(Ee=>({...Ee,image:ge.result}))},ge.readAsDataURL(te);try{await x(te)}finally{Fe(!1),ie.current&&(ie.current.value="")}}async function fe(p){var T,te,ge,oe,Ee,Ce,z,W,V,o;(T=p==null?void 0:p.preventDefault)==null||T.call(p),u(!0),ae(""),de({});try{const b={};if((!F.school_name||!F.school_name.trim())&&(b.school_name="School name is required"),(!F.email||!/^\S+@\S+\.\S+$/.test(F.email))&&(b.email="Valid email required"),F.contact_no&&!/^[\d+\-\s()]{6,20}$/.test(F.contact_no)&&(b.contact_no="Enter a valid phone number"),(te=F.user)!=null&&te.email&&!/^\S+@\S+\.\S+$/.test(F.user.email)&&(b["user.email"]="Valid email required"),(ge=F.user)!=null&&ge.password&&F.user.password.length>0&&F.user.password.length<8&&(b["user.password"]="Password must be >= 8 characters"),Object.keys(b).length){de(b),u(!1);return}const P={school_name:F.school_name,address:F.address||null,district_id:F.district_id||null,state_id:F.state_id||null,medium_id:F.medium_id||null,contact_person:F.contact_person||null,contact_no:F.contact_no||null,email:F.email,image:F.image||null},ee=Ie();ee&&(P.user=ee),D&&D.school_id?(await E.put(`/api/schools/schools/${D.school_id}`,P),(Ee=(oe=window.ui)==null?void 0:oe.toast)==null||Ee.call(oe,"School updated","success")):(await E.post("/api/schools/schools",P),(z=(Ce=window.ui)==null?void 0:Ce.toast)==null||z.call(Ce,"School created","success")),Se(d=>d+1),ke()}catch(b){console.error("Save school error",b);const P=((W=b==null?void 0:b.data)==null?void 0:W.message)||(b==null?void 0:b.message)||"Failed to save school";ae(P),(b==null?void 0:b.status)===409&&((o=(V=window.ui)==null?void 0:V.toast)==null||o.call(V,"Username or email already exists","danger"))}finally{u(!1)}}async function je(p){var T,te,ge,oe,Ee;if(window.confirm(`Delete school "${p.school_name}"? This cannot be undone.`))try{await E.del(`/api/schools/schools/${p.school_id}`),(te=(T=window.ui)==null?void 0:T.toast)==null||te.call(T,"School deleted","success"),Se(Ce=>Ce+1)}catch(Ce){console.error("Delete school error",Ce);const z=((ge=Ce==null?void 0:Ce.data)==null?void 0:ge.message)||(Ce==null?void 0:Ce.message)||"Failed to delete";(Ee=(oe=window.ui)==null?void 0:oe.toast)==null||Ee.call(oe,z,"danger")}}async function l(){var p,T;try{await E.download("/api/schools/schools/export/csv",{filename:"schools.csv"})}catch(te){console.error("Export CSV error",te),(T=(p=window.ui)==null?void 0:p.toast)==null||T.call(p,(te==null?void 0:te.message)||"Export failed","danger")}}async function j(){var p,T;try{await E.download("/api/schools/schools/export/xlsx",{filename:"schools.xlsx"})}catch(te){console.error("Export XLSX error",te),(T=(p=window.ui)==null?void 0:p.toast)==null||T.call(p,(te==null?void 0:te.message)||"Export failed","danger")}}async function Y(p){var ge,oe,Ee,Ce,z;const T=p.target.files&&p.target.files[0];if(!T)return;const te=new FormData;te.append("file",T);try{const W=await E.post("/api/schools/schools/import",te,{headers:{}});(oe=(ge=window.ui)==null?void 0:ge.toast)==null||oe.call(ge,(W==null?void 0:W.message)||"Import done","success"),Se(V=>V+1)}catch(W){console.error("Import error",W),(z=(Ee=window.ui)==null?void 0:Ee.toast)==null||z.call(Ee,((Ce=W==null?void 0:W.data)==null?void 0:Ce.message)||(W==null?void 0:W.message)||"Import failed","danger")}finally{p.target.value=""}}const se=[{Header:"Logo",accessor:"image",Cell:p=>{const T=p.image||ct;return e.jsx("div",{className:"h-12 w-12 overflow-hidden flex items-center justify-center bg-white",children:e.jsx("img",{src:T,alt:p.school_name,className:"h-full w-full object-cover",onError:te=>te.currentTarget.src=ct})})}},{Header:"Name",accessor:"school_name",Cell:p=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:p.school_name}),e.jsx("div",{className:"text-sm text-gray-500",children:p.address})]})},{Header:"Contact",accessor:"contact_person",Cell:p=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:p.contact_person||"-"}),e.jsx("div",{className:"text-sm text-gray-500",children:p.contact_no||"-"})]})},{Header:"Email",accessor:"email"},{Header:"Medium",accessor:"medium_name"},{Header:"Created",accessor:"created_at",Cell:p=>p.created_at?new Date(p.created_at).toLocaleString():""},{Header:"Actions",accessor:"actions",Cell:p=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(He,{size:"sm",onClick:T=>{T.stopPropagation(),_e(p)},children:"Edit"}),e.jsx(Jt,{size:"sm",onClick:T=>{T.stopPropagation(),je(p)},children:"Delete"})]})}],Me=s.useCallback(async({page:p=1,pageSize:T=vs,sortBy:te,sortDir:ge})=>{const oe={page:p,pageSize:T,search:g||void 0};te&&(oe.sortBy=typeof te=="string"?te:te.accessor||te,oe.sortDir=ge||"asc");try{const Ee=await E.get("/api/schools/schools",{query:oe}),Ce=Ee.data||[],z=Ee.pagination&&Ee.pagination.total||(Ee.total??Ce.length)||0;return L(Ce),M(z),{data:Ce,total:z}}catch(Ee){return console.error("ServerDataTable fetch error",Ee),L([]),M(0),{data:[],total:0}}},[g]);return e.jsxs("div",{className:"p-6 text-base antialiased",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold leading-tight",children:"Schools"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Manage registered schools & their admins"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Dt,{onClick:Re}),e.jsx(Qe,{onClick:l,children:"Export CSV"}),e.jsx(Qe,{onClick:j,children:"Export XLSX"}),e.jsx(Zt,{onChange:Y,accept:".csv,text/csv",children:"Import CSV"})]})]}),e.jsxs("div",{className:"mb-4 flex gap-3 items-center",children:[e.jsx("input",{placeholder:"Search by name / email / username",value:g,onChange:p=>R(p.target.value),className:"input input-md flex-1 text-lg"}),e.jsx(He,{onClick:()=>Se(p=>p+1),children:"Search"})]}),$&&e.jsx("div",{className:"text-red-600 mb-3 text-sm",children:$}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-sm border",children:e.jsx(Hs,{columns:se,onFetch:Me,initialPageSize:vs,selectable:!1},De)}),h&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>{Z||ke()}}),e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-3xl transform transition-all duration-300 scale-100",onClick:p=>p.stopPropagation(),role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-t-2xl",style:{background:"linear-gradient(90deg,#E1E0ECFF 0%, #C8E6EEFF 100%)"},children:[e.jsx("img",{src:gl,alt:"Ank",className:"h-16 w-auto rounded-none shadow-md",onError:p=>p.currentTarget.src=ct}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-black",children:D?`Edit: ${D.school_name}`:"Create School"}),e.jsx("div",{className:"text-sm opacity-100 text-black",children:"Fill school details and optional user account"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(Qe,{onClick:ke,children:"Close"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:fe,className:"space-y-4",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(K,{label:"School Name *",required:!0,error:O.school_name,children:e.jsx(ze,{value:F.school_name,onChange:p=>{ce(T=>({...T,school_name:p})),de(T=>({...T,school_name:void 0}))},placeholder:"School name",className:"w-full",clearable:!0})})}),e.jsx("div",{children:e.jsx(K,{label:"Email *",required:!0,error:O.email,children:e.jsx(ze,{value:F.email,onChange:p=>{ce(T=>({...T,email:p})),de(T=>({...T,email:void 0}))},placeholder:"school@example.com",className:"w-full",clearable:!0})})}),e.jsx("div",{children:e.jsx(K,{label:"Contact Person",error:O.contact_person,children:e.jsx(ze,{value:F.contact_person,onChange:p=>{ce(T=>({...T,contact_person:p})),de(T=>({...T,contact_person:void 0}))},placeholder:"Contact person"})})}),e.jsx("div",{children:e.jsx(K,{label:"Contact No",error:O.contact_no,children:e.jsx(ze,{value:F.contact_no,onChange:p=>{ce(T=>({...T,contact_no:p})),de(T=>({...T,contact_no:void 0}))},placeholder:"+91 9xxxx xxxxx"})})}),e.jsx("div",{children:e.jsx(K,{label:"State",error:O.state_id,children:e.jsx(Te,{value:F.state_id||"",onChange:p=>{ce(T=>({...T,state_id:p})),de(T=>({...T,state_id:void 0}))},options:le.map(p=>({value:p.state_id||p.id,label:p.state_name||p.name}))})})}),e.jsx("div",{children:e.jsx(K,{label:"District",error:O.district_id,children:e.jsx(Te,{value:F.district_id||"",onChange:p=>{ce(T=>({...T,district_id:p})),de(T=>({...T,district_id:void 0}))},options:pe.map(p=>({value:p.district_id||p.id,label:p.district_name||p.name}))})})}),e.jsx("div",{children:e.jsx(K,{label:"Medium",error:O.medium_id,children:e.jsx(Te,{value:F.medium_id||"",onChange:p=>{ce(T=>({...T,medium_id:p})),de(T=>({...T,medium_id:void 0}))},options:ne.map(p=>({value:p.medium_id||p.id,label:p.medium_name||p.name}))})})}),e.jsx("div",{children:e.jsx(K,{label:"Address",error:O.address,children:e.jsx(ze,{value:F.address,onChange:p=>{ce(T=>({...T,address:p})),de(T=>({...T,address:void 0}))}})})}),e.jsx("div",{className:"col-span-2 flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-28 w-28 overflow-hidden shadow-lg bg-white flex-shrink-0",children:e.jsx("img",{src:F.image||ct,alt:"logo-preview",className:"object-cover h-full w-full",onError:p=>p.currentTarget.src=ct})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{ref:ie,type:"file",accept:"image/*",className:"hidden",onClick:p=>{p.stopPropagation()},onFocus:()=>Fe(!0),onChange:p=>{Fe(!0),H(p.target.files)}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{size:"sm",onMouseDown:p=>p.preventDefault(),onClick:()=>{Fe(!0),ie.current&&ie.current.click()},children:"Upload Logo"}),F.image&&e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),ce(T=>({...T,image:""}))},className:"px-3 py-1 rounded-md border",children:"Remove"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:["Max: ",Math.round(qt/1024),"KB. PNG/JPG recommended."]})]})]})})]}),e.jsx("hr",{className:"my-2"}),e.jsx("h4",{className:"font-semibold text-lg",children:"Optional: Create / Update User for this School"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(K,{label:"Username",error:O["user.username"],children:e.jsx(ze,{value:F.user.username,onChange:p=>{ce(T=>({...T,user:{...T.user,username:p}})),de(T=>({...T,"user.username":void 0}))}})})}),e.jsx("div",{children:e.jsx(K,{label:"User Email",error:O["user.email"],children:e.jsx(ze,{value:F.user.email,onChange:p=>{ce(T=>({...T,user:{...T.user,email:p}})),de(T=>({...T,"user.email":void 0}))}})})}),e.jsx("div",{children:e.jsx(K,{label:"Password",error:O["user.password"],children:e.jsx(ze,{type:"password",value:F.user.password,onChange:p=>{ce(T=>({...T,user:{...T.user,password:p}})),de(T=>({...T,"user.password":void 0}))}})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{children:e.jsx(Lt,{checked:!!F.user.must_change_password,onChange:p=>ce(T=>({...T,user:{...T.user,must_change_password:p}}))})}),e.jsx("label",{htmlFor:"must_change",className:"text-sm select-none",children:"Force change password on first login"})]})]}),$&&e.jsx("div",{className:"text-red-600 mt-2",children:$}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[e.jsx(pt,{onClick:ke}),e.jsx(Qt,{type:"submit",loading:r})]})]})})]})]})]})}const Bt=10,jt="/images/ANK.png",Ht=200*1024,We={LIST:"/api/employees",ONE:t=>`/api/employees/${t}`,IMPORT:"/api/employees/import-csv",EXPORT_CSV:"/api/employees/export/csv",EXPORT_XLSX:"/api/employees/export/excel",STATES:"/api/master/states",DISTRICTS:"/api/master/districts",ROLES:"/api/master/roles",DESIGNS:"/api/master/designations",DEPTS:"/api/master/departments"};function vl(){const[t,a]=s.useState(0),[r,u]=s.useState(""),[v,M]=s.useState(""),[S,L]=s.useState(""),[g,R]=s.useState(""),[h,w]=s.useState(""),[D,q]=s.useState(""),[$,ae]=s.useState(Bt),[F,ce]=s.useState([]),[ne,J]=s.useState([]),[le,Q]=s.useState([]),[pe,re]=s.useState([]),[O,de]=s.useState([]),[De,Se]=s.useState(!1),[Z,Fe]=s.useState(null),[ie,Ne]=s.useState(l()),[xe,Re]=s.useState({}),[_e,ke]=s.useState(!1),[Ie,x]=s.useState(!1),H=s.useRef(!1),fe=s.useRef(null),je=s.useRef(null);s.useEffect(()=>{j();const o=()=>{x(!1),H.current=!1};return window.addEventListener("focus",o),()=>window.removeEventListener("focus",o)},[]);function l(){return{full_name:"",contact:"",email:"",address:"",dob:"",state_id:"",district_id:"",role_id:"",designation_id:"",department_id:"",image:"",create_user:!1,username:"",user_email:"",sync_user_role:!1}}async function j(){try{const[o,b,P,ee]=await Promise.all([E.get(We.STATES).then(y=>y.data||[]),E.get(We.ROLES).then(y=>y.data||[]),E.get(We.DESIGNS).then(y=>y.data||[]),E.get(We.DEPTS).then(y=>y.data||[])]);ce(o),Q(b),re(P),de(ee);const d=await E.get(We.DISTRICTS).then(y=>y.data||[]);J(d)}catch(o){console.error("Failed to load masters",o),ce([]),Q([]),re([]),de([]),J([])}}const Y=[{Header:"Photo",accessor:"image",Cell:o=>{const b=o.image?o.image:jt;return e.jsx("div",{className:"h-12 w-12 overflow-hidden flex items-center justify-center bg-white rounded-md",children:e.jsx("img",{src:b,alt:o.full_name,className:"h-full w-full object-cover",onError:P=>P.currentTarget.src=jt})})}},{Header:"Name",accessor:"full_name",Cell:o=>e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium",children:o.full_name}),e.jsx("div",{className:"text-sm text-gray-500",children:o.username||""})]})},{Header:"Contact",accessor:"contact"},{Header:"Email",accessor:"email"},{Header:"Role",accessor:"role_name"},{Header:"Designation",accessor:"designation_name"},{Header:"Dept",accessor:"department_name"},{Header:"Location",accessor:"location",Cell:o=>e.jsxs("div",{className:"text-sm",children:[o.state_name||"-"," / ",o.district_name||"-"]})},{Header:"Actions",accessor:"actions",Cell:o=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(He,{size:"sm",onClick:b=>{b.stopPropagation(),p(o)},children:"Edit"}),e.jsx(Jt,{size:"sm",onClick:b=>{b.stopPropagation(),Ee(o.employee_id)},children:"Delete"})]})}],se=s.useCallback(async({page:o=1,pageSize:b=Bt,sortBy:P,sortDir:ee})=>{const d={page:o,pageSize:b,search:r||void 0,state_id:v||void 0,district_id:S||void 0,role_id:g||void 0,designation_id:h||void 0,department_id:D||void 0};try{const y=await E.get(We.LIST,{query:d}),C=y.data||[],B=y.pagination&&y.pagination.total||(y.total??C.length)||0;return{data:C,total:B}}catch(y){return console.error("fetch employees",y),{data:[],total:0}}},[r,v,S,g,h,D]);function Me(){Fe(null),Ne(l()),Re({}),Se(!0)}async function p(o){var b,P;if(Re({}),typeof o=="object"&&o){Fe(o),Ne(te(o)),Se(!0);return}try{const ee=await E.get(We.ONE(o)),d=(ee==null?void 0:ee.data)||null;d&&(Fe(d),Ne(te(d)),Se(!0))}catch(ee){console.error("load employee",ee),(P=(b=window.ui)==null?void 0:b.toast)==null||P.call(b,"Failed to load employee","danger")}}function T(){H.current||(Se(!1),Fe(null),Re({}))}function te(o){return{full_name:o.full_name||"",contact:o.contact||"",email:o.email||"",address:o.address||"",dob:o.dob?String(o.dob).substring(0,10):"",state_id:o.state_id||"",district_id:o.district_id||"",role_id:o.role_id||"",designation_id:o.designation_id||"",department_id:o.department_id||"",image:o.image||"",create_user:!!(o.username||o.user_email),username:o.username||"",user_email:o.user_email||o.email||"",sync_user_role:!1}}async function ge(o){var C,B,i,N,I,m,f,G;H.current=!0,x(!0);const b=o&&o[0];if(!b){H.current=!1,x(!1);return}if(b.size>Ht){const X=`Photo too large — max ${Math.round(Ht/1024)}KB`;Re(k=>({...k,image:X})),(B=(C=window.ui)==null?void 0:C.toast)==null||B.call(C,X,"danger"),H.current=!1,x(!1);return}const P=new FileReader;P.onload=()=>Ne(X=>({...X,image:P.result})),P.readAsDataURL(b);const ee=new FormData;ee.append("photo",b);const d=["/api/employees/upload-photo","/api/employees/photo/upload"];let y=null;for(const X of d)try{const k=await E.post(X,ee,{headers:{}}),me=(k==null?void 0:k.url)||(k==null?void 0:k.data)&&k.data.url||(typeof k=="string"?k:void 0);if(me){Ne(ue=>({...ue,image:me})),(N=(i=window.ui)==null?void 0:i.toast)==null||N.call(i,"Photo uploaded","success"),H.current=!1,x(!1);return}}catch(k){y=k;const me=((I=k==null?void 0:k.data)==null?void 0:I.message)||(k==null?void 0:k.message)||"";if(/Not Found/i.test(me)||(k==null?void 0:k.status)===404)continue;Re(ue=>{var ye;return{...ue,image:((ye=k==null?void 0:k.data)==null?void 0:ye.message)||(k==null?void 0:k.message)||"Upload failed"}}),(G=(m=window.ui)==null?void 0:m.toast)==null||G.call(m,((f=k==null?void 0:k.data)==null?void 0:f.message)||(k==null?void 0:k.message)||"Upload failed","danger"),H.current=!1,x(!1);return}console.error("photo upload failed",y),H.current=!1,x(!1)}async function oe(o){var b,P,ee,d,y,C,B,i;(b=o==null?void 0:o.preventDefault)==null||b.call(o),ke(!0),Re({});try{const N={};if((!ie.full_name||!ie.full_name.trim())&&(N.full_name="Name is required"),ie.email&&!/^\S+@\S+\.\S+$/.test(ie.email)&&(N.email="Enter a valid email"),ie.contact&&!/^[\d+\-\s()]{6,20}$/.test(ie.contact)&&(N.contact="Enter a valid phone"),Object.keys(N).length){Re(N),ke(!1);return}const I={full_name:ie.full_name,contact:ie.contact||null,email:ie.email||null,address:ie.address||null,dob:ie.dob||null,state_id:ie.state_id||null,district_id:ie.district_id||null,role_id:ie.role_id||null,designation_id:ie.designation_id||null,department_id:ie.department_id||null,image:ie.image||null,create_user:!!ie.create_user,username:ie.username||void 0,user_email:ie.user_email||void 0,sync_user_role:!!ie.sync_user_role};Z&&Z.employee_id?(await E.put(We.ONE(Z.employee_id),I),(ee=(P=window.ui)==null?void 0:P.toast)==null||ee.call(P,"Employee updated","success")):(await E.post(We.LIST,I),(y=(d=window.ui)==null?void 0:d.toast)==null||y.call(d,"Employee created","success")),a(m=>m+1),Se(!1),Fe(null)}catch(N){console.error("save employee",N);const I=((C=N==null?void 0:N.data)==null?void 0:C.message)||(N==null?void 0:N.message)||"Save failed";Re(m=>({...m,form:I})),(i=(B=window.ui)==null?void 0:B.toast)==null||i.call(B,I,"danger")}finally{ke(!1),H.current=!1,x(!1)}}async function Ee(o){var b,P,ee,d,y;if(window.confirm("Delete this staff member? This cannot be undone."))try{await E.del(We.ONE(o)),(P=(b=window.ui)==null?void 0:b.toast)==null||P.call(b,"Deleted","success"),a(C=>C+1)}catch(C){console.error("delete",C),(y=(ee=window.ui)==null?void 0:ee.toast)==null||y.call(ee,((d=C==null?void 0:C.data)==null?void 0:d.message)||(C==null?void 0:C.message)||"Delete failed","danger")}}async function Ce(o){var P,ee,d,y,C;if(!o)return;const b=new FormData;b.append("file",o);try{await E.post(We.IMPORT,b),(ee=(P=window.ui)==null?void 0:P.toast)==null||ee.call(P,"Import started","success"),a(B=>B+1)}catch(B){console.error("import",B),(C=(d=window.ui)==null?void 0:d.toast)==null||C.call(d,((y=B==null?void 0:B.data)==null?void 0:y.message)||(B==null?void 0:B.message)||"Import failed","danger")}finally{je.current&&(je.current.value="")}}async function z(){var o,b;try{await E.download(We.EXPORT_CSV,{filename:"employees.csv"})}catch(P){(b=(o=window.ui)==null?void 0:o.toast)==null||b.call(o,(P==null?void 0:P.message)||"Export failed","danger")}}async function W(){var o,b;try{await E.download(We.EXPORT_XLSX,{filename:"employees.xlsx"})}catch(P){(b=(o=window.ui)==null?void 0:o.toast)==null||b.call(o,(P==null?void 0:P.message)||"Export failed","danger")}}const V=bl(ne,v);return e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"Faculty"}),e.jsx("div",{className:"text-sm text-slate-500 mt-1",children:"Manage employees & linked users"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zt,{onChange:o=>Ce(o.target.files&&o.target.files[0]),accept:".csv,text/csv",children:"Import CSV"}),e.jsx(Qe,{onClick:z,children:"Export CSV"}),e.jsx(Qe,{onClick:W,children:"Export Excel"}),e.jsx(Dt,{onClick:Me})]})]}),e.jsx("div",{className:"bg-white border rounded-lg p-4 shadow-sm mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm text-slate-500",children:"Search"}),e.jsx("div",{className:"mt-1",children:e.jsx(ze,{placeholder:"Search name / username / email",value:r,onChange:u,clearable:!0})})]}),e.jsx("div",{children:e.jsx(K,{label:"State",children:e.jsx(Te,{value:v,onChange:o=>M(o),options:[{value:"",label:"Any"}].concat(F.map(o=>({value:o.state_id,label:o.state_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"District",children:e.jsx(Te,{value:S,onChange:o=>L(o),options:[{value:"",label:"Any"}].concat(V.map(o=>({value:o.district_id,label:o.district_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"Role",children:e.jsx(Te,{value:g,onChange:o=>R(o),options:[{value:"",label:"Any"}].concat(le.map(o=>({value:o.role_id,label:o.role_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"Designation",children:e.jsx(Te,{value:h,onChange:o=>w(o),options:[{value:"",label:"Any"}].concat(pe.map(o=>({value:o.designation_id,label:o.designation_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"Department",children:e.jsx(Te,{value:D,onChange:o=>q(o),options:[{value:"",label:"Any"}].concat(O.map(o=>({value:o.department_id,label:o.department_name})))})})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(He,{onClick:()=>a(o=>o+1),children:"Apply"}),e.jsx(Qe,{onClick:()=>{u(""),M(""),L(""),R(""),w(""),q(""),ae(Bt),a(o=>o+1)},children:"Clear"})]})]})}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow-sm border mb-6",children:e.jsx(Hs,{columns:Y,onFetch:se,initialPageSize:$,selectable:!1},t)}),De&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:o=>{o.target===o.currentTarget&&!H.current&&T()}}),e.jsxs("div",{className:"relative z-10 w-full max-w-3xl bg-white rounded-lg shadow-lg overflow-auto max-h-[90vh]",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/images/Ank_Logo.png",alt:"logo",className:"h-10 w-auto object-contain"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:Z?"Edit Faculty":"Add Faculty"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Create or update faculty record"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>T(),className:"text-sm text-slate-500 hover:text-slate-700",children:"Close"})})]}),e.jsxs("form",{onSubmit:oe,className:"p-4 space-y-4",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(K,{label:"Full name *",required:!0,error:xe.full_name,children:e.jsx(ze,{value:ie.full_name,onChange:o=>Ne(b=>({...b,full_name:o})),clearable:!0})})}),e.jsx("div",{children:e.jsx(K,{label:"Contact",error:xe.contact,children:e.jsx(ze,{value:ie.contact,onChange:o=>Ne(b=>({...b,contact:o}))})})}),e.jsx("div",{children:e.jsx(K,{label:"Email",error:xe.email,children:e.jsx(ze,{value:ie.email,onChange:o=>Ne(b=>({...b,email:o}))})})}),e.jsx("div",{children:e.jsx(K,{label:"DOB",children:e.jsx(Et,{value:ie.dob,onChange:o=>Ne(b=>({...b,dob:o}))})})}),e.jsx("div",{children:e.jsx(K,{label:"State",children:e.jsx(Te,{value:ie.state_id,onChange:o=>{Ne(b=>({...b,state_id:o,district_id:""}))},options:[{value:"",label:"Select state"}].concat(F.map(o=>({value:o.state_id,label:o.state_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"District",children:e.jsx(Te,{value:ie.district_id,onChange:o=>Ne(b=>({...b,district_id:o})),options:[{value:"",label:"Select district"}].concat(V.map(o=>({value:o.district_id,label:o.district_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"Role",children:e.jsx(Te,{value:ie.role_id,onChange:o=>Ne(b=>({...b,role_id:o})),options:[{value:"",label:"Select role"}].concat(le.map(o=>({value:o.role_id,label:o.role_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"Designation",children:e.jsx(Te,{value:ie.designation_id,onChange:o=>Ne(b=>({...b,designation_id:o})),options:[{value:"",label:"Select designation"}].concat(pe.map(o=>({value:o.designation_id,label:o.designation_name})))})})}),e.jsx("div",{children:e.jsx(K,{label:"Department",children:e.jsx(Te,{value:ie.department_id,onChange:o=>Ne(b=>({...b,department_id:o})),options:[{value:"",label:"Select department"}].concat(O.map(o=>({value:o.department_id,label:o.department_name})))})})}),e.jsx("div",{className:"col-span-2",children:e.jsx(K,{label:"Address",children:e.jsx(ht,{value:ie.address,onChange:o=>Ne(b=>({...b,address:o}))})})}),e.jsxs("div",{className:"col-span-2 flex items-center gap-4",children:[e.jsx("div",{className:"h-28 w-28 overflow-hidden rounded-md bg-white shadow-sm flex-shrink-0",children:e.jsx("img",{src:ie.image||jt,alt:"preview",className:"h-full w-full object-cover",onError:o=>o.currentTarget.src=jt})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("input",{ref:fe,type:"file",accept:"image/*",className:"hidden",onClick:o=>{o.stopPropagation()},onMouseDown:o=>{o.stopPropagation()},onFocus:()=>{H.current=!0,x(!0)},onChange:o=>{H.current=!0,x(!0),ge(o.target.files)}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{size:"sm",onMouseDown:o=>{o.preventDefault(),o.stopPropagation(),H.current=!0,x(!0);try{fe.current&&fe.current.click()}catch(b){console.warn("file input click failed",b)}},onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),H.current=!0,x(!0),fe.current&&fe.current.click())},children:"Upload Photo"}),ie.image&&e.jsx("button",{type:"button",className:"px-3 py-1 rounded-md border",onClick:()=>Ne(o=>({...o,image:""})),children:"Remove"})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:["Max ",Math.round(Ht/1024),"KB. JPG/PNG recommended."]}),xe.image&&e.jsx("div",{className:"text-xs text-rose-600 mt-1",children:xe.image})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Lt,{checked:!!ie.create_user,onChange:o=>Ne(b=>({...b,create_user:o}))}),e.jsx("div",{className:"text-sm",children:"Create linked user"})]}),e.jsx("div",{})]}),ie.create_user&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(K,{label:"Username",children:e.jsx(ze,{value:ie.username,onChange:o=>Ne(b=>({...b,username:o}))})}),e.jsx(K,{label:"User Email",children:e.jsx(ze,{value:ie.user_email,onChange:o=>Ne(b=>({...b,user_email:o}))})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4",checked:ie.sync_user_role,onChange:o=>Ne(b=>({...b,sync_user_role:o.target.checked}))}),e.jsx("span",{className:"text-sm",children:"Sync user role with employee role"})]})})]}),xe.form&&e.jsx("div",{className:"text-sm text-rose-600",children:xe.form}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(pt,{onClick:()=>T()}),e.jsx(Qt,{type:"submit",loading:_e})]})]})]})]})]})}function bl(t,a){return a?(t||[]).filter(r=>String(r.state_id)===String(a)):t||[]}const bs=20,js="/images/ANK.png";async function xt(t,a={}){const r=await E.get(t,{query:a});return(r==null?void 0:r.data)||[]}const jl=()=>xt("/api/schools/schools",{pageSize:1e3}),yl=()=>xt("/api/master/media",{pageSize:1e3}),wl=()=>xt("/api/master/standards",{pageSize:1e3}),_l=()=>xt("/api/master/divisions",{pageSize:1e3}),Nl=()=>xt("/api/master/roles",{pageSize:1e3});function kl(t,a){return a&&t.some(r=>String(r.school_id)===String(a))?a:""}function ys(t){if(!t)return"-";try{return String(t).slice(0,10)}catch{return t}}function Sl(t=[]){const a={};for(const r of t){const u=`${r.school_id||"s-"}|${r.medium_id||"m-"}`;a[u]||(a[u]={school_id:r.school_id,school_name:r.school_name,medium_name:r.medium_name,rows:[]}),a[u].rows.push(r)}return Object.values(a)}function Cl(){const[t,a]=s.useState([]),[r,u]=s.useState([]),[v,M]=s.useState([]),[S,L]=s.useState([]),[g,R]=s.useState([]),[h,w]=s.useState([]),D=s.useRef({}),[q,$]=s.useState(""),[ae,F]=s.useState(""),[ce,ne]=s.useState(""),[J,le]=s.useState(""),[Q,pe]=s.useState(bs),[re,O]=s.useState(1),[de,De]=s.useState(0),[Se,Z]=s.useState([]),[Fe,ie]=s.useState(!1),[Ne,xe]=s.useState(!1),[Re,_e]=s.useState(!1),[ke,Ie]=s.useState(null),[x,H]=s.useState(ws()),[fe,je]=s.useState(!1),[l,j]=s.useState(""),[Y,se]=s.useState(!1),[Me,p]=s.useState(""),[T,te]=s.useState("insert"),[ge,oe]=s.useState(!1),Ee=s.useRef(null);s.useEffect(()=>{(async()=>{var m,f,G;try{const[X,k,me,ue,ye]=await Promise.all([Nl(),jl(),yl(),wl(),_l()]);R(X||[]),a(k||[]),u(me||[]),M(ue||[]),L(ye||[]);const Le=((m=(X||[]).find(Pe=>String(Pe.role_name||"").toLowerCase()==="faculty"))==null?void 0:m.role_id)||null;Ee.current=Le;const be=await z(Le,"");w(be||[]);const we={};(be||[]).forEach(Pe=>{Pe&&(Pe.employee_id||Pe.id)&&(we[String(Pe.employee_id||Pe.id)]=Pe.image||Pe.photo||"")}),D.current=we}catch(X){console.error("load masters",X),(G=(f=window.ui)==null?void 0:f.toast)==null||G.call(f,(X==null?void 0:X.message)||"Failed to load masters","danger")}})()},[]);const Ce=s.useCallback(async(m=1,f=Q)=>{var G,X;ie(!0);try{const k={page:m,pageSize:f};if(q&&(k.search=q),ae){const be=(t||[]).find(we=>String(we.school_id)===String(ae));be&&(k.school_name=be.school_name)}if(ce){const be=(r||[]).find(we=>String(we.medium_id)===String(ce));be&&(k.medium_name=be.medium_name)}if(J){const be=(v||[]).find(we=>String(we.std_id)===String(J));be&&(k.std_name=be.std_name)}const me=await E.get("/api/faculty-assignments",{query:k}),ue=(me==null?void 0:me.data)||[],ye=(me==null?void 0:me.pagination)||{page:m,pageSize:f,total:ue.length},Le=new Map;for(const be of ue){const we=be.employee_id!=null?String(be.employee_id):`_u_${be.employee_name||"unknown"}`;if(!Le.has(we)){let Pe=be.image||be.photo||"";Pe||(Pe=D.current[String(be.employee_id)]||""),Le.set(we,{employee_id:be.employee_id,employee_name:be.employee_name||be.full_name||"—",username:be.username||be.user_name||be.user||"",image:Pe||"",assignments:[]})}Le.get(we).assignments.push(be)}Z(Array.from(Le.values())),De(ye.total||0),O(ye.page||m)}catch(k){console.error("fetch assignments",k),(X=(G=window.ui)==null?void 0:G.toast)==null||X.call(G,(k==null?void 0:k.message)||"Failed to load assignments","danger"),Z([]),De(0)}finally{ie(!1)}},[q,ae,ce,J,t,r,v,Q]);s.useEffect(()=>{Ce(re,Q)},[Ce,re,Q]);async function z(m,f){try{const G={pageSize:1e3};m&&(G.role_id=m);const X=await E.get("/api/employees",{query:G});let k=(X==null?void 0:X.data)||[];return m||(k=k.filter(me=>String(me.role_name||"").toLowerCase()==="faculty")),k}catch(G){return console.error("load employees",G),[]}}function W(m="new",f=null){if(m==="view"&&f){_e(!0),H({fa_id:f.fa_id||null,employee_id:f.employee_id||"",school_id:f.school_id||"",medium_id:f.medium_id||"",std_ids:f.std_id?[f.std_id]:[],div_ids:f.div_id?[f.div_id]:[],start_date:f.start_date?String(f.start_date).slice(0,10):"",end_date:f.end_date?String(f.end_date).slice(0,10):"",notes:f.notes||""}),Ie(f||null),xe(!0);return}if(m==="edit"&&f){_e(!1),H({fa_id:f.fa_id||null,employee_id:f.employee_id||"",school_id:f.school_id||"",medium_id:f.medium_id||"",std_ids:f.std_id?[f.std_id]:[],div_ids:f.div_id?[f.div_id]:[],start_date:f.start_date?String(f.start_date).slice(0,10):"",end_date:f.end_date?String(f.end_date).slice(0,10):"",notes:f.notes||""}),Ie(f),xe(!0);return}_e(!1),Ie(null),H(ws()),xe(!0)}function V(m,f){const G=String(f);return Array.isArray(m)||(m=[]),m.some(X=>String(X)===G)?m.filter(X=>String(X)!==G):[...m,f]}function o(m){Array.isArray(v)&&H(m?f=>({...f,std_ids:(v||[]).map(G=>G.std_id)}):f=>({...f,std_ids:[]}))}function b(m){Array.isArray(S)&&H(m?f=>({...f,div_ids:(S||[]).map(G=>G.div_id)}):f=>({...f,div_ids:[]}))}async function P(m){var f,G,X,k,me,ue,ye,Le,be,we,Pe,Oe,n,c,_,U,he,ve,Ke,$e;(f=m==null?void 0:m.preventDefault)==null||f.call(m),oe(!0);try{if(!x.employee_id){(X=(G=window.ui)==null?void 0:G.toast)==null||X.call(G,"Employee is required","danger"),oe(!1);return}if(!x.school_id){(me=(k=window.ui)==null?void 0:k.toast)==null||me.call(k,"School is required","danger"),oe(!1);return}if(!x.start_date){(ye=(ue=window.ui)==null?void 0:ue.toast)==null||ye.call(ue,"Start date is required","danger"),oe(!1);return}if(!kl(t,x.school_id)){(be=(Le=window.ui)==null?void 0:Le.toast)==null||be.call(Le,"You do not have access to that school (RLS).","warning"),oe(!1);return}const Zs=Array.isArray(x.std_ids)&&x.std_ids.length?x.std_ids:[null],ea=Array.isArray(x.div_ids)&&x.div_ids.length?x.div_ids:[null],ta=Zs.map(Ve=>Ve===null?null:Number(Ve)),sa=ea.map(Ve=>Ve===null?null:Number(Ve)),et=[];for(const Ve of ta)for(const Ft of sa)et.push({std_id:Ve,div_id:Ft});const ft={employee_id:Number(x.employee_id)||null,school_id:Number(x.school_id)||null,medium_id:x.medium_id?Number(x.medium_id):null,start_date:x.start_date||null,end_date:x.end_date||null,notes:((we=x.notes)==null?void 0:we.trim())||null};if(x.fa_id&&et.length===1){const Ve={...ft,std_id:et[0].std_id,div_id:et[0].div_id};await E.put(`/api/faculty-assignments/${x.fa_id}`,Ve),(Oe=(Pe=window.ui)==null?void 0:Pe.toast)==null||Oe.call(Pe,"Updated","success")}else{const Ve=[];if(x.fa_id&&et.length>=1){const it=et[0];Ve.push(E.put(`/api/faculty-assignments/${x.fa_id}`,{...ft,std_id:it.std_id,div_id:it.div_id}));for(let Ot=1;Ot<et.length;Ot++){const ss=et[Ot];Ve.push(E.post("/api/faculty-assignments",{...ft,std_id:ss.std_id,div_id:ss.div_id}))}}else for(const it of et)Ve.push(E.post("/api/faculty-assignments",{...ft,std_id:it.std_id,div_id:it.div_id}));const Ft=await Promise.allSettled(Ve);let zt=0,At=0;Ft.forEach(it=>it.status==="fulfilled"?zt++:At++),At===0?(c=(n=window.ui)==null?void 0:n.toast)==null||c.call(n,`${zt} assignment(s) saved`,"success"):(U=(_=window.ui)==null?void 0:_.toast)==null||U.call(_,`${zt} saved, ${At} failed`,"warning")}xe(!1),await Ce(1,Q)}catch(Ye){(Ye==null?void 0:Ye.status)===403?(ve=(he=window.ui)==null?void 0:he.toast)==null||ve.call(he,"Restricted by RLS.","warning"):($e=(Ke=window.ui)==null?void 0:Ke.toast)==null||$e.call(Ke,(Ye==null?void 0:Ye.message)||"Save failed","danger"),console.error("save assignment",Ye)}finally{oe(!1)}}async function ee(m){var f,G,X,k,me,ue;if(window.confirm("Delete this assignment?"))try{await E.del(`/api/faculty-assignments/${m}`),(G=(f=window.ui)==null?void 0:f.toast)==null||G.call(f,"Deleted","success"),await Ce(re,Q)}catch(ye){(ye==null?void 0:ye.status)===403?(k=(X=window.ui)==null?void 0:X.toast)==null||k.call(X,"Restricted by RLS.","warning"):(ue=(me=window.ui)==null?void 0:me.toast)==null||ue.call(me,(ye==null?void 0:ye.message)||"Delete failed","danger")}}async function d(m){if(!m)return;const f=new FileReader;f.onload=async()=>{var G,X,k,me,ue,ye;try{await E.post("/api/faculty-assignments/import-csv",{csv:String(f.result||"")}),(X=(G=window.ui)==null?void 0:G.toast)==null||X.call(G,"Import done","success"),await Ce(1,Q)}catch(Le){(Le==null?void 0:Le.status)===403?(me=(k=window.ui)==null?void 0:k.toast)==null||me.call(k,"Restricted by RLS.","warning"):(ye=(ue=window.ui)==null?void 0:ue.toast)==null||ye.call(ue,(Le==null?void 0:Le.message)||"Import failed","danger")}},f.readAsText(m)}async function y(m){var f,G,X,k,me,ue,ye,Le,be;if((f=m==null?void 0:m.preventDefault)==null||f.call(m),!l||!l.trim()){(X=(G=window.ui)==null?void 0:G.toast)==null||X.call(G,"Paste CSV first","danger");return}try{await E.post("/api/faculty-assignments/import-csv",{csv:l}),(me=(k=window.ui)==null?void 0:k.toast)==null||me.call(k,"Import done","success"),je(!1),j(""),await Ce(1,Q)}catch(we){(we==null?void 0:we.status)===403?(ye=(ue=window.ui)==null?void 0:ue.toast)==null||ye.call(ue,"Restricted by RLS.","warning"):(be=(Le=window.ui)==null?void 0:Le.toast)==null||be.call(Le,(we==null?void 0:we.message)||"Import failed","danger")}}async function C(m){var G,X,k,me,ue,ye,Le,be,we,Pe,Oe,n,c;if((G=m==null?void 0:m.preventDefault)==null||G.call(m),!Me||!Me.trim()){(k=(X=window.ui)==null?void 0:X.toast)==null||k.call(X,"Provide JSON array","danger");return}let f;try{f=JSON.parse(Me)}catch{(ue=(me=window.ui)==null?void 0:me.toast)==null||ue.call(me,"Invalid JSON","danger");return}if(!Array.isArray(f)){(Le=(ye=window.ui)==null?void 0:ye.toast)==null||Le.call(ye,"JSON must be an array","danger");return}try{T==="insert"?await E.post("/api/faculty-assignments/bulk-insert",f):await E.post("/api/faculty-assignments/bulk-upsert",f),(we=(be=window.ui)==null?void 0:be.toast)==null||we.call(be,"Bulk operation completed","success"),se(!1),p(""),await Ce(1,Q)}catch(_){(_==null?void 0:_.status)===403?(Oe=(Pe=window.ui)==null?void 0:Pe.toast)==null||Oe.call(Pe,"Restricted by RLS.","warning"):(c=(n=window.ui)==null?void 0:n.toast)==null||c.call(n,(_==null?void 0:_.message)||"Bulk operation failed","danger")}}const B=Math.max(1,Math.ceil((de||0)/(Q||bs)));function i(){re>1&&(O(m=>m-1),Ce(re-1,Q))}function N(){re<B&&(O(m=>m+1),Ce(re+1,Q))}function I(m=6){return Array.from({length:m}).map((f,G)=>e.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-hidden animate-pulse",style:{minHeight:160},children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-slate-200"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/5"}),e.jsx("div",{className:"h-3 bg-slate-200 rounded w-1/3"})]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("div",{className:"h-10 bg-slate-100 rounded"}),e.jsx("div",{className:"h-10 bg-slate-100 rounded"})]})]},`skel-${G}`))}return e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-8",style:{fontFamily:"Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Faculty Assignments"}),e.jsx("div",{className:"text-sm text-slate-500",children:"View faculty cards with assigned schools / standards / divisions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("a",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md border",href:"/api/faculty-assignments/export/csv",target:"_blank",rel:"noreferrer",children:[e.jsx("i",{className:"bi bi-filetype-csv"})," Export CSV"]}),e.jsx(Zt,{accept:".csv,text/csv",onChange:m=>d(m.target.files&&m.target.files[0]),children:"Import CSV"}),e.jsx(Qe,{onClick:()=>{te("insert"),se(!0)},children:"Bulk Insert (JSON)"}),e.jsx(Qe,{onClick:()=>{te("upsert"),se(!0)},children:"Bulk Upsert (JSON)"}),e.jsx(Dt,{onClick:()=>W("new")})]})]}),e.jsx("div",{className:"bg-white border rounded-lg p-4 shadow-sm mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsx("div",{className:"md:col-span-3",children:e.jsx(K,{label:"Search",children:e.jsx(ze,{placeholder:"Search employee / notes",value:q,onChange:m=>{$(m),O(1),Ce(1,Q)}})})}),e.jsx("div",{children:e.jsx(K,{label:"School",children:e.jsx(Te,{value:ae,onChange:m=>{F(m),O(1),Ce(1,Q)},options:[{value:"",label:"All"},...(t||[]).map(m=>({value:m.school_id,label:m.school_name}))]})})}),e.jsx("div",{children:e.jsx(K,{label:"Medium",children:e.jsx(Te,{value:ce,onChange:m=>{ne(m),O(1),Ce(1,Q)},options:[{value:"",label:"All"},...(r||[]).map(m=>({value:m.medium_id,label:m.medium_name}))]})})}),e.jsx("div",{children:e.jsx(K,{label:"Standard",children:e.jsx(Te,{value:J,onChange:m=>{le(m),O(1),Ce(1,Q)},options:[{value:"",label:"All"},...(v||[]).map(m=>({value:m.std_id,label:m.std_name}))]})})}),e.jsx("div",{children:e.jsx(K,{label:"Page Size",children:e.jsx(Te,{value:Q,onChange:m=>{pe(Number(m)),O(1),Ce(1,Number(m))},options:[{value:10,label:"10"},{value:20,label:"20"},{value:50,label:"50"}]})})})]})}),e.jsxs("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(340px, 1fr))"},children:[Fe&&I(6),!Fe&&(Se||[]).length===0&&e.jsx("div",{className:"col-span-full p-6 text-center text-slate-500",children:"No assignments found"}),!Fe&&(Se||[]).map(m=>e.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-hidden transform transition duration-200 hover:-translate-y-1 hover:shadow-lg",style:{minHeight:160,display:"flex",flexDirection:"column",animation:"fadeIn .28s ease"},children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-white overflow-hidden flex-shrink-0 border",children:e.jsx("img",{src:m.image||js,alt:m.employee_name,className:"h-full w-full object-cover",onError:f=>f.currentTarget.src=js})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold truncate",children:m.employee_name}),e.jsx("div",{className:"text-xs text-slate-500 truncate",children:m.username||""})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-medium",children:(m.assignments||[]).length}),e.jsx("div",{className:"text-xs text-slate-400",children:"assignment(s)"})]})]})})]}),e.jsx("div",{className:"p-3 space-y-3 flex-1 overflow-auto",children:Sl(m.assignments||[]).map(f=>e.jsxs("div",{className:"border rounded p-3 bg-slate-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium",children:f.school_name||"-"}),e.jsx("div",{className:"text-xs text-slate-500",children:f.medium_name?e.jsxs("span",{children:["• ",f.medium_name]}):null})]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:(()=>{const G=[],X=new Set;for(const k of f.rows||[]){const me=k.std_name||null,ue=k.division_name||null,ye=`${me||"-"}|${ue||"-"}`;X.has(ye)||(X.add(ye),G.push({std:me,div:ue,start:k.start_date,end:k.end_date,notes:k.notes,fa_id:k.fa_id,row:k}))}return G.map(k=>e.jsxs("div",{className:"p-2 bg-white border rounded text-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[k.std?e.jsxs("span",{children:["Std ",e.jsx("strong",{className:"text-slate-700",children:k.std})]}):e.jsx("span",{children:"-"}),k.div?e.jsxs("span",{className:"ml-2",children:["Div ",e.jsx("strong",{className:"text-slate-700",children:k.div})]}):null]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Start: ",ys(k.start)," • End: ",k.end?ys(k.end):"-"]}),k.notes&&e.jsx("div",{className:"text-xs text-slate-500 truncate",title:k.notes,children:k.notes})]}),e.jsxs("div",{className:"flex-shrink-0 ml-3 flex flex-col items-end gap-2",children:[e.jsx(He,{size:"xs",onClick:()=>W("view",{fa_id:k.fa_id,...k.row}),children:"View"}),e.jsx(Qe,{size:"xs",onClick:()=>W("edit",{fa_id:k.fa_id,...k.row}),children:"Edit"}),e.jsx(Jt,{size:"xs",onClick:()=>ee(k.fa_id)})]})]},`${k.std}_${k.div}_${k.fa_id}`))})()})]},`${f.school_id}_${f.medium_name||""}`))}),e.jsxs("div",{className:"p-3 border-t flex items-center justify-between text-xs text-slate-500",children:[e.jsx("div",{children:(m.assignments||[]).some(f=>f.notes)?"Notes available":"No notes"}),e.jsx("div",{children:(m.assignments||[]).some(f=>f.end_date&&new Date(f.end_date)<new Date)?e.jsx("span",{className:"text-rose-600",children:"Some ended"}):e.jsx("span",{children:"Active"})})]})]},m.employee_id||m.employee_name))]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Showing page ",re," of ",B," — ",de," result(s)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded border disabled:opacity-50",onClick:i,disabled:re<=1,children:"Prev"}),e.jsx("button",{className:"px-3 py-1 rounded border disabled:opacity-50",onClick:N,disabled:re>=B,children:"Next"})]})]}),Ne&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>xe(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-3xl bg-white rounded-lg shadow-lg overflow-auto max-h-[90vh]",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"/images/Ank_Logo.png",alt:"logo",className:"h-10 w-auto object-contain"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:Re?`View • ${x.employee_id,""}`:x.fa_id?"Edit Assignment":"New Assignment"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Link faculty to school / medium / standard / division"})]})]}),e.jsx("div",{children:e.jsx("button",{className:"text-sm text-slate-500 hover:text-slate-700",onClick:()=>xe(!1),children:"Close"})})]}),e.jsxs("form",{onSubmit:P,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(K,{label:"Employee *",children:e.jsx(Te,{value:x.employee_id,onChange:m=>H(f=>({...f,employee_id:m})),options:[{value:"",label:"Select"},...(h||[]).map(m=>({value:m.employee_id,label:m.full_name||m.employee_name||m.username}))]})}),e.jsx(K,{label:"School *",children:e.jsx(Te,{value:x.school_id,onChange:m=>H(f=>({...f,school_id:m})),options:[{value:"",label:"Select"},...(t||[]).map(m=>({value:m.school_id,label:m.school_name}))]})}),e.jsx(K,{label:"Medium",children:e.jsx(Te,{value:x.medium_id,onChange:m=>H(f=>({...f,medium_id:m})),options:[{value:"",label:"Select"},...(r||[]).map(m=>({value:m.medium_id,label:m.medium_name}))]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"form-label",children:"Standards (multi-select)"}),e.jsx("div",{className:"text-xs text-slate-500",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(x.std_ids)&&Array.isArray(v)&&x.std_ids.length===v.length&&v.length>0,onChange:m=>o(m.target.checked)}),e.jsx("span",{children:"Select all"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-auto border rounded p-2 bg-slate-50",children:(v||[]).length===0?e.jsx("div",{className:"text-sm text-slate-400 col-span-2",children:"No standards"}):(v||[]).map(m=>{const f=Array.isArray(x.std_ids)&&x.std_ids.some(G=>String(G)===String(m.std_id));return e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f,disabled:Re,onChange:()=>H(G=>({...G,std_ids:V(G.std_ids,m.std_id)}))}),e.jsx("span",{children:m.std_name})]},m.std_id)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"form-label",children:"Divisions (multi-select)"}),e.jsx("div",{className:"text-xs text-slate-500",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(x.div_ids)&&Array.isArray(S)&&x.div_ids.length===S.length&&S.length>0,onChange:m=>b(m.target.checked)}),e.jsx("span",{children:"Select all"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-auto border rounded p-2 bg-slate-50",children:(S||[]).length===0?e.jsx("div",{className:"text-sm text-slate-400 col-span-2",children:"No divisions"}):(S||[]).map(m=>{const f=Array.isArray(x.div_ids)&&x.div_ids.some(G=>String(G)===String(m.div_id));return e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:f,disabled:Re,onChange:()=>H(G=>({...G,div_ids:V(G.div_ids,m.div_id)}))}),e.jsx("span",{children:m.division_name})]},m.div_id)})})]}),e.jsx(K,{label:"Start Date *",children:e.jsx(Et,{value:x.start_date,onChange:m=>H(f=>({...f,start_date:m}))})}),e.jsx(K,{label:"End Date",children:e.jsx(Et,{value:x.end_date,onChange:m=>H(f=>({...f,end_date:m}))})}),e.jsx("div",{className:"col-span-2",children:e.jsx(K,{label:"Notes",children:e.jsx(ht,{value:x.notes,onChange:m=>H(f=>({...f,notes:m}))})})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(pt,{onClick:()=>xe(!1)}),!Re&&e.jsx(Qt,{loading:ge})]})]})]})]}),fe&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>je(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-3xl bg-white rounded-lg shadow-lg overflow-auto max-h-[90vh]",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:"Import Faculty Assignments (CSV)"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Headers: employee_name, school_name, medium_name, std_name, division_name, start_date, end_date, notes"})]}),e.jsx("div",{children:e.jsx("button",{className:"text-sm text-slate-500 hover:text-slate-700",onClick:()=>je(!1),children:"Close"})})]}),e.jsxs("form",{onSubmit:y,className:"p-4 space-y-4",children:[e.jsx(K,{label:"CSV content",children:e.jsx(ht,{value:l,onChange:m=>j(m)})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(pt,{onClick:()=>je(!1)}),e.jsx(He,{onClick:y,children:"Import"})]})]})]})]}),Y&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>se(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-3xl bg-white rounded-lg shadow-lg overflow-auto max-h-[90vh]",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:T==="insert"?"Bulk Insert (JSON)":"Bulk Upsert (JSON)"}),e.jsx("div",{className:"text-xs text-slate-400",children:"Provide an array. Fields: fa_id?, employee_name|employee_id, school_name|school_id, medium_name|medium_id?, std_name|std_id?, division_name|div_id?, start_date, end_date?, notes?"})]}),e.jsx("div",{children:e.jsx("button",{className:"text-sm text-slate-500 hover:text-slate-700",onClick:()=>se(!1),children:"Close"})})]}),e.jsxs("form",{onSubmit:C,className:"p-4 space-y-4",children:[e.jsx(K,{label:"JSON array",children:e.jsx(ht,{value:Me,onChange:m=>p(m)})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(pt,{onClick:()=>se(!1)}),e.jsx(He,{onClick:C,children:"Run"})]})]})]})]}),e.jsx("style",{children:`
        /* Font: Inter (scoped import so you can drop this file as-is) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');

        @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn .28s ease; }
      `})]})}function ws(){return{fa_id:null,employee_id:"",school_id:"",medium_id:"",std_ids:[],div_ids:[],start_date:"",end_date:"",notes:""}}const _s=1,Ns=200,Ml=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Pl=(t=new Date)=>t.toISOString().slice(0,10),qe={enabled:!1,base64:null,fileName:"CustomFont-Regular.ttf",fontName:"CustomFont",fontStyle:"normal"},ks=1;function Ll(t){return t&&{monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6,sunday:7}[String(t).trim().toLowerCase()]||null}function El(t){const a=t.split(/\r?\n/).filter(Boolean);if(!a.length)return[];const r=M=>{const S=[];let L="",g=!1;for(let R=0;R<M.length;R++){const h=M[R];if(h==='"'){if(g&&M[R+1]==='"'){L+='"',R++;continue}g=!g;continue}if(!g&&h===","){S.push(L),L="";continue}L+=h}return S.push(L),S},u=r(a[0]).map(M=>M.trim().toLowerCase()),v=[];for(let M=1;M<a.length;M++){const S=r(a[M]),L={};for(let g=0;g<u.length;g++)L[u[g]]=(S[g]??"").trim();v.push(L)}return v}function Rl(){const[t,a]=s.useState([]),[r,u]=s.useState([]),[v,M]=s.useState([]),[S,L]=s.useState([]),[g,R]=s.useState([]),[h,w]=s.useState({search:"",school_id:"",medium_id:"",std_id:"",div_id:"",employee_id:""}),[D,q]=s.useState(_s),[$,ae]=s.useState(Ns),[F,ce]=s.useState([]),[ne,J]=s.useState([]),[le,Q]=s.useState(0),[pe,re]=s.useState(!1),[O,de]=s.useState(null),[De,Se]=s.useState({period_no:"",employee_id:"",remark:""}),[Z,Fe]=s.useState(!1),ie=s.useRef(null),Ne=s.useRef(null);s.useEffect(()=>{(async()=>{var z,W;try{const[V,o,b,P,ee]=await Promise.all([E.get("/api/schools/schools",{query:{pageSize:500}}).then(d=>(d==null?void 0:d.data)||[]),E.get("/api/master",{query:{table:"media",pageSize:1e3}}).then(d=>(d==null?void 0:d.data)||[]),E.get("/api/master",{query:{table:"standards",pageSize:1e3}}).then(d=>(d==null?void 0:d.data)||[]),E.get("/api/master",{query:{table:"divisions",pageSize:1e3}}).then(d=>(d==null?void 0:d.data)||[]),E.get("/api/employees",{query:{pageSize:500}}).then(d=>(d==null?void 0:d.data)||[])]);a(V||[]),u(o||[]),M(b||[]),L(P||[]),R(ee||[]),await Re(1,$,h)}catch(V){console.error("init load",V),(W=(z=window.ui)==null?void 0:z.toast)==null||W.call(z,(V==null?void 0:V.message)||"Failed to load lookups","danger")}})()},[]);async function xe({page:z=_s,pageSize:W=Ns,filters:V={}}={}){var P,ee,d;const o={page:z,pageSize:W,search:V.search||"",school_name:V.school_id&&((P=t.find(y=>String(y.school_id)===String(V.school_id)))==null?void 0:P.school_name)||"",std_name:V.std_id&&((ee=v.find(y=>String(y.std_id)===String(V.std_id)))==null?void 0:ee.std_name)||"",employee_name:V.employee_id&&((d=g.find(y=>String(y.employee_id)===String(V.employee_id)))==null?void 0:d.full_name)||""},b=await E.get("/api/timetables",{query:o});return{data:(b==null?void 0:b.data)||[],pagination:(b==null?void 0:b.pagination)||{page:z,pageSize:W,total:0}}}async function Re(z=1,W=$,V=h){var o,b,P,ee,d;re(!0);try{const y=await xe({page:z,pageSize:W,filters:V}),C=y.data||[];ce(C),Q(((o=y.pagination)==null?void 0:o.total)||C.length),q(((b=y.pagination)==null?void 0:b.page)||z),ae(((P=y.pagination)==null?void 0:P.pageSize)||W);const B=new Map;for(const N of C){const I=N.school_id||`s_unknown_${N.school_name||"unknown"}`,m=N.school_name||"Unknown School";B.has(I)||B.set(I,{school_id:I,school_name:m,entries:[]}),B.get(I).entries.push(N)}const i=[];for(const[N,I]of B.entries()){const m={},f=new Set;for(const k of I.entries){const me=k.std_name||"All",ue=k.division_name||"",ye=ue?`${me} / ${ue}`:`${me}`;f.add(ye);const be=Number(k.day_of_week)||Ll(k.day_of_week)||null||0;m[ye]||(m[ye]={}),m[ye][be]||(m[ye][be]=[]),m[ye][be].push({timetable_id:k.timetable_id,period_no:k.period_no,employee_name:k.employee_name,employee_id:k.employee_id??null,medium_name:k.medium_name,remark:k.remark,std_name:k.std_name,division_name:k.division_name})}for(const k of Object.keys(m))for(const me of Object.keys(m[k]))m[k][me].sort((ue,ye)=>{const Le=Number(ue.period_no)||0,be=Number(ye.period_no)||0;return Le-be});const G=(t||[]).find(k=>String(k.school_id)===String(N)),X=G&&(G.logo||G.school_logo||G.image)||"/images/ANK.png";i.push({school_id:N,school_name:I.school_name,pivot:m,rowKeys:Array.from(f).sort((k,me)=>k.localeCompare(me,void 0,{numeric:!0})),logo:X})}J(i)}catch(y){console.error("refreshTimetables",y),ce([]),J([]),Q(0),(d=(ee=window.ui)==null?void 0:ee.toast)==null||d.call(ee,(y==null?void 0:y.message)||"Failed to load timetables","danger")}finally{re(!1)}}async function _e(z){const W=await E.post("/api/timetables",z);return(W==null?void 0:W.data)||{}}async function ke(z,W){const V=await E.put(`/api/timetables/${z}`,W);return(V==null?void 0:V.data)||{}}async function Ie(){var z,W,V,o,b,P,ee;try{const y="/api/timetables/export/csv?"+new URLSearchParams({search:h.search||"",school_name:h.school_id&&((z=t.find(I=>String(I.school_id)===String(h.school_id)))==null?void 0:z.school_name)||"",std_name:h.std_id&&((W=v.find(I=>String(I.std_id)===String(h.std_id)))==null?void 0:W.std_name)||"",employee_name:h.employee_id&&((V=g.find(I=>String(I.employee_id)===String(h.employee_id)))==null?void 0:V.full_name)||""}).toString(),C=await fetch(y,{method:"GET",credentials:"include"});if(!C.ok)throw new Error("Export failed");const B=await C.blob(),i=document.createElement("a"),N=URL.createObjectURL(B);i.href=N,i.download=`timetables_${Pl()}.csv`,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(N),(b=(o=window.ui)==null?void 0:o.toast)==null||b.call(o,"Export started","success")}catch(d){(ee=(P=window.ui)==null?void 0:P.toast)==null||ee.call(P,(d==null?void 0:d.message)||"Export failed","danger")}}async function x(z){var W,V,o,b,P,ee;if(z){Fe(!0);try{const d=await z.text(),y=El(d);if(!y.length){(V=(W=window.ui)==null?void 0:W.toast)==null||V.call(W,"No rows found in CSV","warning"),Fe(!1);return}if(!(window.confirm?window.confirm(`Import ${y.length} rows?`):!0)){Fe(!1);return}await E.post("/api/timetables/import/csv",{csv:d}),(b=(o=window.ui)==null?void 0:o.toast)==null||b.call(o,"Import completed","success"),await Re(1,$,h)}catch(d){console.error("import",d),(ee=(P=window.ui)==null?void 0:P.toast)==null||ee.call(P,(d==null?void 0:d.message)||"Import failed","danger")}finally{Fe(!1),ie.current&&(ie.current.value="")}}}function H(z,W){const V=document.createElement("div");V.style.display="flex",V.style.alignItems="center",V.style.gap="16px",V.style.padding="16px 20px",V.style.background="linear-gradient(90deg,#0ea5a4 0%, #60a5fa 100%)",V.style.boxSizing="border-box",V.style.borderRadius="12px",V.style.minHeight="92px",V.style.overflow="visible",V.style.boxShadow="0 3px 14px rgba(16,24,40,0.06)";const o=document.createElement("img");o.src=W,o.style.width="84px",o.style.height="84px",o.style.objectFit="contain",o.style.display="block",o.style.background="white",o.style.padding="8px",o.style.borderRadius="10px",o.style.flex="0 0 auto";const b=document.createElement("div");b.style.display="flex",b.style.flexDirection="column",b.style.justifyContent="center",b.style.flex="1 1 auto",b.style.minWidth="0";const P=document.createElement("div");P.textContent=z||"",P.style.fontSize="24px",P.style.fontWeight="700",P.style.color="#ffffff",P.style.lineHeight="1.05",P.style.overflow="visible",P.style.wordBreak="break-word",P.style.display="-webkit-box",P.style.webkitLineClamp="2",P.style.webkitBoxOrient="vertical",P.style.maxHeight="56px",P.className="school-title";const ee=document.createElement("div");return ee.textContent="School Timetable",ee.style.fontSize="13px",ee.style.color="rgba(255,255,255,0.95)",ee.style.marginTop="6px",b.appendChild(P),b.appendChild(ee),V.appendChild(o),V.appendChild(b),V}function fe(z,W=9e3){const V=Array.from(z.querySelectorAll("img"));return V.length?Promise.all(V.map(o=>new Promise(b=>{if(o.complete)return b();const P=setTimeout(()=>{o.onload=o.onerror=null,b()},W);o.onload=o.onerror=()=>{clearTimeout(P),b()}}))):Promise.resolve()}function je(z){try{return!qe||!qe.enabled||!qe.base64?!1:(z.addFileToVFS(qe.fileName,qe.base64),z.addFont(qe.fileName,qe.fontName,qe.fontStyle),z.setFont(qe.fontName,qe.fontStyle),!0)}catch(W){return console.warn("Font embed failed:",W),!1}}async function l(z,W,V,o=0){var U,he;const b=z.cloneNode(!0);b.setAttribute("data-export-school-name",W||b.getAttribute("data-export-school-name")||((U=b.querySelector(".school-title"))==null?void 0:U.textContent)||""),b.querySelectorAll("button, input, select, textarea, a").forEach(ve=>{if(ve.tagName.toLowerCase()==="a"){const Ke=document.createElement("span");Ke.textContent=ve.textContent||"",ve.parentNode.replaceChild(Ke,ve)}else ve.remove()});const P=document.createElement("div");P.style.width="1600px",P.style.background="#ffffff",P.style.padding="28px",P.style.boxSizing="border-box",P.style.fontFamily="Poppins, Inter, Roboto, Arial, sans-serif",P.style.position="fixed",P.style.left="-9999px",P.style.top="0",P.style.zIndex="9999999";const ee=document.createElement("style");ee.textContent=`
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    .pdf-card { background: #ffffff; border-radius: 12px; box-shadow: 0 6px 18px rgba(16,24,40,0.06); padding: 18px; }
    .pdf-card .p-3 { padding: 12px; }
    .pdf-card .rounded-2xl { border-radius: 14px; }
    .pdf-card .border { border: 1px solid rgba(15,23,42,0.06); }
    .pdf-card .border-t { border-top: 1px solid rgba(15,23,42,0.06); }
    .pdf-table { width: 100%; border-collapse: separate; border-spacing: 8px; }
    .pdf-table .cell { background: #fff; border: 1px solid rgba(15,23,42,0.06); padding: 10px; border-radius: 8px; min-height: 44px; }
    .pdf-table .header-cell { background: rgba(99,102,241,0.06); font-weight:600; color: #111827; padding: 12px; border-radius: 8px; text-align:center; }
    .pdf-table .period-pill { display:inline-block; padding:6px 8px; border-radius:999px; background: rgba(99,102,241,0.12); font-weight:600; font-size:12px; margin-right:8px; }
    .pdf-card .school-title { font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto; letter-spacing: -0.4px; }
    .pdf-footer { display:flex; justify-content:space-between; align-items:center; margin-top:12px; font-size:12px; color:#6b7280; }
    .pdf-meta { font-size:11px; color:#9ca3af; }
    /* ensure school-title wraps to two lines inside the header in the cloned DOM */
    .school-title { white-space:normal !important; overflow:visible !important; }
  `,P.appendChild(ee);const d=H(W,((he=b.querySelector("img"))==null?void 0:he.src)||"/image/Ank_Logo.png"),y=document.createElement("div");y.className="pdf-card",y.appendChild(d);const C=document.createElement("div");C.style.height="14px",y.appendChild(C),b.style.marginTop="8px",b.style.background="transparent",b.classList.add("export-card-clone"),y.appendChild(b);const B=document.createElement("div");B.className="pdf-footer";const i=document.createElement("div");i.textContent=`${W||""}`,i.className="pdf-meta";const N=document.createElement("div");N.textContent=`Generated: ${new Date().toLocaleString()}`,N.className="pdf-meta",B.appendChild(i),B.appendChild(N),y.appendChild(B),P.appendChild(y),document.body.appendChild(P),await fe(P,1e4);const I=await Es(P,{scale:2.5,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff",logging:!1,imageTimeout:9e3});document.body.removeChild(P);const m=I.toDataURL("image/png",1),f=V.internal.pageSize.getWidth(),G=V.internal.pageSize.getHeight(),X=V.getImageProperties(m),k=X.width,ue=X.height/k,ye=10,Le=f-ye*2,be=Le*ue,we=Le,Pe=ye;o>0&&V.addPage(),je(V),V.addImage(m,"PNG",ye,Pe,we,be),V.setDrawColor(220,224,230),V.setLineWidth(.6),V.rect(5,5,f-10,G-10);const Oe=`Page ${o+1}`;V.setFontSize(9),V.setTextColor(113,122,133);const n=G-6,c=f/2;V.text(Oe,c,n,{align:"center"});const _=new Date().toLocaleString();V.text(_,f-ye,n,{align:"right"})}async function j(z="[data-export-school]"){var W,V,o,b,P,ee,d,y;try{const C=Array.from(document.querySelectorAll(z));if(!C.length){(V=(W=window.ui)==null?void 0:W.toast)==null||V.call(W,"No cards found to export","warning");return}const B=new Wt({unit:"mm",format:"a4",orientation:"landscape"});qe&&qe.enabled&&qe.base64;for(let N=0;N<C.length;N++){const I=C[N],m=I.getAttribute("data-export-school"),f=I.getAttribute("data-export-school-name")||((b=(o=I.querySelector(".school-title"))==null?void 0:o.textContent)==null?void 0:b.trim())||`School ${m}`;await l(I,f,B,N)}const i=`timetables_schools_${new Date().toISOString().slice(0,10)}.pdf`;B.save(i),(ee=(P=window.ui)==null?void 0:P.toast)==null||ee.call(P,"Exported PDF (landscape)","success")}catch(C){console.error("exportAllCardsPdfFromDom:",C),(y=(d=window.ui)==null?void 0:d.toast)==null||y.call(d,(C==null?void 0:C.message)||"PDF export failed","danger")}}const Y=j;async function se(z){var o,b,P,ee,d,y,C,B;const W=`[data-export-school="${String(z)}"]`,V=document.querySelector(W);if(!V){(b=(o=window.ui)==null?void 0:o.toast)==null||b.call(o,"Card not found","warning");return}try{const i=new Wt({unit:"mm",format:"a4",orientation:"landscape"});qe&&qe.enabled&&qe.base64;const N=V.getAttribute("data-export-school-name")||((ee=(P=V.querySelector(".school-title"))==null?void 0:P.textContent)==null?void 0:ee.trim())||`School ${z}`;await l(V,N,i,0);const I=`timetable_${(N||"school").replace(/\s+/g,"_")}.pdf`;i.save(I),(y=(d=window.ui)==null?void 0:d.toast)==null||y.call(d,"Exported PDF (landscape)","success")}catch(i){console.error("exportCardPdfBySchoolId:",i),(B=(C=window.ui)==null?void 0:C.toast)==null||B.call(C,(i==null?void 0:i.message)||"PDF export failed","danger")}}function Me(z,W,V,o=null){de({school_id:z,rowKey:W,dayIndex:V,existingEntry:o}),Se({period_no:(o==null?void 0:o.period_no)??"",employee_id:(o==null?void 0:o.employee_id)??"",remark:(o==null?void 0:o.remark)??""}),setTimeout(()=>{if(Ne.current){const b=Ne.current.querySelector('input[name="period_no"]');b&&b.focus()}},50)}function p(){de(null),Se({period_no:"",employee_id:"",remark:""})}async function T(){var C,B,i,N,I,m,f,G;if(!O)return;const{school_id:z,rowKey:W,dayIndex:V,existingEntry:o}=O;let b=null,P=null;if(W.includes("/")){const[X,k]=W.split("/").map(me=>me.trim());b=X,P=k}else b=W,P=null;const ee=t.find(X=>String(X.school_id)===String(z)),y={school_name:(ee==null?void 0:ee.school_name)||"",medium_name:null,std_name:b||null,division_name:P||null,employee_name:((C=g.find(X=>String(X.employee_id)===String(De.employee_id)))==null?void 0:C.full_name)||De.employee_id||null,day_of_week:Number(V)||null,period_no:De.period_no===""?null:Number(De.period_no),remark:((B=De.remark)==null?void 0:B.trim())||null};try{o&&o.timetable_id?(await ke(o.timetable_id,y),(N=(i=window.ui)==null?void 0:i.toast)==null||N.call(i,"Updated","success")):(await _e(y),(m=(I=window.ui)==null?void 0:I.toast)==null||m.call(I,"Created","success")),p(),await Re(1,$,h)}catch(X){console.error("save editor",X),(G=(f=window.ui)==null?void 0:f.toast)==null||G.call(f,(X==null?void 0:X.message)||"Save failed","danger")}}function te(z=[],W,V,o){return!z||!z.length?O&&O.school_id===W&&O.rowKey===V&&O.dayIndex===o?ge():e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("button",{className:"text-xs text-slate-400 px-2 py-1 border rounded",onClick:()=>Me(W,V,o,null),children:"—"})}):(z[0],O&&O.school_id===W&&O.rowKey===V&&O.dayIndex===o?ge():e.jsx("div",{children:z.map((P,ee)=>e.jsxs("div",{className:"mb-1 p-2 rounded border bg-slate-50",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-xs font-semibold",children:["P",P.period_no??"—"," ",P.employee_name?`• ${P.employee_name}`:""]}),e.jsx("div",{className:"flex gap-1",children:e.jsx("button",{className:"text-[11px] px-2 py-0.5 border rounded",onClick:()=>Me(W,V,o,P),children:"Edit"})})]}),P.remark&&e.jsx("div",{className:"text-[11px] text-slate-500 italic truncate",title:P.remark,children:P.remark})]},ee))}))}function ge(z,W,V,o){return e.jsx("div",{ref:Ne,className:"p-2 rounded border bg-white shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{name:"period_no",type:"number",min:"1",className:"text-xs w-[64px] p-1 border rounded",placeholder:"Period",value:De.period_no??"",onChange:b=>Se(P=>({...P,period_no:b.target.value})),onKeyDown:b=>{b.key==="Enter"&&T(),b.key==="Escape"&&p()}}),e.jsxs("select",{className:"text-xs p-1 border rounded",value:De.employee_id??"",onChange:b=>Se(P=>({...P,employee_id:b.target.value})),onKeyDown:b=>{b.key==="Enter"&&T(),b.key==="Escape"&&p()},children:[e.jsx("option",{value:"",children:"— select faculty —"}),g.map(b=>e.jsx("option",{value:b.employee_id,children:b.full_name},b.employee_id))]}),e.jsx("input",{type:"text",className:"text-xs flex-1 p-1 border rounded",placeholder:"Remark",value:De.remark??"",onChange:b=>Se(P=>({...P,remark:b.target.value})),onKeyDown:b=>{b.key==="Enter"&&T(),b.key==="Escape"&&p()}}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{className:"text-xs px-2 py-1 bg-blue-600 text-white rounded",onClick:T,children:"Save"}),e.jsx("button",{className:"text-xs px-2 py-1 border rounded",onClick:p,children:"Cancel"})]})]})})}function oe(){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("a",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md border",href:"/api/timetables/export/csv",onClick:z=>{z.preventDefault(),Ie()},children:[e.jsx("i",{className:"bi bi-filetype-csv"})," Export CSV"]}),e.jsxs("label",{className:"inline-flex items-center px-3 py-1.5 rounded-md border cursor-pointer",children:["Import CSV",e.jsx("input",{ref:ie,type:"file",accept:".csv,text/csv",hidden:!0,onChange:z=>x(z.target.files&&z.target.files[0])})]}),e.jsx(He,{onClick:()=>Re(1,$,h),children:"Refresh"}),e.jsx(Dt,{onClick:()=>window.scrollTo({top:0,behavior:"smooth"})})]})}function Ee(){return e.jsx("div",{style:{display:"grid",gap:"1rem",gridTemplateColumns:`repeat(${Math.max(1,ks)}, minmax(0,1fr))`},children:[1,2,3].map(z=>e.jsxs("div",{className:"bg-white border rounded-lg p-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-slate-200 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-40 bg-slate-100 rounded"})]},z))})}function Ce(z){const{school_name:W,pivot:V,rowKeys:o,logo:b}=z;return e.jsxs("div",{"data-export-school":z.school_id,"data-export-school-name":W,className:"bg-white border rounded-2xl shadow-sm overflow-hidden transform transition hover:-translate-y-1 motion-reduce:transform-none",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"h-12 w-12 rounded-md overflow-hidden bg-white flex-shrink-0 border",children:e.jsx("img",{src:b||"/images/ANK.png",alt:W,className:"h-full w-full object-contain",onError:P=>{P.currentTarget.src="/images/ANK.png"}})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-lg font-semibold truncate school-title",children:W}),e.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[o.length," class row(s)"]})]})]}),e.jsxs("div",{className:"text-xs text-slate-400",children:["School ID: ",String(z.school_id)]})]}),e.jsx("div",{className:"p-3 overflow-x-auto",children:e.jsxs("div",{className:"inline-block min-w-[720px]",children:[e.jsxs("div",{className:"grid",style:{gridTemplateColumns:"200px repeat(7, 1fr)",gap:"0.5rem",alignItems:"center"},children:[e.jsx("div",{className:"px-2 py-2 font-medium text-sm border rounded-l-lg bg-slate-50",children:"Std / Div"}),Ml.map((P,ee)=>e.jsx("div",{className:"px-2 py-2 text-center font-medium text-sm border bg-slate-50",children:P},P))]}),e.jsxs("div",{children:[o.length===0&&e.jsx("div",{className:"mt-3 text-sm text-slate-500",children:"No class rows for this school."}),o.map(P=>e.jsxs("div",{className:"grid",style:{gridTemplateColumns:"200px repeat(7, 1fr)",gap:"0.5rem",alignItems:"start",marginTop:"0.5rem"},children:[e.jsx("div",{className:"px-2 py-2 font-medium text-sm border-l border-t border-b rounded-l-md bg-white",children:P}),Array.from({length:7}).map((ee,d)=>{const y=d+1,C=V[P]&&V[P][y]?V[P][y]:[];return e.jsx("div",{className:"px-2 py-2 border rounded-md bg-white min-h-[48px]",children:te(C,z.school_id,P,y)},y)})]},P))]})]})}),e.jsxs("div",{className:"p-3 border-t flex items-center justify-between text-xs text-slate-500",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>{const ee="/api/timetables/export/csv?"+new URLSearchParams({school_name:W}).toString();window.open(ee,"_blank")},children:"Export school CSV"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},children:"Top"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>{const ee="/api/timetables/export/csv?"+new URLSearchParams({school_name:W}).toString();window.open(ee,"_blank")},children:"Export school CSV"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>se(z.school_id),children:"Export PDF"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>{window.scrollTo({top:0,behavior:"smooth"})},children:"Top"})]})]})]},z.school_id)}return e.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-8",style:{fontFamily:"Poppins, Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto"},children:[e.jsx("style",{children:"@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"School Timetables — Pivot Cards"}),e.jsx("div",{className:"text-sm text-slate-500",children:"Click any box to assign/edit period & faculty."})]}),e.jsx("button",{className:"px-3 py-1.5 rounded-md border",onClick:()=>Y(),children:"Export All Cards (PDF)"}),e.jsx("div",{className:"flex items-center gap-2",children:oe()})]}),e.jsx("div",{className:"bg-white border rounded-lg p-4 shadow-sm mb-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-3",children:[e.jsx("div",{className:"md:col-span-3",children:e.jsx(K,{label:"Search",children:e.jsx(ze,{placeholder:"school, medium, std, employee...",value:h.search,onChange:z=>{w(W=>({...W,search:z})),q(1),Re(1,$,{...h,search:z})}})})}),e.jsx("div",{children:e.jsx(K,{label:"School",children:e.jsx(Te,{value:h.school_id,onChange:z=>{w(W=>({...W,school_id:z})),q(1),Re(1,$,{...h,school_id:z})},options:[{value:"",label:"All"},...(t||[]).map(z=>({value:z.school_id,label:z.school_name}))]})})}),e.jsx("div",{children:e.jsx(K,{label:"Medium",children:e.jsx(Te,{value:h.medium_id,onChange:z=>{w(W=>({...W,medium_id:z})),q(1),Re(1,$,{...h,medium_id:z})},options:[{value:"",label:"All"},...(r||[]).map(z=>({value:z.medium_id||z.medium_name,label:z.medium_name}))]})})}),e.jsx("div",{children:e.jsx(K,{label:"Std",children:e.jsx(Te,{value:h.std_id,onChange:z=>{w(W=>({...W,std_id:z})),q(1),Re(1,$,{...h,std_id:z})},options:[{value:"",label:"All"},...(v||[]).map(z=>({value:z.std_id,label:z.std_name}))]})})}),e.jsx("div",{children:e.jsx(K,{label:"Page Size",children:e.jsx(Te,{value:$,onChange:z=>{ae(Number(z)),q(1),Re(1,Number(z),h)},options:[{value:100,label:"100"},{value:200,label:"200"},{value:500,label:"500"}]})})})]})}),e.jsxs("div",{style:{display:"grid",gap:"1rem",gridTemplateColumns:`repeat(${Math.max(1,ks)}, minmax(0,1fr))`},children:[pe&&Ee(),!pe&&ne.length===0&&e.jsx("div",{className:"col-span-full p-6 text-center text-slate-500",children:"No timetable cards found"}),!pe&&ne.map(Ce)]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-slate-500",children:["Showing page ",D," — ",le," result(s)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded border",onClick:()=>{D>1&&(q(z=>z-1),Re(D-1,$,h))},disabled:D<=1,children:"Prev"}),e.jsx("button",{className:"px-3 py-1 rounded border",onClick:()=>{q(z=>z+1),Re(D+1,$,h)},children:"Next"})]})]})]})}const Ss={1:["07:35:00","08:10:00"],2:["08:15:00","08:50:00"],3:["09:00:00","09:35:00"],4:["09:45:00","10:20:00"],5:["10:30:00","11:05:00"],6:["11:15:00","11:50:00"],7:["12:30:00","13:05:00"],8:["13:15:00","13:50:00"]},Il=(t=new Date)=>t instanceof Date?t.toISOString().slice(0,10):String(t).slice(0,10);function Cs(t){const a=String(t||"");let r=0;for(let S=0;S<a.length;S++)r=(r*31+a.charCodeAt(S))%360;const u=r,v=55+r%20;return`hsl(${u} ${v}% 75%)`}function Tl(t){const a=String(t.session_date||"").slice(0,10),r=`${a}T${(t.start_time||"00:00:00").slice(0,8)}`,u=`${a}T${(t.end_time||"00:00:00").slice(0,8)}`,v=[];t.std_name&&v.push(`Std ${t.std_name}`),t.division_name&&v.push(`/ ${t.division_name}`),t.employee_name&&v.push(`• ${t.employee_name}`);const M=v.join(" ");return{id:t.cs_id,title:M||t.school_name||"Session",start:r,end:u,extendedProps:t}}function Dl(){const[t,a]=s.useState([]),[r,u]=s.useState([]),[v,M]=s.useState([]),[S,L]=s.useState([]),[g,R]=s.useState(Il()),[h,w]=s.useState(""),[D,q]=s.useState(""),[$,ae]=s.useState(""),[F,ce]=s.useState(""),[ne,J]=s.useState(""),[le,Q]=s.useState(""),[pe,re]=s.useState([]),[O,de]=s.useState(!1),[De,Se]=s.useState("both"),[Z,Fe]=s.useState(!0),[ie,Ne]=s.useState("school"),[xe,Re]=s.useState([]),[_e,ke]=s.useState(!1),[Ie,x]=s.useState(null),[H,fe]=s.useState({employee_id:"",remark:"",start_time:"",end_time:""}),je=s.useRef(null),l=s.useRef(null);s.useEffect(()=>{(async()=>{var d,y;try{const[C,B,i,N]=await Promise.all([E.get("/api/schools/schools",{query:{pageSize:500}}).then(I=>(I==null?void 0:I.data)||[]),E.get("/api/master",{query:{table:"standards",pageSize:500}}).then(I=>(I==null?void 0:I.data)||[]),E.get("/api/master",{query:{table:"divisions",pageSize:500}}).then(I=>(I==null?void 0:I.data)||[]),E.get("/api/employees",{query:{pageSize:500}}).then(I=>(I==null?void 0:I.data)||[])]);a(C||[]),u(B||[]),M(i||[]),L(N||[])}catch(C){console.error("load lookups",C),(y=(d=window.ui)==null?void 0:d.toast)==null||y.call(d,"Failed to load lookups","warning")}})()},[]),s.useEffect(()=>{const d=new Set;for(const C of pe)C.period_no?d.add(`P${C.period_no}`):C.start_time&&C.end_time?d.add(`${C.start_time.slice(0,5)}-${C.end_time.slice(0,5)}`):d.add("Unk");const y=Array.from(d).sort((C,B)=>{const i=C.match(/^P(\d+)$/),N=B.match(/^P(\d+)$/);return i&&N?Number(i[1])-Number(N[1]):i&&!N?-1:!i&&N?1:C.localeCompare(B,void 0,{numeric:!0})});Re(y)},[pe]);async function j(d={}){var y,C;de(!0);try{const{data:B}=await E.get("/api/class-sessions",{query:d}),i=(B||[]).map(N=>(N.session_date&&N.session_date.toISOString&&(N.session_date=N.session_date.toISOString().slice(0,10)),N));return re(i),i}catch(B){return console.error("fetchSessions",B),(C=(y=window.ui)==null?void 0:y.toast)==null||C.call(y,"Failed to fetch sessions","warning"),re([]),[]}finally{de(!1)}}s.useEffect(()=>{j({session_date:g,pageSize:1e3})},[]);async function Y(d){var C;if(!d||!d.length)return{created:0};try{const B=await E.post("/api/class-sessions/bulk",{sessions:d});return{created:((C=B==null?void 0:B.data)==null?void 0:C.created_count)??d.length,raw:B}}catch(B){console.warn("bulk failed",B)}let y=0;for(const B of d)try{const i=await E.post("/api/class-sessions",B);i!=null&&i.data&&y++}catch(i){console.error("create session",i,B)}return{created:y}}async function se(d){return E.post("/api/class-sessions/from-timetable",d)}async function Me(d,y){var C,B,i,N;try{const I=await E.put(`/api/class-sessions/${d}`,y);return(B=(C=window.ui)==null?void 0:C.toast)==null||B.call(C,"Session updated","success"),await j({session_date:g,pageSize:1e3}),I}catch(I){throw console.error("updateSession",I),(N=(i=window.ui)==null?void 0:i.toast)==null||N.call(i,"Update failed","danger"),I}}async function p(d){var y,C,B,i;if(confirm("Delete this session?"))try{await E.delete(`/api/class-sessions/${d}`),(C=(y=window.ui)==null?void 0:y.toast)==null||C.call(y,"Deleted","success"),await j({session_date:g,pageSize:1e3})}catch(N){console.error("deleteSession",N),(i=(B=window.ui)==null?void 0:B.toast)==null||i.call(B,"Delete failed","danger")}}async function T({weekday:d,school_id:y=null,std_id:C=null,div_id:B=null,employee_id:i=null}){const N={pageSize:2e3,day_of_week:d};y&&(N.school_id=y),C&&(N.std_id=C),B&&(N.div_id=B),i&&(N.employee_id=i);try{const I=await E.get("/api/timetables",{query:N});return(I==null?void 0:I.data)||[]}catch(I){return console.error("fetchTimetableEntriesForWeekday",I),[]}}async function te({targetDate:d,school_id:y,std_id:C,div_id:B,employee_id:i,usePresetTimes:N=!0}){var k,me,ue,ye,Le,be;if(!d){(me=(k=window.ui)==null?void 0:k.toast)==null||me.call(k,"Pick a date","warning");return}const I=new Date(d).getDay(),f=await T({weekday:I===0?7:I,school_id:y,std_id:C,div_id:B,employee_id:i});if(!f.length)return(ye=(ue=window.ui)==null?void 0:ue.toast)==null||ye.call(ue,"No timetable entries for that weekday","warning"),{created:0};const G=f.map(we=>{const Pe=Number(we.period_no)||null,[Oe,n]=N&&Pe&&Ss[Pe]?Ss[Pe]:[we.start_time||null,we.end_time||null];return{school_id:Number(we.school_id)||(y?Number(y):null),school_name:we.school_name||null,medium_id:we.medium_id||null,std_id:we.std_id||null,std_name:we.std_name||null,div_id:we.div_id||null,division_name:we.division_name||null,employee_id:we.employee_id||(i?Number(i):null),employee_name:we.employee_name||null,timetable_id:we.timetable_id||null,period_no:Pe,start_time:Oe,end_time:n,session_date:d,remark:we.remark||null}}),X=await Y(G);return await j({session_date:g,pageSize:1e3}),(be=(Le=window.ui)==null?void 0:Le.toast)==null||be.call(Le,`${X.created||0} sessions created`,"success"),{created:X.created||0,entries:G}}function ge(d){x(d),fe({employee_id:d.employee_id??"",remark:d.remark??"",start_time:d.start_time??"",end_time:d.end_time??""}),ke(!0)}async function oe(){if(!Ie)return;const d={employee_id:H.employee_id||null,remark:H.remark||null,start_time:H.start_time||null,end_time:H.end_time||null};try{await Me(Ie.cs_id,d),ke(!1),x(null)}catch{}}function Ee(d){const y={},C=new Set;for(const i of d){const N=i.std_name||i.std_id||"All",I=i.division_name||i.div_id||"",m=I?`${N} / ${I}`:`${N}`;C.add(m);let f="Unk";i.period_no?f=`P${i.period_no}`:i.start_time&&i.end_time&&(f=`${i.start_time.slice(0,5)}-${i.end_time.slice(0,5)}`),y[m]||(y[m]={}),y[m][f]||(y[m][f]=[]),y[m][f].push(i)}const B=Array.from(C).sort((i,N)=>i.localeCompare(N,void 0,{numeric:!0}));return{pivot:y,rowKeys:B}}function Ce(d){const y={school_class_id:`${d.school_id||""}:${d.medium_id||""}:${d.std_id||""}:${d.div_id||""}`,date:d.session_date?String(d.session_date).slice(0,10):""};sessionStorage.setItem("sa_prefill",JSON.stringify(y)),location.hash="#/student-attendance"}function z(d){const y=ie==="school"?d.school_id:d.employee_id,C=Cs(y);return e.jsx("div",{className:`session-card ${Z?"compact":""}`,style:{background:C,padding:Z?"6px":"10px",borderRadius:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8},children:[e.jsxs("div",{style:{minWidth:0},children:[e.jsxs("div",{style:{fontWeight:600,fontSize:Z?13:14,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[d.period_no?`P${d.period_no}`:d.start_time&&d.end_time?`${d.start_time.slice(0,5)}-${d.end_time.slice(0,5)}`:"Session",e.jsx("span",{style:{marginLeft:8,fontWeight:500,color:"#0f172a",opacity:.85},children:d.employee_name||d.school_name})]}),d.remark&&e.jsx("div",{style:{fontSize:12,color:"#374151",marginTop:4},children:d.remark})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"flex-end"},children:[e.jsx("button",{className:"px-2 py-1",style:{borderRadius:6,border:"1px solid rgba(15,23,42,0.08)",background:"#fff"},onClick:()=>Ce(d),children:"Attendance"}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{className:"px-2 py-1",style:{borderRadius:6,border:"1px solid rgba(15,23,42,0.08)",background:"#fff"},onClick:()=>ge(d),children:"Edit"}),e.jsx("button",{className:"px-2 py-1",style:{borderRadius:6,border:"1px solid rgba(15,23,42,0.08)",background:"#fff",color:"#b91c1c"},onClick:()=>p(d.cs_id),children:"Delete"})]})]})]})},d.cs_id||`${d.school_id}-${d.std_id}-${d.div_id}-${d.session_date}-${d.period_no}`)}async function W(){var d,y,C,B,i,N;if(!l.current){(y=(d=window.ui)==null?void 0:d.toast)==null||y.call(d,"Nothing to export","warning");return}try{const m=l.current.cloneNode(!0);m.style.width="1200px",m.style.background="#ffffff",m.style.padding="18px";const f=document.createElement("div");f.style.display="flex",f.style.justifyContent="space-between",f.style.alignItems="center",f.style.marginBottom="12px",f.innerHTML=`<div style="font-weight:700;font-size:18px">Class Sessions — Pivot</div><div style="font-size:12px;color:#374151">Generated: ${new Date().toLocaleString()}</div>`,m.insertBefore(f,m.firstChild),document.body.appendChild(m),await new Promise(c=>setTimeout(c,80));const G=await Es(m,{scale:2,useCORS:!0,backgroundColor:"#ffffff",logging:!1,imageTimeout:7e3});document.body.removeChild(m);const X=G.toDataURL("image/png",1),k=new Wt({unit:"mm",format:"a4",orientation:"landscape"}),me=k.internal.pageSize.getWidth(),ue=10,ye=k.getImageProperties(X),Le=ye.width,we=ye.height/Le,Pe=me-ue*2,Oe=Pe,n=Pe*we;k.addImage(X,"PNG",ue,ue,Oe,n),k.setFontSize(9),k.setTextColor(100),k.text(`Generated: ${new Date().toLocaleString()}`,me-ue,k.internal.pageSize.getHeight()-6,{align:"right"}),k.save(`class_sessions_pivot_${new Date().toISOString().slice(0,10)}.pdf`),(B=(C=window.ui)==null?void 0:C.toast)==null||B.call(C,"Exported PDF","success")}catch(I){console.error("exportPivotToPdf",I),(N=(i=window.ui)==null?void 0:i.toast)==null||N.call(i,"Export failed","danger")}}async function V(){const d={session_date:g,pageSize:1e3};h&&(d.timetable_id=h),D&&(d.period_no=Number(D)),$&&(d.school_id=Number($)),F&&(d.std_id=Number(F)),ne&&(d.div_id=Number(ne)),le&&(d.employee_id=Number(le)),await j(d)}async function o(){var y,C,B,i,N,I,m;const d={timetable_id:h||null,school_id:$?Number($):null,std_id:F?Number(F):null,div_id:ne?Number(ne):null,employee_id:le?Number(le):null,session_date:g,period_no:D?Number(D):null};if(!d.session_date){(C=(y=window.ui)==null?void 0:y.toast)==null||C.call(y,"Pick a date","warning");return}if(!(!d.timetable_id&&!d.school_id&&!d.std_id&&!d.employee_id&&!confirm("No timetable_id, school, std or employee selected — this will attempt to create sessions for all accessible timetables. Continue?")))try{const f=await se(d),G=((B=f==null?void 0:f.data)==null?void 0:B.created_count)??(f==null?void 0:f.created_count)??0;(N=(i=window.ui)==null?void 0:i.toast)==null||N.call(i,`${G} sessions created`,"success"),await j({session_date:g,pageSize:1e3})}catch(f){console.error("createFromTimetableAPI",f),(m=(I=window.ui)==null?void 0:I.toast)==null||m.call(I,"Create failed","danger")}}async function b(){confirm("Create sessions from timetable entries for the weekday of the selected date (preset times)?")&&await te({targetDate:g,school_id:$||null,std_id:F||null,div_id:ne||null,employee_id:le||null,usePresetTimes:!0})}const{pivot:P,rowKeys:ee}=Ee(pe);return e.jsxs("main",{className:"max-w-7xl mx-auto px-6 py-6",style:{fontFamily:"Inter, system-ui, -apple-system, 'Segoe UI', Roboto"},children:[e.jsx("style",{children:`
        /* Corporate look */
        .card { background:#fff; border:1px solid rgba(15,23,42,0.06); border-radius:10px; box-shadow: 0 6px 18px rgba(16,24,40,0.04); }
        .controls-row { display:flex; gap:12px; align-items:end; flex-wrap:wrap; }
        .control-item { min-width:160px; flex: 1 1 200px; }
        .btn { padding:8px 12px; border-radius:8px; border:1px solid rgba(15,23,42,0.08); background:#fff; cursor:pointer; }
        .btn-primary { background:#0ea5a4; color:#fff; border:none; }
        .btn-ghost { background:transparent; border:1px solid rgba(15,23,42,0.06); }
        .session-card { border:1px solid rgba(15,23,42,0.06); border-radius:8px; padding:10px; }
        .compact .session-card { padding:6px; box-shadow:none; border-radius:6px; }
        /* pivot grid */
        .pivot-grid { gap:0.6rem; align-items:stretch; }
        .pivot-grid .head { background:#f8fafc; padding:10px; border:1px solid rgba(15,23,42,0.06); font-weight:600; text-align:center; }
        .pivot-grid .cell { padding:10px; min-height:56px; }
        /* print */
        @media print {
          .no-print{ display:none !important }
          .card { box-shadow:none !important }
        }
      `}),e.jsxs("div",{className:"card no-print",style:{padding:18,marginBottom:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:18},children:"Class Sessions"}),e.jsx("div",{style:{color:"#6b7280",marginTop:6},children:"Create and visualise sessions — compact pivot for printing, calendar for scheduling."})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>Se("both"),children:"Both"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>Se("pivot"),children:"Pivot"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>Se("calendar"),children:"Calendar"}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>{Fe(d=>!d)},children:"Toggle Compact"}),e.jsx("button",{className:"btn btn-primary",onClick:W,children:"Export Pivot → PDF"})]})]}),e.jsxs("div",{className:"controls-row",style:{marginTop:8},children:[e.jsx("div",{className:"control-item",children:e.jsx(K,{label:"Date",children:e.jsx(Et,{value:g,onChange:d=>R(d)})})}),e.jsx("div",{className:"control-item",children:e.jsx(K,{label:"Timetable ID",children:e.jsx(ze,{placeholder:"timetable_id (optional)",value:h,onChange:d=>w(d)})})}),e.jsx("div",{className:"control-item",children:e.jsx(K,{label:"Period",children:e.jsx(ze,{type:"number",placeholder:"period_no",value:D,onChange:d=>q(d)})})}),e.jsx("div",{className:"control-item",children:e.jsx(K,{label:"School",children:e.jsx(Te,{value:$,onChange:d=>ae(d),options:[{value:"",label:"— any —"},...(t||[]).map(d=>({value:d.school_id,label:d.school_name}))]})})}),e.jsx("div",{className:"control-item",children:e.jsx(K,{label:"Std",children:e.jsx(Te,{value:F,onChange:d=>ce(d),options:[{value:"",label:"— any —"},...(r||[]).map(d=>({value:d.std_id,label:d.std_name}))]})})}),e.jsx("div",{className:"control-item",children:e.jsx(K,{label:"Div",children:e.jsx(Te,{value:ne,onChange:d=>J(d),options:[{value:"",label:"— any —"},...(v||[]).map(d=>({value:d.div_id,label:d.division_name}))]})})}),e.jsx("div",{className:"control-item",children:e.jsx(K,{label:"Employee",children:e.jsx(Te,{value:le,onChange:d=>Q(d),options:[{value:"",label:"— any —"},...(S||[]).map(d=>({value:d.employee_id,label:d.full_name}))]})})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:V,children:"Load"}),e.jsx("button",{className:"btn",onClick:o,children:"Create from timetable (server)"}),e.jsx("button",{className:"btn",onClick:b,children:"Create by weekday (preset times)"})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{color:"#6b7280",fontSize:13},children:"Color by"}),e.jsxs("select",{value:ie,onChange:d=>Ne(d.target.value),style:{padding:8,borderRadius:8},children:[e.jsx("option",{value:"school",children:"School"}),e.jsx("option",{value:"teacher",children:"Teacher"})]})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:De==="both"?"1fr 460px":"1fr",gap:16},children:[De!=="calendar"&&e.jsxs("div",{className:"card",style:{padding:16},children:[e.jsx("h4",{style:{marginTop:0},children:"Pivot — Std / Div × Timings (Compact)"}),O?e.jsx("div",{style:{color:"#6b7280"},children:"Loading…"}):ee.length===0?e.jsx("div",{style:{color:"#6b7280"},children:"No sessions found"}):e.jsx("div",{ref:l,style:{overflowX:"auto"},children:e.jsx("div",{style:{display:"inline-block",minWidth:Math.max(720,240+xe.length*220)},children:e.jsxs("div",{className:"pivot-grid",style:{display:"grid",gridTemplateColumns:`240px repeat(${xe.length||1}, 1fr)`},children:[e.jsx("div",{className:"head",children:"Std / Div"}),xe.map(d=>e.jsx("div",{className:"head",children:d},d)),ee.map(d=>e.jsxs(lt.Fragment,{children:[e.jsx("div",{className:"cell",style:{fontWeight:600},children:d}),xe.map(y=>{const C=P[d]&&P[d][y]?P[d][y]:[];return e.jsx("div",{className:"cell",style:{minHeight:72},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:C.length===0?e.jsx("div",{style:{color:"#9ca3af"},children:"—"}):C.map(B=>z(B))})},y)})]},d))]})})})]}),De!=="pivot"&&e.jsxs("div",{className:"card",style:{padding:12},children:[e.jsx("h4",{style:{marginTop:0},children:"Calendar"}),e.jsx(aa,{ref:je,plugins:[oa,da,ca,ma],initialView:"timeGridWeek",nowIndicator:!0,firstDay:1,slotMinTime:"07:30:00",slotMaxTime:"18:30:00",allDaySlot:!1,headerToolbar:{left:"prev,next today",center:"title",right:"timeGridWeek,timeGridDay,listWeek"},navLinks:!0,businessHours:[{daysOfWeek:[1,2,3,4,5,6],startTime:"08:00",endTime:"16:30"}],events:pe.map(d=>{const y=Tl(d),C=ie==="school"?d.school_id:d.employee_id;return y.backgroundColor=Cs(C),y.borderColor="rgba(15,23,42,0.06)",y}),eventClick:d=>{const y=d.event.extendedProps,C=`${d.event.title}
Date: ${y.session_date}
Period: ${y.period_no||"N/A"}
School: ${y.school_name||y.school_id||""}
Faculty: ${y.employee_name||""}`;if(confirm(`${C}

Open Student Attendance for this session?`)){const B={school_class_id:`${y.school_id||""}:${y.medium_id||""}:${y.std_id||""}:${y.div_id||""}`,date:y.session_date?String(y.session_date).slice(0,10):""};sessionStorage.setItem("sa_prefill",JSON.stringify(B)),location.hash="#/student-attendance"}},eventDidMount:d=>{const y=d.event.extendedProps;if(y&&y.school_name){const C=d.el.querySelector(".fc-event-title");if(C){const B=document.createElement("div");B.style.fontSize="0.75em",B.style.opacity="0.9",B.textContent=y.school_name,C.appendChild(B)}}},height:"auto"}),e.jsx("div",{style:{color:"#6b7280",marginTop:10},children:"Click an event to open Student Attendance (prefills class/date)"})]})]}),_e&&e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(2,6,23,0.45)",zIndex:9999},children:e.jsxs("div",{style:{width:720,maxWidth:"95%",background:"#fff",borderRadius:10,padding:18},children:[e.jsx("h3",{style:{marginTop:0},children:"Edit Session"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx("div",{children:e.jsx(K,{label:"Employee",children:e.jsx(Te,{value:H.employee_id||"",onChange:d=>fe(y=>({...y,employee_id:d})),options:[{value:"",label:"— none —"},...(S||[]).map(d=>({value:d.employee_id,label:d.full_name}))]})})}),e.jsx("div",{children:e.jsx(K,{label:"Period",children:e.jsx("input",{type:"text",readOnly:!0,value:Ie!=null&&Ie.period_no?`P${Ie.period_no}`:Ie!=null&&Ie.start_time&&(Ie!=null&&Ie.end_time)?`${Ie.start_time.slice(0,5)}-${Ie.end_time.slice(0,5)}`:"",className:"form-control"})})}),e.jsx("div",{children:e.jsx(K,{label:"Start time",children:e.jsx("input",{type:"time",value:H.start_time?H.start_time.slice(0,5):"",onChange:d=>fe(y=>({...y,start_time:d.target.value?`${d.target.value}:00`:""})),className:"form-control"})})}),e.jsx("div",{children:e.jsx(K,{label:"End time",children:e.jsx("input",{type:"time",value:H.end_time?H.end_time.slice(0,5):"",onChange:d=>fe(y=>({...y,end_time:d.target.value?`${d.target.value}:00`:""})),className:"form-control"})})}),e.jsx("div",{style:{gridColumn:"1 / -1"},children:e.jsx(K,{label:"Remark",children:e.jsx(ze,{value:H.remark||"",onChange:d=>fe(y=>({...y,remark:d}))})})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[e.jsx("button",{className:"btn",onClick:()=>{ke(!1),x(null)},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:oe,children:"Save"})]})]})})]})}const _t="/images/ANK.png",Ms="/images/Ank_Logo.png",yt=t=>t&&String(t).trim()?t:_t;function Fl(){const[t,a]=s.useState([]),[r,u]=s.useState([]),[v,M]=s.useState([]),[S,L]=s.useState([]),[g,R]=s.useState(!1),[h,w]=s.useState({page:1,pageSize:20,total:0}),[D,q]=s.useState(""),[$,ae]=s.useState(""),[F,ce]=s.useState(""),[ne,J]=s.useState(""),[le,Q]=s.useState(!1),[pe,re]=s.useState(null),[O,de]=s.useState({course_id:null,course_name:"",description:"",price:"",medium_id:"",std_id:"",book_id:"",image:""}),[De,Se]=s.useState(!1),[Z,Fe]=s.useState(_t),ie=s.useRef(null);s.useEffect(()=>{(async()=>{var l,j;try{const[Y,se,Me]=await Promise.all([E.get("/api/master",{query:{table:"media",pageSize:1e3}}),E.get("/api/master",{query:{table:"standards",pageSize:1e3}}),E.get("/api/books",{query:{pageSize:1e3}})]);a((Y==null?void 0:Y.data)||[]),u((se==null?void 0:se.data)||[]),M((Me==null?void 0:Me.data)||[])}catch(Y){console.error("lookups",Y),(j=(l=window.ui)==null?void 0:l.toast)==null||j.call(l,"Failed to load lookups","warning")}})()},[]),s.useEffect(()=>{Ne()},[h.page,h.pageSize,$,F,ne]);async function Ne(){var l,j;R(!0);try{const Y={page:h.page,pageSize:h.pageSize};D&&(Y.search=D),$&&(Y.medium_id=$),F&&(Y.std_id=F),ne&&(Y.book_id=ne);const se=await E.get("/api/courses",{query:Y}),Me=(se==null?void 0:se.data)||[],p=(se==null?void 0:se.pagination)||{page:h.page,pageSize:h.pageSize,total:Me.length};L(Me),w({page:p.page,pageSize:p.pageSize,total:p.total})}catch(Y){console.error("fetch courses",Y),(j=(l=window.ui)==null?void 0:l.toast)==null||j.call(l,"Failed to load courses","danger"),L([]),w(se=>({...se,total:0}))}finally{R(!1)}}function xe(){re(null),de({course_id:null,course_name:"",description:"",price:"",medium_id:"",std_id:"",book_id:"",image:""}),Fe(_t),ie.current=null,Q(!0)}function Re(l){re(l),de({course_id:l.course_id,course_name:l.course_name||"",description:l.description||"",price:l.price??"",medium_id:l.medium_id??"",std_id:l.std_id??"",book_id:l.book_id??"",image:l.image||""}),Fe(yt(l.image)),ie.current=null,Q(!0)}async function _e(l){var j,Y,se,Me;if(confirm("Delete this course?"))try{await E.delete(`/api/courses/${l.course_id}`),(Y=(j=window.ui)==null?void 0:j.toast)==null||Y.call(j,"Course deleted","success"),Ne()}catch(p){console.error("delete course",p),(Me=(se=window.ui)==null?void 0:se.toast)==null||Me.call(se,"Delete failed","danger")}}async function ke(l){var j,Y,se,Me;if(!l)return null;Se(!0);try{const p=new FormData;p.append("file",l);try{const te=await E.post("/api/uploads",p,{headers:{"Content-Type":"multipart/form-data"}}),ge=((j=te==null?void 0:te.data)==null?void 0:j.url)??((Y=te==null?void 0:te.data)==null?void 0:Y.fileUrl)??null;if(ge)return ge}catch{try{const ge=await E.post("/api/courses/upload-image",p,{headers:{"Content-Type":"multipart/form-data"}}),oe=((se=ge==null?void 0:ge.data)==null?void 0:se.url)??((Me=ge==null?void 0:ge.data)==null?void 0:Me.fileUrl)??null;if(oe)return oe}catch(ge){console.warn("upload endpoints failed",ge)}}return await new Promise((te,ge)=>{const oe=new FileReader;oe.onload=()=>te(oe.result),oe.onerror=ge,oe.readAsDataURL(l)})}finally{Se(!1)}}async function Ie(l){if(!l||l.length===0)return;const j=l[0];try{const Y=URL.createObjectURL(j);Fe(Y),ie.current=j}catch(Y){console.warn("file preview error",Y),ie.current=j}}function x(l){de(j=>({...j,image:l})),Fe(yt(l)),ie.current=null}async function H(l){var j,Y,se,Me,p,T,te,ge;if(l&&l.preventDefault&&l.preventDefault(),!O.course_name||!String(O.course_name).trim()){(Y=(j=window.ui)==null?void 0:j.toast)==null||Y.call(j,"Course name required","danger");return}try{let oe=O.image?String(O.image).trim():null;if(ie.current){const Ce=await ke(ie.current);Ce&&(oe=Ce)}const Ee={course_name:String(O.course_name).trim(),description:O.description?String(O.description).trim():null,price:O.price?Number(O.price):null,image:oe||null,medium_id:O.medium_id?Number(O.medium_id):null,std_id:O.std_id?Number(O.std_id):null,book_id:O.book_id?Number(O.book_id):null};pe&&pe.course_id?(await E.put(`/api/courses/${pe.course_id}`,Ee),(Me=(se=window.ui)==null?void 0:se.toast)==null||Me.call(se,"Course updated","success")):(await E.post("/api/courses",Ee),(T=(p=window.ui)==null?void 0:p.toast)==null||T.call(p,"Course created","success")),Q(!1),re(null),ie.current=null,Z&&Z.startsWith("blob:")&&URL.revokeObjectURL(Z),Ne()}catch(oe){console.error("save course",oe),(ge=(te=window.ui)==null?void 0:te.toast)==null||ge.call(te,(oe==null?void 0:oe.message)||"Save failed","danger")}}const fe=[{Header:"Name",accessor:"course_name"},{Header:"Medium",accessor:l=>l.medium_name||"—"},{Header:"Standard",accessor:l=>l.std_name||"—"},{Header:"Book",accessor:l=>l.book_name||"—"},{Header:"Price",accessor:l=>l.price?`₹ ${l.price}`:"—"},{Header:"Image",accessor:l=>e.jsx("img",{src:yt(l.image),alt:l.course_name,style:{height:48,borderRadius:6}})},{Header:"Actions",accessor:l=>e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>Re(l),className:"btn",title:"Edit",children:e.jsx(Ae.Edit,{style:{width:16,height:16}})}),e.jsx("button",{onClick:()=>_e(l),className:"btn",title:"Delete",children:e.jsx(Ae.Delete,{style:{width:16,height:16}})})]})}],je=(l,j,Y)=>[{value:"",label:"— any —"}].concat((l||[]).map(se=>({value:se[j],label:se[Y]})));return e.jsxs("main",{className:"p-6 max-w-6xl mx-auto",style:{fontFamily:"'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto",fontSize:16},children:[e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
          --bg: #f7fbff;
          --card: #ffffff;
          --muted: #556170;
          --accent-2: #0B6EFF;
          --accent: #0ea5a3;
          --glass: rgba(255,255,255,0.6);
          --radius: 12px;
        }

        .page-card {
          background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,252,255,0.98));
          border-radius: 14px;
          padding: 18px;
          box-shadow: 0 14px 40px rgba(11,34,80,0.04);
          border: 1px solid rgba(11,34,80,0.04);
        }

        .controls { display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap; }
        .control { min-width:160px; flex: 1 1 200px; }
        .btn { padding:10px 12px; border-radius:10px; border:1px solid rgba(11,34,80,0.06); background:white; cursor:pointer; font-weight:600; font-size:15px; }
        .btn-primary { background: linear-gradient(90deg, #06b6d4, var(--accent)); color:white; border:none; box-shadow: 0 10px 28px rgba(11,110,255,0.08); }
        .small-muted { color:var(--muted); font-size:13px; }

        .modal-plate { width: 920px; max-width: 96%; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 60px rgba(11,34,80,0.14); }
        .modal-header-bar { display:flex; align-items:center; gap:12px; padding:18px 20px; background: linear-gradient(90deg, #fbfdff, #ffffff); }
        .modal-header-bar img { height:44px; width:auto; display:block; border-radius:8px; }
        .modal-title { flex:1; text-align:center; font-size:18px; font-weight:700; color:#0f172a; }
        .modal-body-grid { display:grid; grid-template-columns: 1fr 360px; gap:18px; padding:18px; background: #fff; }
        .preview-card { border-radius:10px; padding:12px; border:1px solid rgba(11,34,80,0.06); background: linear-gradient(180deg,#ffffff,#fbfdff); display:flex; gap:12px; align-items:center; }
        .modal-footer-bar { display:flex; gap:12px; justify-content:flex-end; padding:14px 18px; background:#fcfeff; border-top: 1px solid rgba(11,34,80,0.03); }

        /* subtle doodles to align with sidebar look */
        .doodle-left { position:absolute; left:-40px; top:-30px; width:160px; height:160px; opacity:0.9; pointer-events:none; filter: blur(0.2px); transform-origin:center; animation: floatL 8s ease-in-out infinite; }
        .doodle-right { position:absolute; right:-40px; bottom:-40px; width:140px; height:140px; opacity:0.9; pointer-events:none; filter: blur(0.2px); transform-origin:center; animation: floatR 9s ease-in-out infinite; }
        @keyframes floatL { 0%{ transform: translateY(0) rotate(-2deg); } 50%{ transform: translateY(6px) rotate(2deg); } 100%{ transform: translateY(0) rotate(-2deg); } }
        @keyframes floatR { 0%{ transform: translateY(0) rotate(2deg); } 50%{ transform: translateY(-6px) rotate(-2deg); } 100%{ transform: translateY(0) rotate(2deg); } }

        /* responsive */
        @media (max-width: 980px) {
          .modal-body-grid { grid-template-columns: 1fr; }
          .preview-card img { display:block; margin: 0 auto; }
        }
      `}),e.jsxs("svg",{className:"doodle-left",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"c1",x1:"0",x2:"1",children:[e.jsx("stop",{offset:"0",stopColor:"#E6F6FF"}),e.jsx("stop",{offset:"1",stopColor:"#F0EBFF"})]})}),e.jsx("path",{fill:"url(#c1)",d:"M43.1,-45.9C56.4,-32.6,67.1,-18.1,67.1,-2.1C67.1,13.9,56.4,29.9,43.1,42.5C29.9,55.1,14.9,64.3,-0.1,64.4C-15.1,64.5,-30.1,55.5,-42.1,43.5C-54,31.5,-63,16.5,-64.5,-0.3C-66,-17.1,-60,-34.3,-47.6,-47.6C-35.2,-60.9,-17.6,-70.3,-0.1,-70.2C17.3,-70.1,34.6,-60.9,43.1,-45.9Z",transform:"translate(100 100)"})]}),e.jsxs("svg",{className:"doodle-right",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"c2",x1:"0",x2:"1",children:[e.jsx("stop",{offset:"0",stopColor:"#FFFBE6"}),e.jsx("stop",{offset:"1",stopColor:"#E8FFF6"})]})}),e.jsx("path",{fill:"url(#c2)",d:"M38.5,-40.3C50.2,-31,60.4,-21.6,64.8,-9.6C69.2,2.4,67.8,17.9,59.8,28.5C51.8,39.1,37.2,44.9,22.4,51.1C7.6,57.3,-8.4,63.8,-22.2,60.6C-36.1,57.4,-47.8,44.5,-57.2,30.6C-66.5,16.6,-73.6,1.6,-70.6,-11.1C-67.7,-23.8,-54.6,-34.2,-40.4,-43C-26.3,-51.7,-13.1,-58.9,-0.3,-58.6C12.6,-58.2,25.2,-50.3,38.5,-40.3Z",transform:"translate(100 100)"})]}),e.jsxs("div",{className:"page-card",style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0},children:"Courses"}),e.jsx("div",{style:{color:"var(--muted)",marginTop:6},children:"Manage course catalog — images, pricing, and mapping to standards/books."})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("button",{className:"btn",onClick:()=>{w(l=>({...l,page:1})),Ne()},title:"Reload",children:"Reload"}),e.jsx(ts,{columns:fe,rows:S,filename:`courses_export_${new Date().toISOString().slice(0,10)}.csv`}),e.jsxs("button",{className:"btn btn-primary",onClick:xe,style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(Ae.Plus,{style:{width:16,height:16}})," New Course"]})]})]}),e.jsxs("div",{style:{marginTop:14},className:"controls",children:[e.jsx("div",{className:"control",children:e.jsx(K,{label:"Search",children:e.jsx(ze,{placeholder:"Search course name...",value:D,onChange:l=>{q(l),w(j=>({...j,page:1}))}})})}),e.jsx("div",{className:"control",style:{maxWidth:240},children:e.jsx(K,{label:"Medium",children:e.jsx(Te,{value:$,onChange:l=>{ae(l),w(j=>({...j,page:1}))},options:je(t,"medium_id","medium_name")})})}),e.jsx("div",{className:"control",style:{maxWidth:240},children:e.jsx(K,{label:"Standard",children:e.jsx(Te,{value:F,onChange:l=>{ce(l),w(j=>({...j,page:1}))},options:je(r,"std_id","std_name")})})}),e.jsx("div",{className:"control",style:{maxWidth:240},children:e.jsx(K,{label:"Book",children:e.jsx(Te,{value:ne,onChange:l=>{J(l),w(j=>({...j,page:1}))},options:je(v,"book_id","book_name")})})}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"flex-end"},children:e.jsx(K,{label:"Rows",children:e.jsx("select",{className:"form-control",value:h.pageSize,onChange:l=>w(j=>({...j,pageSize:Number(l.target.value),page:1})),children:[10,20,50,100].map(l=>e.jsx("option",{value:l,children:l},l))})})})]})]}),e.jsxs("div",{className:"page-card",children:[e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{color:"var(--muted)"},children:S.length?`${(h.page-1)*h.pageSize+1}–${Math.min(h.page*h.pageSize,h.total)} of ${h.total}`:"No courses"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn",disabled:h.page<=1,onClick:()=>w(l=>({...l,page:Math.max(1,l.page-1)})),children:"Prev"}),e.jsx("button",{className:"btn",disabled:h.page*h.pageSize>=h.total,onClick:()=>w(l=>({...l,page:l.page+1})),children:"Next"})]})]}),g?e.jsx("div",{style:{padding:32,textAlign:"center",color:"var(--muted)"},children:"Loading…"}):e.jsx(Bs,{columns:fe,data:S,emptyMessage:"No courses found"})]}),le&&e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(180deg, rgba(2,6,23,0.45), rgba(2,6,23,0.35))",zIndex:9999},onClick:l=>{if(l.target===l.currentTarget&&(Q(!1),re(null),Z&&Z.startsWith("blob:")))try{URL.revokeObjectURL(Z)}catch{}},children:e.jsxs("form",{onSubmit:H,className:"modal-plate",onClick:l=>l.stopPropagation(),onMouseDown:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"modal-header-bar",children:[e.jsx("img",{src:Ms,alt:"Ank Logo",onError:l=>{l.currentTarget.src=Ms}}),e.jsx("div",{className:"modal-title",children:pe?"Edit Course":"Create a New Course"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{Q(!1),re(null)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",title:"Save",children:e.jsxs("span",{style:{display:"inline-flex",gap:8,alignItems:"center"},children:[e.jsx(Ae.Save,{style:{width:16,height:16}})," ",pe?"Save changes":"Create course"]})})]})]}),e.jsxs("div",{className:"modal-body-grid",children:[e.jsx("div",{children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(K,{label:"Course name",required:!0,children:e.jsx(ze,{value:O.course_name,onChange:l=>de(j=>({...j,course_name:l}))})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(K,{label:"Price",children:e.jsx(ze,{type:"number",value:O.price,onChange:l=>de(j=>({...j,price:l}))})}),e.jsx(K,{label:"Book",children:e.jsx(Te,{options:[{value:"",label:"— none —"},...(v||[]).map(l=>({value:l.book_id,label:l.book_name}))],value:O.book_id||"",onChange:l=>de(j=>({...j,book_id:l}))})})]}),e.jsx(K,{label:"Description",children:e.jsx("textarea",{value:O.description,onChange:l=>de(j=>({...j,description:l.target.value})),className:"form-control",rows:4})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(K,{label:"Medium",className:"control",style:{flex:1},children:e.jsx(Te,{options:[{value:"",label:"— none —"},...(t||[]).map(l=>({value:l.medium_id,label:l.medium_name}))],value:O.medium_id||"",onChange:l=>de(j=>({...j,medium_id:l}))})}),e.jsx(K,{label:"Standard",className:"control",style:{flex:1},children:e.jsx(Te,{options:[{value:"",label:"— none —"},...(r||[]).map(l=>({value:l.std_id,label:l.std_name}))],value:O.std_id||"",onChange:l=>de(j=>({...j,std_id:l}))})})]}),e.jsx(K,{label:"Image URL (or use Upload)",help:"If you paste a remote URL it will be used immediately for preview",children:e.jsx(ze,{placeholder:"https://...",value:O.image||"",onChange:l=>x(l)})})]})}),e.jsxs("div",{children:[e.jsx(K,{label:"Upload Image",children:e.jsx(qs,{onChange:l=>Ie(l),accept:"image/*"})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{style:{fontSize:13,color:"#374151",marginBottom:8},children:"Preview"}),e.jsxs("div",{className:"preview-card",children:[e.jsx("img",{src:Z||yt(O.image),alt:"preview",style:{width:140,height:100,objectFit:"cover",borderRadius:8}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:700,color:"#0f172a"},children:O.course_name||"Untitled course"}),e.jsx("div",{className:"small-muted",style:{marginTop:8},children:O.description?String(O.description).slice(0,160)+(String(O.description).length>160?"…":""):"No description yet"}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:8},children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{Fe(_t),ie.current=null,de(l=>({...l,image:""}))},children:"Reset"}),e.jsxs("div",{style:{marginLeft:"auto",textAlign:"right"},children:[e.jsx("div",{className:"small-muted",children:"Status"}),e.jsx("div",{style:{fontWeight:700,color:De?"var(--accent)":"#64748b"},children:De?"Uploading…":pe?"Ready to save":"New"})]})]})]})]}),e.jsx("div",{style:{marginTop:12,fontSize:13},className:"small-muted",children:"Tip: Uploading a file stores it to the server (if upload endpoint available). Otherwise the image will be embedded locally as a data URL for immediate preview."})]})]})]}),e.jsxs("div",{className:"modal-footer-bar",children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{Q(!1),re(null)},children:"Close"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:pe?"Save changes":"Create course"})]})]})})]})}const ut="/images/placeholder.png",Ps="/images/Ank_Logo.png",wt=t=>t&&String(t).trim()?t:ut;function zl(){const[t,a]=s.useState([]),[r,u]=s.useState([]),[v,M]=s.useState([]),[S,L]=s.useState([]),[g,R]=s.useState(!1),[h,w]=s.useState({page:1,pageSize:20,total:0}),[D,q]=s.useState(""),[$,ae]=s.useState(""),[F,ce]=s.useState(""),[ne,J]=s.useState(""),[le,Q]=s.useState(!1),[pe,re]=s.useState(null),[O,de]=s.useState({book_id:null,book_name:"",description:"",price:"",course_id:"",medium_id:"",std_id:"",image:""}),De=s.useRef(null),[Se,Z]=s.useState(ut),[Fe,ie]=s.useState(!1);s.useEffect(()=>{(async()=>{var l,j;try{const[Y,se,Me]=await Promise.all([E.get("/api/courses",{query:{pageSize:1e3}}),E.get("/api/master",{query:{table:"media",pageSize:1e3}}),E.get("/api/master",{query:{table:"standards",pageSize:1e3}})]);a((Y==null?void 0:Y.data)||[]),u((se==null?void 0:se.data)||[]),M((Me==null?void 0:Me.data)||[])}catch(Y){console.error("lookup load",Y),(j=(l=window.ui)==null?void 0:l.toast)==null||j.call(l,"Failed to load lookups","warning")}})()},[]),s.useEffect(()=>{Ne()},[h.page,h.pageSize,$,F,ne]);async function Ne(){var l,j;R(!0);try{const Y={page:h.page,pageSize:h.pageSize};D&&(Y.search=D),$&&(Y.course_id=$),F&&(Y.medium_id=F),ne&&(Y.std_id=ne);const se=await E.get("/api/books",{query:Y}),Me=(se==null?void 0:se.data)||[],p=(se==null?void 0:se.pagination)||{page:h.page,pageSize:h.pageSize,total:Me.length};L(Me),w({page:p.page,pageSize:p.pageSize,total:p.total})}catch(Y){console.error("fetch books",Y),(j=(l=window.ui)==null?void 0:l.toast)==null||j.call(l,"Failed to load books","danger"),L([]),w(se=>({...se,total:0}))}finally{R(!1)}}function xe(){re(null),de({book_id:null,book_name:"",description:"",price:"",course_id:"",medium_id:"",std_id:"",image:""}),De.current=null,Z(ut),Q(!0)}function Re(l){re(l),de({book_id:l.book_id||null,book_name:l.book_name||"",description:l.description||"",price:l.price??"",course_id:l.course_id??"",medium_id:l.medium_id??"",std_id:l.std_id??"",image:l.image||""}),De.current=null,Z(wt(l.image)),Q(!0)}async function _e(l){var j,Y,se,Me;if(confirm("Delete this book?"))try{await E.delete(`/api/books/${l.book_id}`),(Y=(j=window.ui)==null?void 0:j.toast)==null||Y.call(j,"Book deleted","success"),Ne()}catch(p){console.error("delete book",p),(Me=(se=window.ui)==null?void 0:se.toast)==null||Me.call(se,"Delete failed","danger")}}async function ke(l){var j,Y,se,Me;if(!l)return null;ie(!0);try{const p=new FormData;p.append("file",l);try{const T=await E.post("/api/uploads",p,{headers:{"Content-Type":"multipart/form-data"}});return((j=T==null?void 0:T.data)==null?void 0:j.url)??((Y=T==null?void 0:T.data)==null?void 0:Y.fileUrl)??null}catch{try{const te=await E.post("/api/books/upload-image",p,{headers:{"Content-Type":"multipart/form-data"}});return((se=te==null?void 0:te.data)==null?void 0:se.url)??((Me=te==null?void 0:te.data)==null?void 0:Me.fileUrl)??null}catch(te){console.warn("upload endpoints failed, will embed data URL",te)}}return await new Promise((T,te)=>{const ge=new FileReader;ge.onload=()=>T(ge.result),ge.onerror=te,ge.readAsDataURL(l)})}finally{ie(!1)}}function Ie(l){if(!l||!l.length)return;const j=l[0];De.current=j;try{const Y=URL.createObjectURL(j);Z(Y)}catch(Y){console.warn("file preview error",Y),Z(ut)}}function x(l){de(j=>({...j,image:l})),Z(wt(l)),De.current=null}async function H(l){var j,Y,se,Me,p,T,te,ge;if(l&&l.preventDefault&&l.preventDefault(),!O.book_name||!String(O.book_name).trim()){(Y=(j=window.ui)==null?void 0:j.toast)==null||Y.call(j,"Book name required","danger");return}try{let oe=O.image?String(O.image).trim():null;if(De.current){const Ce=await ke(De.current);Ce&&(oe=Ce)}const Ee={book_name:String(O.book_name).trim(),description:O.description?String(O.description).trim():null,price:O.price?Number(O.price):null,image:oe||null,course_id:O.course_id?Number(O.course_id):null,medium_id:O.medium_id?Number(O.medium_id):null,std_id:O.std_id?Number(O.std_id):null};if(pe&&pe.book_id?(await E.put(`/api/books/${pe.book_id}`,Ee),(Me=(se=window.ui)==null?void 0:se.toast)==null||Me.call(se,"Book updated","success")):(await E.post("/api/books",Ee),(T=(p=window.ui)==null?void 0:p.toast)==null||T.call(p,"Book created","success")),Q(!1),re(null),Se&&Se.startsWith("blob:"))try{URL.revokeObjectURL(Se)}catch{}De.current=null,Ne()}catch(oe){console.error("save book",oe),(ge=(te=window.ui)==null?void 0:te.toast)==null||ge.call(te,(oe==null?void 0:oe.message)||"Save failed","danger")}}const fe=[{Header:"Name",accessor:"book_name"},{Header:"Course",accessor:l=>l.course_name||"—"},{Header:"Medium",accessor:l=>l.medium_name||"—"},{Header:"Standard",accessor:l=>l.std_name||"—"},{Header:"Price",accessor:l=>l.price?`₹ ${l.price}`:"—"},{Header:"Image",accessor:l=>e.jsx("img",{src:wt(l.image),alt:l.book_name,style:{height:48,borderRadius:6}})},{Header:"Actions",accessor:l=>e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>Re(l),className:"btn",title:"Edit",children:e.jsx(Ae.Edit,{style:{width:16,height:16}})}),e.jsx("button",{onClick:()=>_e(l),className:"btn",title:"Delete",children:e.jsx(Ae.Delete,{style:{width:16,height:16}})})]})}],je=(l,j,Y)=>[{value:"",label:"— any —"}].concat((l||[]).map(se=>({value:se[j],label:se[Y]})));return e.jsxs("main",{className:"p-6 max-w-6xl mx-auto",style:{fontFamily:"'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto",fontSize:16},children:[e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root{
          --sidebar-bg: #f3f7ff;
          --card-bg: #ffffff;
          --muted: #56607a;
          --accent-2: #0B6EFF;
          --accent: #0ea5a3;
          --radius:12px;
        }

        /* Page layout matching sidebar professional look */
        .page-card { background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,252,255,0.98)); border-radius: 14px; padding: 18px; box-shadow: 0 14px 40px rgba(11,34,80,0.04); border: 1px solid rgba(11,34,80,0.04); }
        h2 { font-size: 20px; margin: 0; font-weight: 700; color:#0f172a; }
        .controls { display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap; }
        .control { min-width:160px; flex: 1 1 200px; }
        .btn { padding:10px 12px; border-radius:10px; border:1px solid rgba(11,34,80,0.06); background:white; cursor:pointer; font-weight:600; font-size:15px; }
        .btn-primary { background: linear-gradient(90deg, #06b6d4, var(--accent)); color:white; border:none; box-shadow: 0 10px 28px rgba(11,110,255,0.08); }
        .small-muted { color: var(--muted); font-size:13px; }

        .modal-plate { width: 920px; max-width: 96%; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 60px rgba(11,34,80,0.14); }
        .modal-header-bar { display:flex; align-items:center; gap:12px; padding:18px 20px; background: linear-gradient(90deg, #fbfdff, #ffffff); }
        .modal-header-bar img { height:44px; width:auto; display:block; border-radius:8px; }
        .modal-title { flex:1; text-align:center; font-size:18px; font-weight:700; color:#0f172a; }
        .modal-body-grid { display:grid; grid-template-columns: 1fr 360px; gap:18px; padding:18px; background: #fff; }
        .preview-card { border-radius:10px; padding:12px; border:1px solid rgba(11,34,80,0.06); background: linear-gradient(180deg,#ffffff,#fbfdff); display:flex; gap:12px; align-items:center; }
        .modal-footer-bar { display:flex; gap:12px; justify-content:flex-end; padding:14px 18px; background:#fcfeff; border-top: 1px solid rgba(11,34,80,0.03); }

        /* light sidebar-like background and subtle doodles to visually match sidebar */
        .page-shell { background: linear-gradient(180deg, #f6f9ff 0%, #ffffff 60%); padding: 10px; border-radius: 16px; position: relative; overflow: visible; }

        .doodle-left { position:absolute; left:-40px; top:-40px; width:160px; height:160px; opacity:0.9; pointer-events:none; transform-origin:center; animation: floatL 8s ease-in-out infinite; }
        .doodle-right { position:absolute; right:-40px; bottom:-40px; width:140px; height:140px; opacity:0.9; pointer-events:none; transform-origin:center; animation: floatR 9s ease-in-out infinite; }
        @keyframes floatL { 0%{ transform: translateY(0) rotate(-2deg); } 50%{ transform: translateY(6px) rotate(2deg); } 100%{ transform: translateY(0) rotate(-2deg); } }
        @keyframes floatR { 0%{ transform: translateY(0) rotate(2deg); } 50%{ transform: translateY(-6px) rotate(-2deg); } 100%{ transform: translateY(0) rotate(2deg); } }

        /* responsive */
        @media (max-width: 980px) {
          .modal-body-grid { grid-template-columns: 1fr; }
          .preview-card img { display:block; margin: 0 auto; }
        }
      `}),e.jsxs("svg",{className:"doodle-left",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"g1",x1:"0",x2:"1",children:[e.jsx("stop",{offset:"0",stopColor:"#E6F6FF"}),e.jsx("stop",{offset:"1",stopColor:"#F0EBFF"})]})}),e.jsx("path",{fill:"url(#g1)",d:"M43.1,-45.9C56.4,-32.6,67.1,-18.1,67.1,-2.1C67.1,13.9,56.4,29.9,43.1,42.5C29.9,55.1,14.9,64.3,-0.1,64.4C-15.1,64.5,-30.1,55.5,-42.1,43.5C-54,31.5,-63,16.5,-64.5,-0.3C-66,-17.1,-60,-34.3,-47.6,-47.6C-35.2,-60.9,-17.6,-70.3,-0.1,-70.2C17.3,-70.1,34.6,-60.9,43.1,-45.9Z",transform:"translate(100 100)"})]}),e.jsxs("svg",{className:"doodle-right",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"g2",x1:"0",x2:"1",children:[e.jsx("stop",{offset:"0",stopColor:"#FFFBE6"}),e.jsx("stop",{offset:"1",stopColor:"#E8FFF6"})]})}),e.jsx("path",{fill:"url(#g2)",d:"M38.5,-40.3C50.2,-31,60.4,-21.6,64.8,-9.6C69.2,2.4,67.8,17.9,59.8,28.5C51.8,39.1,37.2,44.9,22.4,51.1C7.6,57.3,-8.4,63.8,-22.2,60.6C-36.1,57.4,-47.8,44.5,-57.2,30.6C-66.5,16.6,-73.6,1.6,-70.6,-11.1C-67.7,-23.8,-54.6,-34.2,-40.4,-43C-26.3,-51.7,-13.1,-58.9,-0.3,-58.6C12.6,-58.2,25.2,-50.3,38.5,-40.3Z",transform:"translate(100 100)"})]}),e.jsxs("div",{className:"page-shell",children:[e.jsxs("div",{className:"page-card",style:{marginBottom:14},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Books"}),e.jsx("div",{style:{color:"var(--muted)",marginTop:6},children:"Manage books — link to courses, mediums and standards, upload images."})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("button",{className:"btn",onClick:()=>{w(l=>({...l,page:1})),Ne()},title:"Reload",children:"Reload"}),e.jsx(ts,{columns:fe,rows:S,filename:`books_export_${new Date().toISOString().slice(0,10)}.csv`}),e.jsxs("button",{className:"btn btn-primary",onClick:xe,style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(Ae.Plus,{style:{width:16,height:16}})," New Book"]})]})]}),e.jsxs("div",{style:{marginTop:14},className:"controls",children:[e.jsx("div",{className:"control",children:e.jsx(K,{label:"Search",children:e.jsx(ze,{placeholder:"Search book name...",value:D,onChange:l=>{q(l),w(j=>({...j,page:1}))}})})}),e.jsx("div",{className:"control",style:{maxWidth:240},children:e.jsx(K,{label:"Course",children:e.jsx(Te,{value:$,onChange:l=>{ae(l),w(j=>({...j,page:1}))},options:je(t,"course_id","course_name")})})}),e.jsx("div",{className:"control",style:{maxWidth:240},children:e.jsx(K,{label:"Medium",children:e.jsx(Te,{value:F,onChange:l=>{ce(l),w(j=>({...j,page:1}))},options:je(r,"medium_id","medium_name")})})}),e.jsx("div",{className:"control",style:{maxWidth:240},children:e.jsx(K,{label:"Standard",children:e.jsx(Te,{value:ne,onChange:l=>{J(l),w(j=>({...j,page:1}))},options:je(v,"std_id","std_name")})})}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"flex-end"},children:e.jsx(K,{label:"Rows",children:e.jsx("select",{className:"form-control",value:h.pageSize,onChange:l=>w(j=>({...j,pageSize:Number(l.target.value),page:1})),children:[10,20,50,100].map(l=>e.jsx("option",{value:l,children:l},l))})})})]})]}),e.jsxs("div",{className:"page-card",children:[e.jsxs("div",{style:{marginBottom:12,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{style:{color:"var(--muted)"},children:S.length?`${(h.page-1)*h.pageSize+1}–${Math.min(h.page*h.pageSize,h.total)} of ${h.total}`:"No books"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn",disabled:h.page<=1,onClick:()=>w(l=>({...l,page:Math.max(1,l.page-1)})),children:"Prev"}),e.jsx("button",{className:"btn",disabled:h.page*h.pageSize>=h.total,onClick:()=>w(l=>({...l,page:l.page+1})),children:"Next"})]})]}),g?e.jsx("div",{style:{padding:32,textAlign:"center",color:"var(--muted)"},children:"Loading…"}):e.jsx(Bs,{columns:fe,data:S,emptyMessage:"No books found"})]})]}),le&&e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(180deg, rgba(2,6,23,0.45), rgba(2,6,23,0.35))",zIndex:9999},onClick:l=>{if(l.target===l.currentTarget&&(Q(!1),re(null),Se&&Se.startsWith("blob:")))try{URL.revokeObjectURL(Se)}catch{}},children:e.jsxs("form",{onSubmit:H,className:"modal-plate",onClick:l=>l.stopPropagation(),onMouseDown:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"modal-header-bar",children:[e.jsx("img",{src:Ps,alt:"Ank Logo",onError:l=>{l.currentTarget.src=Ps}}),e.jsx("div",{className:"modal-title",children:pe?"Edit Book":"Create a New Book"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{Q(!1),re(null)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",title:"Save",children:e.jsxs("span",{style:{display:"inline-flex",gap:8,alignItems:"center"},children:[e.jsx(Ae.Save,{style:{width:16,height:16}})," ",pe?"Save changes":"Create book"]})})]})]}),e.jsxs("div",{className:"modal-body-grid",children:[e.jsx("div",{children:e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx(K,{label:"Book name",required:!0,children:e.jsx(ze,{value:O.book_name,onChange:l=>de(j=>({...j,book_name:l}))})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:[e.jsx(K,{label:"Price",children:e.jsx(ze,{type:"number",value:O.price,onChange:l=>de(j=>({...j,price:l}))})}),e.jsx(K,{label:"Course",children:e.jsx(Te,{options:[{value:"",label:"— none —"},...(t||[]).map(l=>({value:l.course_id,label:l.course_name}))],value:O.course_id||"",onChange:l=>de(j=>({...j,course_id:l}))})})]}),e.jsx(K,{label:"Description",children:e.jsx("textarea",{value:O.description,onChange:l=>de(j=>({...j,description:l.target.value})),className:"form-control",rows:4})}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx(K,{label:"Medium",className:"control",style:{flex:1},children:e.jsx(Te,{options:[{value:"",label:"— none —"},...(r||[]).map(l=>({value:l.medium_id,label:l.medium_name}))],value:O.medium_id||"",onChange:l=>de(j=>({...j,medium_id:l}))})}),e.jsx(K,{label:"Standard",className:"control",style:{flex:1},children:e.jsx(Te,{options:[{value:"",label:"— none —"},...(v||[]).map(l=>({value:l.std_id,label:l.std_name}))],value:O.std_id||"",onChange:l=>de(j=>({...j,std_id:l}))})})]}),e.jsx(K,{label:"Image URL (or use Upload)",help:"Paste a remote URL to preview immediately",children:e.jsx(ze,{placeholder:"https://...",value:O.image||"",onChange:l=>x(l)})})]})}),e.jsxs("div",{children:[e.jsx(K,{label:"Upload Image",children:e.jsx("div",{onClick:l=>l.stopPropagation(),onMouseDown:l=>l.stopPropagation(),onFocus:l=>l.stopPropagation(),style:{display:"block"},children:e.jsx(qs,{accept:"image/*",onChange:Ie})})}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{style:{fontSize:13,color:"#374151",marginBottom:6},children:"Preview"}),e.jsxs("div",{className:"preview-card",children:[e.jsx("img",{src:Se||wt(O.image),alt:"preview",style:{width:140,height:100,objectFit:"cover",borderRadius:8}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:700,color:"#0f172a"},children:O.book_name||"Untitled book"}),e.jsx("div",{className:"small-muted",style:{marginTop:6},children:O.description?String(O.description).slice(0,160)+(String(O.description).length>160?"…":""):"No description yet"}),e.jsxs("div",{style:{marginTop:10,display:"flex",gap:8},children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{if(Se&&Se.startsWith("blob:"))try{URL.revokeObjectURL(Se)}catch{}Z(ut),De.current=null,de(l=>({...l,image:""}))},children:"Reset"}),e.jsxs("div",{style:{marginLeft:"auto",textAlign:"right"},children:[e.jsx("div",{className:"small-muted",children:"Status"}),e.jsx("div",{style:{fontWeight:700,color:Fe?"#0ea5a4":"#64748b"},children:Fe?"Uploading…":pe?"Ready to save":"New"})]})]})]})]}),e.jsx("div",{style:{marginTop:12,fontSize:13},className:"small-muted",children:"Tip: Uploaded image will be persisted to the server when upload endpoint exists; otherwise a local data-URL will be used for immediate preview."})]})]})]}),e.jsxs("div",{className:"modal-footer-bar",children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{if(Q(!1),re(null),Se&&Se.startsWith("blob:"))try{URL.revokeObjectURL(Se)}catch{}},children:"Close"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:pe?"Save changes":"Create book"})]})]})})]})}const Ls="/images/Ank_Logo.png",Ge="/images/placeholder.png",Al=!0;function Vs(t=""){return/\.(mp4|webm|ogg)(\?.*)?$/i.test(t)}function Ws(t=""){return/youtu\.be\/|youtube\.com\/(watch|embed)/i.test(t)}function Gs(t=""){return/vimeo\.com\/(video\/)?\d+/i.test(t)}function Ks(t=""){return/drive\.google\.com/i.test(t)}function Ol(t=""){try{const a=new URL(t);if(a.hostname.includes("youtu.be"))return a.pathname.slice(1);const r=a.searchParams.get("v");if(r)return r;const u=t.match(/embed\/(.+?)(\?|$)/);return u?u[1]:null}catch{return null}}function Ys(t=""){const a=Ol(t);return a?`https://img.youtube.com/vi/${a}/hqdefault.jpg`:null}async function $l(t=""){try{const a=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(t)}`,r=await fetch(a);if(!r.ok)throw new Error("vimeo oembed failed");const u=await r.json();return(u==null?void 0:u.thumbnail_url)||null}catch(a){return console.warn("vimeo thumbnail error",a),null}}function Ul(t=""){const a=t.match(/\/file\/d\/([^/]+)\//);return a?`https://drive.google.com/thumbnail?id=${a[1]}`:null}async function ql(t=""){return new Promise(a=>{try{const r=document.createElement("video");let u=!1;r.crossOrigin="anonymous",r.preload="metadata",r.muted=!0,r.src=t;const v=()=>{try{r.pause()}catch{}try{r.removeAttribute("src")}catch{}try{r.load&&r.load()}catch{}},M=()=>{u||(u=!0,v(),a(null))};r.addEventListener("error",M),r.addEventListener("loadedmetadata",()=>{const S=Math.min(1,Math.floor(r.duration/2)||0),L=()=>{try{const R=document.createElement("canvas");R.width=r.videoWidth||640,R.height=r.videoHeight||360,R.getContext("2d").drawImage(r,0,0,R.width,R.height);const w=R.toDataURL("image/jpeg");u||(u=!0,v(),a(w))}catch{u||(u=!0,v(),a(null))}},g=setTimeout(()=>{r.removeEventListener("seeked",L),u||(u=!0,v(),a(null))},4e3);r.addEventListener("seeked",function R(){clearTimeout(g),L(),r.removeEventListener("seeked",R)});try{r.currentTime=S}catch{L()}}),setTimeout(()=>{u||(u=!0,v(),a(null))},7e3)}catch{a(null)}})}async function mt(t=""){if(!t)return null;try{return Ws(t)?Ys(t):Gs(t)?await $l(t):Ks(t)?Ul(t):Vs(t)?await ql(t):null}catch(a){return console.warn("deriveThumbnail",a),null}}function Bl(){const[t,a]=s.useState([]),[r,u]=s.useState([]),[v,M]=s.useState([]),[S,L]=s.useState([]),[g,R]=s.useState(!1),[h,w]=s.useState({page:1,pageSize:24,total:0}),[D,q]=s.useState(""),$=s.useRef(""),ae=s.useRef(null),[F,ce]=s.useState(""),[ne,J]=s.useState(""),[le,Q]=s.useState(""),[pe,re]=s.useState(!1),[O,de]=s.useState(!1),[De,Se]=s.useState(""),[Z,Fe]=s.useState("Video"),[ie,Ne]=s.useState(null),[xe,Re]=s.useState({video_id:null,tittle:"",title:"",video_link:"",description:"",course_id:"",book_id:"",chapter_id:""}),[_e,ke]=s.useState(Ge),Ie=s.useRef(!1),x=s.useRef(!1),[H,fe]=s.useState(!1),[je,l]=s.useState(!1),[j,Y]=s.useState(""),[se,Me]=s.useState([]),p=s.useRef(null);s.useEffect(()=>(Ie.current=!0,(async()=>{var i,N;try{const I=async()=>{const[X,k,me]=await Promise.all([E.get("/api/courses",{query:{pageSize:1e3}}),E.get("/api/books",{query:{pageSize:1e3}}),E.get("/api/chapters",{query:{pageSize:1e3}})]);return[(X==null?void 0:X.data)||[],(k==null?void 0:k.data)||[],(me==null?void 0:me.data)||[]]},[m,f,G]=await I();if(!Ie.current)return;a(m),u(f),M(G),x.current=!1,fe(!1)}catch(I){console.error("lookups",I),x.current=!0,fe(!0),(N=(i=window.ui)==null?void 0:i.toast)==null||N.call(i,"Failed to load lookup lists — backend may be busy","warning")}})(),()=>{Ie.current=!1}),[]),s.useEffect(()=>($.current=D,ae.current&&clearTimeout(ae.current),ae.current=setTimeout(()=>{w(i=>({...i,page:1})),T({page:1,pageSize:h.pageSize,search:$.current,courseId:F,bookId:ne,chapterId:le})},350),()=>{ae.current&&clearTimeout(ae.current)}),[D]),s.useEffect(()=>{T({page:h.page,pageSize:h.pageSize,search:$.current,courseId:F,bookId:ne,chapterId:le})},[h.page,h.pageSize,F,ne,le]);async function T({page:i=1,pageSize:N=24,search:I="",courseId:m="",bookId:f="",chapterId:G=""}={}){var X,k;R(!0);try{const me={page:i,pageSize:N};I&&(me.search=I),m&&(me.course_id=m),f&&(me.book_id=f),G&&(me.chapter_id=G);const ue=await E.get("/api/videos",{query:me}),ye=(ue==null?void 0:ue.data)||[],Le=(ue==null?void 0:ue.pagination)||{page:i,pageSize:N,total:ye.length},be=ye.map(we=>{const Pe=we.tittle||we.title||"",Oe=we.thumbnail||(we.video_link?Ys(we.video_link):null);return{...we,displayTitle:Pe,tittle:we.tittle||we.title||"",title:we.title||we.tittle||"",thumbnail:Oe,_deriving:!1}});if(!Ie.current)return;L(be),w({page:Le.page,pageSize:Le.pageSize,total:Le.total}),(async()=>{const we=be.slice();for(const Pe of we)if(!(Pe.thumbnail||!Pe.video_link)){L(Oe=>Oe.map(n=>n.video_id===Pe.video_id?{...n,_deriving:!0}:n));try{const Oe=await mt(Pe.video_link||"");if(Oe){if(L(n=>n.map(c=>c.video_id===Pe.video_id?{...c,thumbnail:Oe,_deriving:!1}:c)),Al)try{await E.put(`/api/videos/${Pe.video_id}`,{thumbnail:Oe,tittle:Pe.tittle||Pe.title,title:Pe.tittle||Pe.title})}catch(n){console.warn("auto-save thumbnail failed",n)}}else L(n=>n.map(c=>c.video_id===Pe.video_id?{...c,_deriving:!1}:c))}catch(Oe){console.warn("derive thumbnail for row failed",Oe),L(n=>n.map(c=>c.video_id===Pe.video_id?{...c,_deriving:!1}:c))}}})()}catch(me){console.error("fetch videos",me),Ie.current&&((k=(X=window.ui)==null?void 0:X.toast)==null||k.call(X,"Failed to load videos — backend may be busy","danger"),L([]),w(ue=>({...ue,total:0})))}finally{Ie.current&&R(!1)}}function te(i=null){Ne(i),i?(Re({video_id:i.video_id||null,tittle:i.tittle||i.title||"",title:i.title||i.tittle||"",video_link:i.video_link||"",description:i.description||"",course_id:i.course_id||"",book_id:i.book_id||"",chapter_id:i.chapter_id||""}),(async()=>{if(i.thumbnail)ke(i.thumbnail);else{ke(Ge);const N=await mt(i.video_link||"");ke(N||Ge)}})()):(Re({video_id:null,tittle:"",title:"",video_link:"",description:"",course_id:"",book_id:"",chapter_id:""}),ke(Ge)),re(!0)}function ge(i){const N=i.video_link||"";Fe(i.tittle||i.title||"Video"),Se(B(N,i.tittle||i.title||"Video")),de(!0)}async function oe(i){var N,I,m,f;if(confirm("Delete this video?"))try{await E.del(`/api/videos/${i.video_id}`),(I=(N=window.ui)==null?void 0:N.toast)==null||I.call(N,"Video deleted","success"),T({page:h.page,pageSize:h.pageSize,search:$.current,courseId:F,bookId:ne,chapterId:le})}catch(G){console.error("delete",G),(f=(m=window.ui)==null?void 0:m.toast)==null||f.call(m,"Delete failed","danger")}}async function Ee(i){var I,m,f,G,X,k,me,ue,ye,Le;i&&i.preventDefault&&i.preventDefault();const N=(xe.tittle||xe.title||"").trim();if(!N){(m=(I=window.ui)==null?void 0:I.toast)==null||m.call(I,"Title required","danger");return}try{let be=null;try{be=await mt(xe.video_link||"")}catch{be=null}const we={tittle:N,title:N,video_link:(xe.video_link||"").trim()||null,description:(xe.description||"").trim()||null,course_id:xe.course_id?Number(xe.course_id):null,book_id:xe.book_id?Number(xe.book_id):null,chapter_id:xe.chapter_id?Number(xe.chapter_id):null,thumbnail:be||null};ie&&ie.video_id?(await E.put(`/api/videos/${ie.video_id}`,we),(G=(f=window.ui)==null?void 0:f.toast)==null||G.call(f,"Video updated","success")):(await E.post("/api/videos",we),(k=(X=window.ui)==null?void 0:X.toast)==null||k.call(X,"Video created","success")),re(!1),Ne(null),T({page:1,pageSize:h.pageSize,search:$.current,courseId:F,bookId:ne,chapterId:le})}catch(be){console.error("save video",be);const we=((ue=(me=be==null?void 0:be.response)==null?void 0:me.data)==null?void 0:ue.message)||(be==null?void 0:be.message)||"Save failed";(Le=(ye=window.ui)==null?void 0:ye.toast)==null||Le.call(ye,we,"danger")}}function Ce(i){var I,m;if((m=(I=i==null?void 0:i.currentTarget)==null?void 0:I.dataset)!=null&&m.fallback)return;const N=Ge;i!=null&&i.currentTarget&&(i.currentTarget.dataset.fallback="1",i.currentTarget.src=N)}function z(i){return i?new Date(i).toLocaleString():"-"}const W=(r||[]).filter(i=>!F||String(i.course_id)===String(F)),V=(v||[]).filter(i=>!ne||String(i.book_id)===String(ne));s.useEffect(()=>{let i=!0;const N=setTimeout(async()=>{if(!xe.video_link){ke(Ge);return}ke(Ge);const I=await mt(xe.video_link||"");i&&ke(I||Ge)},300);return()=>{i=!1,clearTimeout(N)}},[xe.video_link]);function o(i){const N=i.split(/\r?\n/).filter(Boolean);if(!N.length)return[];const I=b(N[0]).map(f=>f.toLowerCase()),m=[];for(let f=1;f<Math.min(N.length,6);f++){const G=b(N[f]),X={};for(let k=0;k<I.length;k++)X[I[k]]=G[k]!==void 0?G[k]:"";m.push(X)}return m}function b(i){const N=[];let I="",m=!1;for(let f=0;f<i.length;f++){const G=i[f];if(G==='"'){if(m&&i[f+1]==='"'){I+='"',f++;continue}m=!m;continue}if(!m&&G===","){N.push(I),I="";continue}I+=G}return N.push(I),N.map(f=>f.trim())}async function P(i){var I,m;if(!i||!i.length)return;const N=i[0];try{const f=await N.text();Y(f),Me(o(f))}catch(f){console.error("read csv",f),(m=(I=window.ui)==null?void 0:I.toast)==null||m.call(I,"Failed to read file","danger")}}async function ee(){var N,I,m,f,G,X,k,me;const i=(j||"").trim();if(!i){(I=(N=window.ui)==null?void 0:N.toast)==null||I.call(N,"CSV content required","danger");return}try{await E.post("/api/videos/import",{csv:i}),(f=(m=window.ui)==null?void 0:m.toast)==null||f.call(m,"CSV imported successfully","success"),l(!1),Y(""),Me([]),T({page:1,pageSize:h.pageSize,search:$.current,courseId:F,bookId:ne,chapterId:le})}catch(ue){console.error("import csv",ue);const ye=((X=(G=ue==null?void 0:ue.response)==null?void 0:G.data)==null?void 0:X.message)||(ue==null?void 0:ue.message)||"Import failed";(me=(k=window.ui)==null?void 0:k.toast)==null||me.call(k,ye,"danger")}}function d(i=""){try{const N=new URL(i);if(N.hostname.includes("youtu.be"))return`https://www.youtube.com/embed/${N.pathname.slice(1)}`;const I=N.searchParams.get("v");return I?`https://www.youtube.com/embed/${I}`:i.replace("/watch?v=","/embed/")}catch{return i}}function y(i=""){const N=i.match(/vimeo\.com\/(?:video\/)?(\d+)/i);return N?`https://player.vimeo.com/video/${N[1]}`:i}function C(i=""){const N=i.match(/\/file\/d\/([^/]+)\//);return N?`https://drive.google.com/file/d/${N[1]}/preview`:i}function B(i="",N=""){if(!i)return'<div class="p-4 text-muted">No video link</div>';if(Vs(i))return`
      <video controls playsinline preload="metadata" style="width:100%;max-height:70vh;border-radius:8px;background:#000">
        <source src="${i}">
        Your browser does not support the video tag.
      </video>`;let I=i;return Ws(i)?I=d(i):Gs(i)?I=y(i):Ks(i)&&(I=C(i)),`
    <div style="position:relative;padding-top:56.25%">
      <iframe src="${I}" title="${(N||"Video").replace(/"/g,"")}" style="position:absolute;left:0;top:0;width:100%;height:100%;border:0;border-radius:8px;" allow="accelerometer; autoplay; encrypted-media; picture-in-picture; fullscreen" allowFullScreen></iframe>
    </div>`}return e.jsxs("main",{className:"p-6 max-w-6xl mx-auto",style:{fontFamily:"'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto",fontSize:16},children:[e.jsx("style",{children:`
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root{
          --bg:#f5f8ff;
          --card:#ffffff;
          --muted:#56607a;
          --accent:#0ea5a3;
          --accent-2:#0B6EFF; /* corporate blue */
          --glass: rgba(255,255,255,0.6);
          --radius:14px;
        }

        body, input, select, textarea, button { font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }

        .panel {
          background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,252,255,0.98));
          border-radius: 16px;
          padding: 18px;
          box-shadow: 0 14px 40px rgba(11,34,80,0.06);
          border: 1px solid rgba(11,34,80,0.04);
          transition: transform .18s ease, box-shadow .18s ease;
        }
        .panel:hover { transform: translateY(-3px); box-shadow: 0 22px 56px rgba(11,34,80,0.08); }

        .controls { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
        .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:18px; }

        .card {
          border-radius: 12px;
          overflow: hidden;
          border: 1px solid rgba(11,34,80,0.06);
          background: var(--card);
          display:flex;
          flex-direction:column;
          transition: transform .18s cubic-bezier(.2,.8,.2,1), box-shadow .18s ease;
        }
        .card:hover { transform: translateY(-8px) scale(1.01); box-shadow: 0 26px 60px rgba(11,34,80,0.08); }

        .thumb-wrap { position: relative; display:block; }
        .thumb {
          width:100%;
          height:170px;
          object-fit:cover;
          background: linear-gradient(180deg,#eef2ff,#f8fafc);
          display:block;
          transition: transform .18s ease;
        }
        .thumb-wrap:hover .thumb { transform: scale(1.02); }

        .thumb-play {
          position: absolute;
          left: 50%;
          top: 50%;
          transform: translate(-50%, -50%) scale(0.98);
          width: 64px;
          height: 64px;
          border-radius: 999px;
          display:flex;
          align-items:center;
          justify-content:center;
          background: linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.9));
          box-shadow: 0 12px 28px rgba(11,110,255,0.10);
          opacity: 0;
          transition: opacity .18s ease, transform .18s ease;
          border: 2px solid rgba(11,110,255,0.12);
        }
        .thumb-wrap:hover .thumb-play { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .thumb-play svg { width:22px; height:22px; fill: var(--accent-2); }

        .skel {
          width: 100%;
          height: 170px;
          border-radius: 6px;
          background: linear-gradient(90deg, #f3f4f6 25%, #eef2ff 50%, #f3f4f6 75%);
          background-size: 200% 100%;
          animation: skelShimmer 1.4s linear infinite;
        }
        @keyframes skelShimmer { 0%{ background-position:200% 0 } 100%{ background-position:-200% 0 } }

        .card-body { padding:14px; display:flex; flex-direction:column; gap:10px; }
        .muted { color:var(--muted); font-size:14px; }
        h2 { font-size:20px; margin:0; color:#0f172a; letter-spacing:0.2px; }

        .form-control, .form-select, input[type=text], textarea { font-size:15px; padding:10px 12px; border-radius:10px; }
        .btn { padding:10px 12px; border-radius:10px; font-weight:600; font-size:15px; transition: transform .12s ease, box-shadow .12s ease; cursor:pointer; }
        .btn:active { transform: translateY(1px); }
        .btn-primary { background: var(--accent-2); color: white; border:none; box-shadow: 0 10px 28px rgba(11,110,255,0.12); }
        .btn-primary:hover { filter: saturate(1.05); box-shadow: 0 14px 36px rgba(11,110,255,0.14); }
        .btn-outline { background: transparent; border:1px solid rgba(11,34,80,0.06); }

        .btn-sm { padding:8px 10px; border-radius:8px; }
        .editor-header { display:flex; align-items:center; gap:12px; padding:18px; border-bottom:1px solid rgba(11,34,80,0.04); }
        .editor-title { flex:1; text-align:center; font-weight:700; font-size:18px; }

        .modal-backdrop{ position:fixed; inset:0; z-index:9999; background:linear-gradient(0deg, rgba(2,6,23,0.55), rgba(2,6,23,0.45)); display:flex; align-items:center; justify-content:center; }
        .modal-card { width:980px; max-width:96%; border-radius:12px; overflow:hidden; background:linear-gradient(180deg,#fff,#fbfdff); box-shadow: 0 28px 80px rgba(11,34,80,0.18); transform: translateY(8px); animation: modalIn .22s cubic-bezier(.2,.9,.2,1) both; }
        @keyframes modalIn { from { opacity: 0; transform: translateY(28px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 900px) {
          .grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:12px; }
          .thumb { height: 150px; }
          .card-body { padding:12px; }
        }
      `}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsx("img",{src:Ls,alt:"logo",style:{height:36},onError:Ce}),e.jsx("div",{style:{fontWeight:700,fontSize:20},children:"Videos — Gallery"})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>l(!0),children:[e.jsx(Ae.UploadCloud,{style:{width:16,height:16,marginRight:8}}),"Import CSV"]}),e.jsx(ts,{columns:[{Header:"Title",accessor:"tittle"},{Header:"Course",accessor:"course_name"},{Header:"Book",accessor:"book_name"}],rows:S,filename:`videos_${new Date().toISOString().slice(0,10)}.csv`}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>te(null),style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(Ae.Plus,{style:{width:16,height:16}})," New Video"]})]})]}),e.jsxs("div",{className:"panel",style:{marginBottom:18},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--muted)",marginTop:2},children:"Click a card to play inline. Create and manage videos with thumbnails and metadata."}),H&&e.jsx("div",{style:{marginTop:8,color:"#b45309"},className:"small",children:"Lookup data failed to load — selectors may be empty."})]}),e.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[e.jsx("div",{style:{width:220},children:e.jsx(Te,{value:F,onChange:i=>{ce(i),J(""),Q(""),w(N=>({...N,page:1}))},options:[{value:"",label:"— any course —"}].concat((t||[]).map(i=>({value:i.course_id,label:i.course_name})))})}),e.jsx("div",{style:{width:220},children:e.jsx(Te,{value:ne,onChange:i=>{J(i),Q(""),w(N=>({...N,page:1}))},options:[{value:"",label:"— any book —"}].concat(W.map(i=>({value:i.book_id,label:i.book_name})))})}),e.jsx("div",{style:{width:220},children:e.jsx(Te,{value:le,onChange:i=>{Q(i),w(N=>({...N,page:1}))},options:[{value:"",label:"— any chapter —"}].concat(V.map(i=>({value:i.chapter_id,label:i.chapter_name})))})})]})]}),e.jsxs("div",{style:{marginTop:14},className:"controls",children:[e.jsx("div",{style:{flex:"1 1 360px"},children:e.jsx(ze,{placeholder:"Search title or description...",value:D,onChange:i=>{q(i)}})}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:[e.jsx("select",{value:h.pageSize,onChange:i=>w(N=>({...N,pageSize:Number(i.target.value),page:1})),className:"form-select",children:[12,24,48].map(i=>e.jsx("option",{value:i,children:i},i))}),e.jsx("button",{className:"btn btn-outline",onClick:()=>T({page:1,pageSize:h.pageSize,search:$.current,courseId:F,bookId:ne,chapterId:le}),children:"Reload"})]})]})]}),e.jsxs("div",{style:{marginTop:14},children:[g?e.jsx("div",{style:{padding:28,textAlign:"center"},children:"Loading…"}):e.jsxs("div",{className:"grid",children:[(!S||S.length===0)&&e.jsx("div",{className:"muted",children:"No videos found"}),S.map(i=>e.jsxs("article",{className:"card","aria-labelledby":`vtitle-${i.video_id}`,children:[e.jsx("div",{style:{cursor:"pointer"},onClick:()=>ge(i),children:e.jsxs("div",{className:"thumb-wrap",role:"button","aria-label":`Play ${i.tittle||i.title||i.displayTitle}`,children:[i._deriving||!i.thumbnail?e.jsx("div",{className:"skel"}):e.jsx("img",{className:"thumb",src:i.thumbnail||Ge,alt:i.tittle||i.title||"thumb",onError:Ce}),e.jsx("div",{className:"thumb-play","aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 24 24",focusable:"false","aria-hidden":"true",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",gap:10},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{id:`vtitle-${i.video_id}`,style:{fontWeight:700,color:"#0f172a",fontSize:16},children:i.tittle||i.title||i.displayTitle}),e.jsx("div",{className:"muted",style:{marginTop:8},children:i.description?String(i.description).slice(0,140)+(i.description.length>140?"…":""):"No description"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx("button",{className:"btn-sm btn",onClick:()=>te(i),title:"Edit",children:e.jsx(Ae.Edit,{style:{width:14,height:14}})}),e.jsx("button",{className:"btn-sm btn",onClick:()=>oe(i),title:"Delete",children:e.jsx(Ae.Delete,{style:{width:14,height:14}})})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:12,alignItems:"center"},children:[e.jsxs("div",{className:"muted",children:[i.course_name||"-"," • ",i.book_name||"-"," • ",i.chapter_name||"-"]}),e.jsx("div",{className:"muted",children:z(i.created_at)})]})]})]},i.video_id))]}),e.jsxs("div",{style:{marginTop:18,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{className:"muted",children:S.length?`${(h.page-1)*h.pageSize+1}–${Math.min(h.page*h.pageSize,h.total)} of ${h.total}`:""}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn",disabled:h.page<=1,onClick:()=>w(i=>({...i,page:Math.max(1,i.page-1)})),children:"Prev"}),e.jsx("button",{className:"btn btn-primary",disabled:h.page*h.pageSize>=h.total,onClick:()=>w(i=>({...i,page:i.page+1})),children:"Next"})]})]})]}),pe&&e.jsx("div",{className:"modal-backdrop",onClick:i=>{i.stopPropagation()},onMouseDown:i=>{i.stopPropagation()},children:e.jsxs("form",{onSubmit:Ee,onClick:i=>i.stopPropagation(),onMouseDown:i=>i.stopPropagation(),className:"modal-card",children:[e.jsxs("div",{className:"editor-header",children:[e.jsx("img",{src:Ls,alt:"Ank",style:{height:46},onError:Ce}),e.jsx("div",{className:"editor-title",children:ie?"Edit Video":"Create Video"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>{re(!1),Ne(null)},children:"Close"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save"})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 380px",gap:18,padding:18},children:[e.jsxs("div",{children:[e.jsx(K,{label:"Title",required:!0,children:e.jsx(ze,{value:xe.tittle,onChange:i=>Re(N=>({...N,tittle:i,title:i}))})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(K,{label:"Course",children:e.jsx(Te,{value:xe.course_id,onChange:i=>Re(N=>({...N,course_id:i,book_id:"",chapter_id:""})),options:[{value:"",label:"— none —"}].concat((t||[]).map(i=>({value:i.course_id,label:i.course_name}))),disabled:H})}),e.jsx(K,{label:"Book",children:e.jsx(Te,{value:xe.book_id,onChange:i=>Re(N=>({...N,book_id:i,chapter_id:""})),options:[{value:"",label:"— none —"}].concat(W.map(i=>({value:i.book_id,label:i.book_name}))),disabled:H})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[e.jsx(K,{label:"Chapter",children:e.jsx(Te,{value:xe.chapter_id,onChange:i=>Re(N=>({...N,chapter_id:i})),options:[{value:"",label:"— none —"}].concat(V.map(i=>({value:i.chapter_id,label:i.chapter_name}))),disabled:H})}),e.jsx(K,{label:"Video link (YouTube/Vimeo/Drive/MP4)",children:e.jsx(ze,{value:xe.video_link,onChange:i=>Re(N=>({...N,video_link:i})),placeholder:"https://..."})})]}),e.jsx(K,{label:"Description",children:e.jsx("textarea",{value:xe.description,onChange:i=>Re(N=>({...N,description:i.target.value})),className:"form-control",rows:5})}),e.jsxs("div",{style:{display:"flex",gap:10,marginTop:10},children:[e.jsxs("button",{type:"button",className:"btn",onClick:()=>{const i=xe.tittle||xe.title||"Preview";Fe(i),Se(B(xe.video_link||"",i)),de(!0)},children:[e.jsx(Ae.Play,{style:{width:16,height:16,marginRight:6}}),"Preview"]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted",children:"Thumbnail:"}),e.jsx("div",{className:"muted",style:{fontSize:13},children:_e&&_e!==Ge?"derived or backend":"will be derived from URL"}),e.jsx("button",{type:"button",className:"btn btn-outline",onClick:async()=>{ke(Ge);const i=await mt(xe.video_link||"");ke(i||Ge)},children:"Regenerate"})]})]})]}),e.jsx("aside",{children:e.jsx("div",{style:{marginTop:0},children:e.jsxs("div",{style:{border:"1px solid rgba(2,6,23,0.04)",borderRadius:12,padding:10,background:"linear-gradient(180deg,#fff,#fbfdff)"},children:[e.jsx("img",{src:_e,alt:"thumb",style:{width:"100%",height:220,objectFit:"cover",borderRadius:10},onError:Ce}),e.jsx("div",{className:"muted",style:{marginTop:10},children:_e===Ge?"Thumbnail preview":"Derived thumbnail"}),e.jsx("div",{style:{fontSize:12,color:"#6b7280",marginTop:6},children:"Derived thumbnails are auto-saved to backend (best-effort)."})]})})})]}),e.jsxs("div",{style:{padding:14,borderTop:"1px solid rgba(2,6,23,0.03)",display:"flex",justifyContent:"flex-end",gap:10},children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>{re(!1),Ne(null)},children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save video"})]})]})}),je&&e.jsx("div",{className:"modal-backdrop",onClick:i=>{i.stopPropagation()},onMouseDown:i=>{i.stopPropagation()},children:e.jsxs("div",{className:"modal-card",style:{padding:16,maxWidth:980},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{style:{fontWeight:700,fontSize:18},children:"Import Videos from CSV"}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-outline",onClick:()=>{l(!1),Y(""),Me([])},children:"Close"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 360px",gap:12},children:[e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx("input",{ref:p,type:"file",accept:".csv,text/csv",onChange:i=>P(i.target.files)})}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx("div",{style:{marginBottom:6,color:"var(--muted)"},children:"Or paste CSV text below (headers allowed: title,tittle,description,video_link,course_name,book_name,chapter_name)"}),e.jsx("textarea",{value:j,onChange:i=>{Y(i.target.value),Me(o(i.target.value))},rows:10,className:"form-control"})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn btn-primary",onClick:ee,children:"Import CSV"}),e.jsx("button",{className:"btn btn-outline",onClick:()=>{Y(""),Me([]),p.current&&(p.current.value="")},children:"Clear"})]}),e.jsxs("div",{style:{marginTop:12,color:"var(--muted)"},children:[e.jsx("div",{style:{marginBottom:6},children:"Preview (first up to 5 rows):"}),e.jsx("div",{style:{background:"#fff",border:"1px solid rgba(2,6,23,0.04)",borderRadius:8,padding:10},children:se.length===0?e.jsx("div",{style:{color:"#9aa4b2"},children:"No preview available"}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:Object.keys(se[0]).map(i=>e.jsx("th",{style:{textAlign:"left",padding:6,fontSize:13,color:"#374151"},children:i},i))})}),e.jsx("tbody",{children:se.map((i,N)=>e.jsx("tr",{children:Object.keys(i).map(I=>e.jsx("td",{style:{padding:6,fontSize:13,color:"#475569"},children:String(i[I]??"")},I))},N))})]})})})]})]}),e.jsx("aside",{children:e.jsxs("div",{style:{border:"1px solid rgba(2,6,23,0.04)",borderRadius:10,padding:12,background:"linear-gradient(180deg,#fff,#fbfdff)"},children:[e.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"CSV Import Notes"}),e.jsxs("ul",{style:{margin:0,paddingLeft:18,color:"var(--muted)"},children:[e.jsxs("li",{children:["Header names supported: ",e.jsx("code",{children:"title"})," or ",e.jsx("code",{children:"tittle"})," (either), ",e.jsx("code",{children:"description"}),", ",e.jsx("code",{children:"video_link"}),", ",e.jsx("code",{children:"course_name"}),", ",e.jsx("code",{children:"book_name"}),", ",e.jsx("code",{children:"chapter_name"}),"."]}),e.jsx("li",{children:"Rows are resolved against course/book/chapter names when provided — ensure names match existing records."}),e.jsx("li",{children:"Large CSVs are accepted; server will insert rows in bulk."}),e.jsx("li",{children:"If import fails, server will return an error message."})]})]})})]})]})}),O&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:99999,background:"rgba(2,6,23,0.7)",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>{de(!1),Se("")},children:e.jsxs("div",{style:{width:"90%",maxWidth:1100,background:"#fff",borderRadius:12,overflow:"hidden"},onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:12,borderBottom:"1px solid rgba(2,6,23,0.04)"},children:[e.jsx("div",{style:{fontWeight:700},children:Z}),e.jsx("div",{children:e.jsx("button",{className:"btn",onClick:()=>{de(!1),Se("")},children:"Close"})})]}),e.jsx("div",{style:{padding:12},dangerouslySetInnerHTML:{__html:De}})]})})]})}const Hl=s.lazy(()=>ua(()=>import("./inquiry-Dz9R_8bU.js"),__vite__mapDeps([0,1,2,3]))),Xs=s.createContext(null);function Vl({children:t}){const[a,r]=s.useState(()=>{try{return JSON.parse(localStorage.getItem("user")||"null")}catch{return null}}),[u,v]=s.useState(!1);s.useEffect(()=>{let L=!0;async function g(){if(Ze.getToken()){v(!0);try{const q=await Ze.loadMe();if(!L)return;r(q)}catch{Ze.setToken("");try{localStorage.removeItem("user")}catch{}r(null)}finally{L&&v(!1)}}}g();function R(){try{r(JSON.parse(localStorage.getItem("user")||"null"))}catch{r(null)}}function h(D){var q;try{const $=(q=D==null?void 0:D.detail)==null?void 0:q.user;$===void 0?R():r($||null)}catch{R()}}function w(){Ze.setToken("");try{localStorage.removeItem("user")}catch{}r(null)}return window.addEventListener("storage",R),window.addEventListener("auth:changed",h),window.addEventListener("auth:expired",w),()=>{L=!1,window.removeEventListener("storage",R),window.removeEventListener("auth:changed",h),window.removeEventListener("auth:expired",w)}},[]);async function M(L){Ze.setToken(L);try{const g=await Ze.loadMe();return r(g),g}catch(g){throw Ze.setToken(""),g}}function S(){Ze.logout(),r(null)}return e.jsx(Xs.Provider,{value:{user:a,setUser:r,loading:u,loginWithToken:M,logout:S},children:t})}function gt(){const t=s.useContext(Xs);if(!t)throw new Error("useAuth must be used inside AuthProvider");return t}function Be({children:t}){const{user:a,loading:r}=gt(),u=Kt();return r?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading…"}):a?t:e.jsx(Vt,{to:"/login",state:{from:u},replace:!0})}function Js(t=""){const a=(t||"").toString().toLowerCase();return a?a.includes("admin")||a.includes("super")||a.includes("manager")||a.includes("owner")?"/dashboard/admin":a.includes("faculty")||a.includes("teacher")||a.includes("instructor")?"/dashboard/faculty":a.includes("school")||a.includes("school_admin")||a.includes("schooladmin")?"/dashboard/school":"/dashboard":"/dashboard"}function Wl(){const{user:t}=gt(),a=Rt();return s.useEffect(()=>{const r=t?t.role_name||t.role||"":localStorage.getItem("role")||"",u=Js(r);a(u,{replace:!0})},[t,a]),e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Redirecting…"})}function Gl(){return e.jsxs("div",{className:"min-h-screen",children:[e.jsx("div",{className:"mb-6",children:e.jsx("nav",{className:"text-sm","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"list-reset flex text-slate-500",children:[e.jsx("li",{children:e.jsx(Nt,{to:"/dashboard/admin",className:"text-slate-500 hover:text-slate-700",children:"Dashboard"})}),e.jsx("li",{children:e.jsx("span",{className:"mx-2",children:"/"})}),e.jsx("li",{className:"text-slate-700 font-medium",children:"Inquiry Management"})]})})}),e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"p-6 bg-white border rounded text-center",children:"Loading inquiries…"}),children:e.jsx(Hl,{})})]})}function Kl(){const a=Kt().pathname.startsWith("/login");return e.jsxs("div",{className:"min-h-screen bg-slate-50 text-slate-900",children:[!a&&e.jsx(cl,{logoClass:"h-10 w-10 object-contain"}),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex gap-6",children:[!a&&e.jsx(Us,{className:"hidden md:block w-64"}),e.jsx("main",{className:"flex-1 min-h-screen py-8 px-6",children:e.jsxs(na,{children:[e.jsx(Ue,{path:"/",element:e.jsx(Vt,{to:"/login",replace:!0})}),e.jsx(Ue,{path:"/login",element:e.jsx(Yl,{})}),e.jsx(Ue,{path:"/dashboard",element:e.jsx(Be,{children:e.jsx(Wl,{})})}),e.jsx(Ue,{path:"/dashboard/admin",element:e.jsx(Be,{children:e.jsx(Vn,{})})}),e.jsx(Ue,{path:"/dashboard/faculty",element:e.jsx(Be,{children:e.jsx(Wn,{})})}),e.jsx(Ue,{path:"/dashboard/school",element:e.jsx(Be,{children:e.jsx(Gn,{})})}),e.jsx(Ue,{path:"/admin/schools",element:e.jsx(Be,{children:e.jsx(fl,{})})}),e.jsx(Ue,{path:"/admin/inquiries",element:e.jsx(Be,{children:e.jsx(Gl,{})})}),e.jsx(Ue,{path:"/admin/orders",element:e.jsx(Be,{children:e.jsx(fs,{})})}),e.jsx(Ue,{path:"/admin/strengths",element:e.jsx(Be,{children:e.jsx(hl,{})})}),e.jsx(Ue,{path:"/admin/faculty",element:e.jsx(Be,{children:e.jsx(vl,{})})}),e.jsx(Ue,{path:"/admin/faculty/assign",element:e.jsx(Be,{children:e.jsx(Cl,{})})}),e.jsx(Ue,{path:"/admin/academics/timetables",element:e.jsx(Be,{children:e.jsx(Rl,{})})}),e.jsx(Ue,{path:"/admin/academics/class-sessions",element:e.jsx(Be,{children:e.jsx(Dl,{})})}),e.jsx(Ue,{path:"/admin/academics/courses",element:e.jsx(Be,{children:e.jsx(Fl,{})})}),e.jsx(Ue,{path:"/admin/academics/books",element:e.jsx(Be,{children:e.jsx(zl,{})})}),e.jsx(Ue,{path:"/admin/academics/videos",element:e.jsx(Be,{children:e.jsx(Bl,{})})}),e.jsx(Ue,{path:"/admin/orders/:id",element:e.jsx(Be,{children:e.jsx(fs,{})})}),e.jsx(Ue,{path:"*",element:e.jsx(Vt,{to:"/login",replace:!0})})]})})]})}),!a&&e.jsx("footer",{className:"border-t mt-12 bg-white",children:e.jsxs("div",{className:"w-full py-6 text-sm text-slate-500 px-6",children:["© ",new Date().getFullYear()," AnkVidhya. Built with ❤️."]})})]})}function Yl(){const{user:t,loading:a}=gt(),r=Rt();return s.useEffect(()=>{if(!a&&t){const u=t?t.role_name||t.role||"":localStorage.getItem("role")||"",v=Js(u);r(v,{replace:!0})}},[t,a,r]),a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading…"}):t?null:e.jsx(Pa,{})}function Xl(){return e.jsx(ia,{children:e.jsx(Vl,{children:e.jsx(Kl,{})})})}class Jl extends lt.Component{constructor(a){super(a),this.state={hasError:!1,error:null,info:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,r){this.setState({error:a,info:r});try{window&&window.__SENTRY_HUB__&&typeof window.__SENTRY_HUB__.captureException=="function"&&window.__SENTRY_HUB__.captureException(a)}catch{}}render(){const{hasError:a,error:r}=this.state;return a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 text-slate-900 p-6",children:e.jsxs("div",{className:"max-w-xl w-full bg-white border rounded-lg shadow p-6 text-center",children:[e.jsx("h1",{className:"text-xl font-semibold mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"Sorry — an unexpected error occurred. We're tracking this issue and will look into it."}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded",onClick:()=>window.location.reload(),children:"Reload"}),e.jsx("a",{className:"px-4 py-2 border rounded text-sm text-slate-700 hover:bg-slate-50",href:"mailto:admin@example.com",target:"_blank",rel:"noopener noreferrer",children:"Contact support"})]})]})}):this.props.children}}async function Ql(){if(!(typeof window>"u")&&"serviceWorker"in navigator)try{const t="/service-worker.js";if(!(await fetch(t,{method:"HEAD"})).ok)return;const r=await navigator.serviceWorker.register(t,{scope:"/"});return r.addEventListener("updatefound",()=>{const u=r.installing;u&&u.addEventListener("statechange",()=>{var v;if(u.state==="installed"&&navigator.serviceWorker.controller)try{(v=window.ui)!=null&&v.toast&&window.ui.toast("New version available — please refresh","info")}catch{}})}),r}catch(t){throw console.warn("SW registration failed",t),t}}const Qs=document.getElementById("root");if(!Qs)throw new Error("Root element (#root) not found");const Zl=la.createRoot(Qs);Zl.render(e.jsx(s.StrictMode,{children:e.jsx(Jl,{children:e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading…"}),children:e.jsx(Xl,{})})})}));Ql().catch(t=>{console.warn("Service worker registration failed:",t)});export{Dt as C,Jt as D,Zt as F,He as P,Qe as S,ze as T,E as a,K as b,Te as c,ht as d,Lt as e,Qt as f,pt as g};
